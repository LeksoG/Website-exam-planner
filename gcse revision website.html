<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GCSE Revision Planner</title>
    <style>
        /* Enhanced Theme System - Root Variables */
/* Updated Theme System - Only White and Black */
:root {
    /* Default White Theme */
    --bg-primary: linear-gradient(135deg, #ffffff 0%, #fefefe 25%, #f9fafb 50%, #f3f4f6 75%, #e5e7eb 100%);
    --bg-secondary: #ffffff;
    --bg-card: rgba(255, 255, 255, 0.98);
    --bg-card-hover: rgba(255, 255, 255, 1);
    --text-primary: #111827;
    --text-secondary: #374151;
    --text-muted: #6b7280;
    --accent-blue: #3b82f6;
    --accent-blue-hover: #2563eb;
    --accent-blue-light: rgba(59, 130, 246, 0.08);
    --accent-green: #059669;
    --accent-red: #dc2626;
    --border-color: rgba(209, 213, 219, 0.3);
    --border-hover: rgba(59, 130, 246, 0.3);
    --glass-bg: rgba(255, 255, 255, 0.95);
    --glass-border: rgba(209, 213, 219, 0.3);
    --sidebar-bg: rgba(255, 255, 255, 0.99);
    --sidebar-highlight: linear-gradient(135deg, rgba(59, 130, 246, 0.12) 0%, rgba(59, 130, 246, 0.04) 100%);
    --calendar-header: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
    --calendar-day: #fefefe;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

/* Black Theme */
[data-theme="black"] {
    --bg-primary: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #334155 50%, #475569 75%, #64748b 100%);
    --bg-secondary: #1e293b;
    --bg-card: rgba(30, 41, 59, 0.95);
    --bg-card-hover: rgba(30, 41, 59, 0.98);
    --text-primary: #f1f5f9;
    --text-secondary: #cbd5e1;
    --text-muted: #94a3b8;
    --accent-blue: #60a5fa;
    --accent-blue-hover: #3b82f6;
    --accent-blue-light: rgba(96, 165, 250, 0.15);
    --accent-green: #34d399;
    --accent-red: #f87171;
    --border-color: rgba(71, 85, 105, 0.3);
    --border-hover: rgba(96, 165, 250, 0.4);
    --glass-bg: rgba(30, 41, 59, 0.9);
    --glass-border: rgba(71, 85, 105, 0.4);
    --sidebar-bg: rgba(15, 23, 42, 0.98);
    --sidebar-highlight: linear-gradient(135deg, rgba(96, 165, 250, 0.2) 0%, rgba(96, 165, 250, 0.08) 100%);
    --calendar-header: linear-gradient(135deg, #1e293b 0%, #334155 100%);
    --calendar-day: #334155;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.4);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.6), 0 10px 10px -5px rgba(0, 0, 0, 0.5);
}

/* Ensure only 4 tab colors work consistently */
.tab.color-1 { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-color: #3b82f6; }
.tab.color-2 { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); border-color: #7c3aed; }
.tab.color-3 { background: linear-gradient(135deg, #059669 0%, #047857 100%); border-color: #059669; }
.tab.color-4 { background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%); border-color: #ea580c; }

/* Smooth theme transitions */
* {
    transition: background-color 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                color 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                border-color 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                box-shadow 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            font-weight: 400;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-overlay);
            backdrop-filter: blur(0.5px);
            z-index: -1;
        }

        /* Container and Layout */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
            transition: margin-left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 50px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 2px solid var(--glass-border);
            box-shadow: var(--shadow-lg);
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .container.sidebar-open {
            margin-left: 280px;
        }

        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding: 20px 0;
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 25%, #60a5fa  75%, #93c5fd 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.04em;
            text-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
        }

        /* Professional Icon Styles */
        .icon {
            width: 20px;
            height: 20px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2.5;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .icon-lg {
            width: 24px;
            height: 24px;
        }

        /* Enhanced Sidebar Styles */
        .sidebar {
            position: fixed;
            left: -280px;
            top: 0;
            width: 280px;
            height: 100vh;
            background: var(--sidebar-bg);
            backdrop-filter: blur(30px);
            border-right: 2px solid var(--glass-border);
            transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            box-shadow: 8px 0 32px rgba(0, 0, 0, 0.12);
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar-header {
            padding: 32px 28px;
            border-bottom: 2px solid var(--glass-border);
            background: var(--gradient-overlay);
        }

        .sidebar-header h2 {
            color: var(--accent-blue);
            font-size: 1.5rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 16px;
            letter-spacing: -0.02em;
        }

        .sidebar-nav {
            padding: 32px 0;
        }

        /* Enhanced Sidebar Item with Oval Highlighting */
        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px 28px;
            margin: 8px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            font-weight: 600;
            font-size: 1.05rem;
            position: relative;
            border-radius: 24px;
            overflow: hidden;
        }

        .sidebar-item::before {
            content: '';
            position: absolute;
            left: -100%;
            top: 0;
            height: 100%;
            width: 100%;
            background: var(--sidebar-highlight);
            border-radius: 24px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: -1;
        }

        .sidebar-item::after {
            content: '';
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 32px;
            background: var(--accent-blue);
            border-radius: 16px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar-item:hover,
        .sidebar-item.active {
            color: var(--accent-blue);
            background: var(--sidebar-highlight);
            border-radius: 24px;
            transform: translateX(4px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.15);
        }

        .sidebar-item:hover::before,
        .sidebar-item.active::before {
            left: 0;
        }

        .sidebar-item:hover::after,
        .sidebar-item.active::after {
            width: 4px;
        }

        .sidebar-item.active {
            background: var(--accent-blue-light);
            border: 2px solid rgba(37, 99, 235, 0.2);
        }

        /* Sidebar Trigger - Updated for hover */
        .sidebar-trigger {
            position: fixed;
            left: 0;
            top: 0;
            width: 32px;
            height: 100vh;
            z-index: 998;
            cursor: pointer;
            background: linear-gradient(90deg, rgba(37, 99, 235, 0.05) 0%, transparent 100%);
            transition: all 0.3s ease;
        }

        .sidebar-trigger:hover {
            background: linear-gradient(90deg, rgba(37, 99, 235, 0.1) 0%, transparent 100%);
            width: 40px;
        }

        /* Sidebar Overlay */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /* Page Styles */
        .page {
            display: none;
            opacity: 0;
            transform: translateY(24px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Enhanced Card Styles */
        .card {
            background: var(--bg-card);
            border: 2px solid var(--glass-border);
            border-radius: 40px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-overlay);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -8px rgba(0, 0, 0, 0.15);
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
        }

        .card:hover::before {
            opacity: 1;
        }

        /* Form Styles */
        .input-group {
            margin-bottom: 24px;
        }

        .input-group label {
            display: block;
            margin-bottom: 12px;
            color: var(--accent-blue);
            font-weight: 700;
            font-size: 1.05rem;
            letter-spacing: -0.01em;
        }

        .input-group input, .input-group textarea {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
            box-shadow: var(--shadow-sm);
        }

        .input-group textarea {
            resize: vertical;
            min-height: 100px;
            line-height: 1.6;
        }

        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 4px var(--accent-blue-light), var(--shadow-md);
            transform: translateY(-2px);
        }

        /* Enhanced Button Styles */
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-blue-hover) 100%);
            color: white;
            border: none;
            padding: 18px 32px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 8px 32px rgba(37, 99, 235, 0.3);
            letter-spacing: -0.01em;
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(37, 99, 235, 0.4);
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            padding: 14px 24px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Enhanced Tab Container with Carousel */
        .tab-carousel {
            position: relative;
            margin-bottom: 32px;
            padding: 20px;
            border-radius: 30px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 2px solid var(--glass-border);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .tab-viewport {
            overflow: hidden;
            width: 100%;
        }

        .tab-container {
            display: flex;
            gap: 16px;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 100%;
        }

        .tab {
            border: 2px solid;
            color: white;
            padding: 16px 28px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            backdrop-filter: blur(12px);
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
            min-width: 200px;
            justify-content: center;
        }

        .tab.color-1 { background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-blue-hover) 100%); border-color: var(--accent-blue); }
        .tab.color-2 { background: linear-gradient(135deg, var(--accent-purple) 0%, #6d28d9 100%); border-color: var(--accent-purple); }
        .tab.color-3 { background: linear-gradient(135deg, var(--accent-green) 0%, #047857 100%); border-color: var(--accent-green); }
        .tab.color-4 { background: linear-gradient(135deg, var(--accent-orange) 0%, #c2410c 100%); border-color: var(--accent-orange); }
        .tab.color-5 { background: linear-gradient(135deg, var(--accent-pink) 0%, #be185d 100%); border-color: var(--accent-pink); }
        .tab.color-6 { background: linear-gradient(135deg, var(--accent-yellow) 0%, #a16207 100%); border-color: var(--accent-yellow); }

        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.4s ease;
        }

        .tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.2);
        }

        .tab:hover::before {
            left: 100%;
        }

        .tab.active {
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px) scale(1.05);
        }

        /* Carousel Navigation */
        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: var(--bg-secondary);
            border: 2px solid var(--glass-border);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            z-index: 10;
        }

        .carousel-nav:hover {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
            transform: translateY(-50%) scale(1.1);
        }

        .carousel-nav.prev {
            left: -10px;
        }

        .carousel-nav.next {
            right: -10px;
        }

        .carousel-nav:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: translateY(-50%);
        }

        /* New Schedule Grid Layout */
        .schedule-grid-container {
            background: var(--glass-bg);
            border: 2px solid var(--glass-border);
            border-radius: 40px;
            overflow: hidden;
            backdrop-filter: blur(30px);
            margin-bottom: 24px;
            box-shadow: var(--shadow-lg);
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: 200px repeat(7, 1fr);
            grid-template-rows: auto repeat(var(--subject-count, 6), 1fr);
            min-height: 600px;
            gap: 2px;
            background: var(--border-color);
            padding: 2px;
        }

        .grid-header {
            background: var(--calendar-header);
            padding: 20px 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            color: var(--accent-blue);
            font-size: 1rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            border-bottom: 2px solid var(--glass-border);
            position: relative;
        }

        .grid-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: var(--accent-blue);
            border-radius: 2px;
            opacity: 0.6;
        }

        .subject-label {
            background: var(--calendar-header);
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            color: var(--accent-blue);
            font-size: 0.95rem;
            text-align: center;
            word-wrap: break-word;
            border-right: 2px solid var(--glass-border);
            writing-mode: horizontal-tb;
            min-height: 120px;
        }

        .schedule-cell {
            background: var(--calendar-day);
            padding: 8px;
            min-height: 120px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            gap: 4px;
            overflow: hidden;
        }

        .schedule-cell.today {
            background: var(--calendar-today);
            box-shadow: inset 0 0 0 2px rgba(37, 99, 235, 0.3);
        }

        .schedule-cell:hover {
            background: rgba(37, 99, 235, 0.03);
            transform: scale(1.02);
            z-index: 10;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        /* Revision Card Styles - Compact for Grid */
        .revision-card-mini {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 6px 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            cursor: pointer;
            font-size: 0.75rem;
            box-shadow: var(--shadow-sm);
            min-height: 45px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            word-wrap: break-word;
            overflow: hidden;
        }

        .revision-card-mini:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
            border-color: var(--accent-blue);
            background: rgba(37, 99, 235, 0.02);
            z-index: 5;
        }

        .revision-card-mini.completed {
            background: rgba(5, 150, 105, 0.08);
            border-color: var(--accent-green);
            opacity: 0.85;
        }

        .revision-card-mini-content {
            flex: 1;
            overflow: hidden;
        }

        .revision-card-mini-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
            line-height: 1.2;
            font-size: 0.8rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .revision-card-mini-topic {
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 3px;
            font-size: 0.7rem;
            line-height: 1.1;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .revision-card-mini-meta {
            color: var(--text-muted);
            font-size: 0.65rem;
            display: flex;
            justify-content: space-between;
            font-weight: 500;
            margin-top: auto;
        }

        .revision-card-mini-menu {
            position: absolute;
            top: 2px;
            right: 2px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 2px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(12px);
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
        }

        .revision-card-mini:hover .revision-card-mini-menu {
            opacity: 1;
        }

        .revision-card-mini-menu:hover {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
        }

        /* Enhanced Dropdown Menu */
        .dropdown {
            position: fixed;
            background: var(--bg-secondary);
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            min-width: 200px;
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            opacity: 0;
            transform: translateY(-12px) scale(0.9);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            backdrop-filter: blur(30px);
        }

        .dropdown.show {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: all;
        }

        .dropdown-item {
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: var(--accent-blue);
            color: white;
            transform: translateX(4px);
        }

        /* Loading Animation Styles */
        .loading-container {
            display: none;
            padding: 32px 0;
        }

        .loading-container.show {
            display: block;
        }

        .loading-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .loading-card {
            height: 200px;
            border-radius: 30px;
            background: var(--loading-bg);
            background-size: 400% 400%;
            animation: glowPulse 2.5s ease-in-out infinite;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(12px);
            box-shadow: var(--shadow-lg);
        }

        .loading-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: wave 2s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { 
                background-position: 0% 50%;
                opacity: 0.9;
                transform: scale(1);
            }
            50% { 
                background-position: 100% 50%;
                opacity: 1;
                transform: scale(1.01);
            }
        }

        @keyframes wave {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state h3 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 1.4rem;
            font-weight: 700;
        }

        .empty-state p {
            font-size: 1rem;
            font-weight: 500;
        }

        /* Progress Bars */
        .progress-bar {
            background: var(--calendar-day);
            border-radius: 20px;
            height: 24px;
            overflow: hidden;
            margin-bottom: 12px;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-blue-hover) 100%);
            border-radius: 20px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
        }

        .progress-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShimmer 2.5s ease-in-out infinite;
        }

        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Settings Grid */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .settings-card {
            background: var(--glass-bg);
            border: 2px solid var(--glass-border);
            border-radius: 30px;
            padding: 24px;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }

        .settings-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .settings-card h4 {
            color: var(--accent-blue);
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .settings-card p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 16px;
            line-height: 1.5;
        }

        /* Alert Styles */
        .alert {
            padding: 16px 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
        }

        .alert.error {
            background: rgba(220, 38, 38, 0.1);
            border: 2px solid var(--accent-red);
            color: var(--accent-red);
        }

        .alert.success {
            background: rgba(5, 150, 105, 0.1);
            border: 2px solid var(--accent-green);
            color: var(--accent-green);
        }

        /* Hide scrollbars globally */
        * {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        *::-webkit-scrollbar {
            display: none;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .container {
                padding: 16px;
                border-radius: 30px;
            }

            .header h1 {
                font-size: 2.4rem;
            }

            .schedule-grid {
                grid-template-columns: 150px repeat(7, 1fr);
            }

            .subject-label {
                padding: 12px 8px;
                font-size: 0.85rem;
            }

            .loading-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 12px;
                border-radius: 20px;
                margin: 10px;
            }

            .container.sidebar-open {
                margin-left: 0;
            }

            .header {
                margin-bottom: 24px;
                padding: 12px 0;
            }

            .header h1 {
                font-size: 2rem;
            }

            .sidebar {
                width: 100%;
                left: -100%;
            }

            .schedule-grid {
                grid-template-columns: 100px repeat(3, 1fr);
                gap: 1px;
            }

            .schedule-cell {
                min-height: 80px;
                padding: 4px;
            }

            .revision-card-mini {
                min-height: 35px;
                padding: 4px 6px;
                font-size: 0.65rem;
            }

            .revision-card-mini-title {
                font-size: 0.7rem;
            }

            .revision-card-mini-topic {
                font-size: 0.65rem;
            }

            .revision-card-mini-meta {
                font-size: 0.6rem;
            }

            .grid-header {
                padding: 12px 8px;
                font-size: 0.8rem;
            }

            .subject-label {
                padding: 8px 4px;
                font-size: 0.75rem;
                min-height: 80px;
            }

            .card {
                padding: 20px;
                border-radius: 25px;
            }

            .loading-grid {
                grid-template-columns: 1fr;
            }

            .tab {
                min-width: 160px;
                padding: 14px 20px;
            }

            .carousel-nav {
                width: 36px;
                height: 36px;
            }
        }

        /* Accessibility Improvements */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --border-color: rgba(0, 0, 0, 0.5);
                --glass-border: rgba(0, 0, 0, 0.6);
            }
        }

        /* Enhanced Tab Carousel with Hover Navigation */
.tab-carousel {
    position: relative;
    margin-bottom: 32px;
    padding: 20px 60px; /* Add space for arrows */
    border-radius: 30px;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 2px solid var(--glass-border);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
}

.tab-carousel:hover .carousel-nav {
    opacity: 1;
    transform: translateY(-50%) scale(1);
}

/* Smooth Carousel Navigation */
.carousel-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%) scale(0.8);
    background: var(--bg-secondary);
    border: 2px solid var(--glass-border);
    border-radius: 50%;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: var(--shadow-lg);
    z-index: 20;
    opacity: 0;
    backdrop-filter: blur(20px);
}

.carousel-nav:hover {
    background: var(--accent-blue);
    color: white;
    border-color: var(--accent-blue);
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
}

.carousel-nav.prev {
    left: 16px;
}

.carousel-nav.next {
    right: 16px;
}

.carousel-nav:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    transform: translateY(-50%) scale(0.8);
    background: var(--bg-secondary);
    color: var(--text-muted);
    border-color: var(--border-color);
}

.carousel-nav:disabled:hover {
    background: var(--bg-secondary);
    color: var(--text-muted);
    border-color: var(--border-color);
    transform: translateY(-50%) scale(0.8);
    box-shadow: var(--shadow-md);
}

/* Smooth Tab Container Animation */
.tab-container {
    display: flex;
    gap: 16px;
    transition: transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
    min-width: 100%;
    will-change: transform;
}

/* Enhanced Tab Animations */
.tab {
    border: 2px solid;
    color: white;
    padding: 16px 28px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 700;
    backdrop-filter: blur(12px);
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
    min-width: 200px;
    justify-content: center;
    opacity: 0.8;
    transform: scale(0.95);
}

.tab.active {
    opacity: 1;
    transform: scale(1);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
    z-index: 10;
}

.tab:not(.active):hover {
    opacity: 0.9;
    transform: scale(0.98);
}

/* Smooth Tab Entrance/Exit Animations */
@keyframes tabSlideIn {
    from {
        opacity: 0;
        transform: translateX(30px) scale(0.9);
    }
    to {
        opacity: 0.8;
        transform: translateX(0) scale(0.95);
    }
}

@keyframes tabSlideOut {
    from {
        opacity: 0.8;
        transform: translateX(0) scale(0.95);
    }
    to {
        opacity: 0;
        transform: translateX(-30px) scale(0.9);
    }
}

.tab.entering {
    animation: tabSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.tab.exiting {
    animation: tabSlideOut 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

/* Smooth Content Transition */
.schedule-grid-container {
    opacity: 1;
    transform: translateY(0);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.schedule-grid-container.transitioning {
    opacity: 0.7;
    transform: translateY(10px);
}

/* Enhanced Progress Cards with Hover Button */
.progress-card {
    margin-bottom: 24px; 
    padding: 24px; 
    background: var(--glass-bg); 
    border-radius: 30px; 
    border: 2px solid var(--glass-border); 
    backdrop-filter: blur(20px); 
    box-shadow: var(--shadow-lg);
    position: relative;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.progress-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
}

.progress-view-button {
    position: absolute;
    top: 20px;
    right: 20px;
    background: var(--accent-blue);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 16px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    opacity: 0;
    transform: translateY(-10px) scale(0.9);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 16px rgba(37, 99, 235, 0.3);
    display: flex;
    align-items: center;
    gap: 8px;
}

.progress-card:hover .progress-view-button {
    opacity: 1;
    transform: translateY(0) scale(1);
}

.progress-view-button:hover {
    background: var(--accent-blue-hover);
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
}

/* Centered Tab Carousel */
.tab-carousel {
    position: relative;
    margin-bottom: 32px;
    padding: 20px 80px; /* More space for arrows */
    border-radius: 30px;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 2px solid var(--glass-border);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
}

.tab-viewport {
    width: 300px; /* Fixed width to show one tab */
    overflow: hidden;
    position: relative;
}

.tab-container {
    display: flex;
    gap: 20px;
    transition: transform 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
    will-change: transform;
}

/* Centered Tab Styling */
.tab {
    border: 2px solid;
    color: white;
    padding: 20px 32px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 700;
    backdrop-filter: blur(12px);
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
    width: 280px; /* Fixed width */
    justify-content: center;
    opacity: 0.6;
    transform: scale(0.85);
    filter: blur(1px);
}

.tab.active {
    opacity: 1;
    transform: scale(1);
    filter: blur(0);
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.3);
    z-index: 10;
}

.tab.prev-tab,
.tab.next-tab {
    opacity: 0.4;
    transform: scale(0.75);
    filter: blur(2px);
}

/* Enhanced Navigation Arrows */
.carousel-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: var(--accent-blue);
    color: white;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
    z-index: 20;
    opacity: 0.8;
}

.carousel-nav:hover {
    opacity: 1;
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 12px 30px rgba(37, 99, 235, 0.6);
}

.carousel-nav.prev {
    left: 20px;
}

.carousel-nav.next {
    right: 20px;
}

/* Smooth Content Transition */
.schedule-grid-container {
    opacity: 1;
    transform: translateY(0);
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.schedule-grid-container.transitioning {
    opacity: 0.3;
    transform: translateY(20px);
}

/* Fixed Centered Tab Carousel */
.tab-viewport {
    width: 320px; /* Slightly wider for better centering */
    overflow: hidden;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

.tab-container {
    display: flex;
    gap: 40px; /* Increased gap for better spacing */
    transition: transform 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
    will-change: transform;
    align-items: center;
}

.tab {
    border: 2px solid;
    color: white;
    padding: 20px 32px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 700;
    backdrop-filter: blur(12px);
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
    width: 280px; /* Fixed width */
    justify-content: center;
    opacity: 0.4;
    transform: scale(0.8);
    filter: blur(1.5px);
}

.tab.active {
    opacity: 1;
    transform: scale(1);
    filter: blur(0);
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.3);
    z-index: 10;
}

/* Enhanced Tab Carousel with Scroll Support */
.tab-carousel {
    position: relative;
    margin-bottom: 32px;
    padding: 20px 80px;
    border-radius: 30px;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 2px solid var(--glass-border);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: grab; /* Indicate scrollable */
}

.tab-carousel:active {
    cursor: grabbing;
}

/* Page Transition Animations */
.page {
    display: none;
    opacity: 0;
    transform: translateY(24px);
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.page.active {
    display: block;
    opacity: 1;
    transform: translateY(0);
}

.page.transitioning-out {
    opacity: 0;
    transform: translateY(-24px);
}

.page.transitioning-in {
    opacity: 0;
    transform: translateY(24px);
}

/* Enhanced Progress Button Animation */
.progress-view-button {
    position: absolute;
    top: 20px;
    right: 20px;
    background: var(--accent-blue);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 16px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    opacity: 0;
    transform: translateY(-10px) scale(0.9);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 16px rgba(37, 99, 235, 0.3);
    display: flex;
    align-items: center;
    gap: 8px;
}

.progress-view-button:active {
    transform: translateY(-8px) scale(0.95);
}

/* Dynamic Completed Tab Animation */
.completed-tab-container {
    position: relative;
    overflow: hidden;
    margin-bottom: 16px;
}

.completed-tab {
    background: linear-gradient(135deg, var(--accent-green) 0%, #047857 100%);
    border: 2px solid var(--accent-green);
    color: white;
    padding: 16px 28px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 700;
    backdrop-filter: blur(12px);
    position: relative;
    overflow: hidden;
    justify-content: center;
    transform: translateY(-100%);
    opacity: 0;
    margin-bottom: 0;
}

.completed-tab.show {
    transform: translateY(0);
    opacity: 1;
}

.completed-tab.active {
    box-shadow: 0 12px 32px rgba(5, 150, 105, 0.4);
    transform: translateY(0) scale(1.05);
}

.completed-tab:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 16px 36px rgba(5, 150, 105, 0.5);
}

/* Smooth card filtering animation */
.revision-card-mini.filtering-out {
    opacity: 0;
    transform: scale(0.8) translateY(-20px);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.revision-card-mini.filtering-in {
    opacity: 1;
    transform: scale(1) translateY(0);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Functional Settings Styles */
.settings-control {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-top: 12px;
}

.settings-select {
    padding: 10px 16px;
    border: 2px solid var(--border-color);
    border-radius: 12px;
    background: var(--bg-secondary);
    color: var(--text-primary);
    font-weight: 600;
    transition: all 0.3s ease;
    cursor: pointer;
}

.settings-select:hover, .settings-select:focus {
    border-color: var(--accent-blue);
    outline: none;
}

.settings-toggle {
    position: relative;
    width: 60px;
    height: 30px;
    background: var(--border-color);
    border-radius: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.settings-toggle.active {
    background: var(--accent-blue);
}

.settings-toggle::after {
    content: '';
    position: absolute;
    top: 3px;
    left: 3px;
    width: 24px;
    height: 24px;
    background: white;
    border-radius: 50%;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.settings-toggle.active::after {
    transform: translateX(30px);
}

.theme-selector {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-top: 12px;
}

.theme-option {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    cursor: pointer;
    border: 3px solid transparent;
    transition: all 0.3s ease;
}

.theme-option.active {
    border-color: var(--accent-blue);
    transform: scale(1.1);
}

.theme-blue { background: linear-gradient(135deg, #2563eb, #3b82f6); }
.theme-green { background: linear-gradient(135deg, #059669, #10b981); }
.theme-purple { background: linear-gradient(135deg, #7c3aed, #8b5cf6); }
.theme-orange { background: linear-gradient(135deg, #ea580c, #f97316); }
.theme-pink { background: linear-gradient(135deg, #db2777, #ec4899); }
.theme-dark { background: linear-gradient(135deg, #374151, #4b5563); }

/* Enhanced Notification System */
.notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 2000;
    display: flex;
    flex-direction: column;
    gap: 12px;
    pointer-events: none;
}

.notification {
    background: var(--glass-bg);
    border: 2px solid var(--glass-border);
    border-radius: 16px;
    padding: 16px 20px;
    min-width: 300px;
    box-shadow: var(--shadow-xl);
    backdrop-filter: blur(20px);
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 600;
    pointer-events: all;
    
    /* Animation properties */
    opacity: 0;
    transform: translateX(100%) scale(0.9);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.notification.show {
    opacity: 1;
    transform: translateX(0) scale(1);
}

.notification.hide {
    opacity: 0;
    transform: translateX(100%) scale(0.8);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.6, 1);
}

.notification.success {
    border-color: var(--accent-green);
    color: var(--accent-green);
    background: rgba(5, 150, 105, 0.1);
}

.notification.error {
    border-color: var(--accent-red);
    color: var(--accent-red);
    background: rgba(220, 38, 38, 0.1);
}

.notification-progress {
    position: absolute;
    bottom: 0;
    left: 0;
    height: 3px;
    background: currentColor;
    border-radius: 0 0 14px 14px;
    opacity: 0.3;
    animation: notificationProgress 4s linear forwards;
}

@keyframes notificationProgress {
    from { width: 100%; }
    to { width: 0%; }
}

/* Theme transition overlay */
.theme-transition-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg-primary);
    z-index: 10000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
}

.theme-transition-overlay.active {
    opacity: 0.9;
    visibility: visible;
}

/* Enhanced Tab Styling for Better Readability */
.tab {
    border: 2px solid;
    color: white;
    padding: 20px 32px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 700;
    backdrop-filter: blur(12px);
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
    width: 280px;
    justify-content: center;
    opacity: 0.4;
    transform: scale(0.8);
    filter: blur(1.5px);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3); /* Add text shadow for readability */
}

.tab.active {
    opacity: 1;
    transform: scale(1);
    filter: blur(0);
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.3);
    z-index: 10;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.4); /* Stronger shadow for active tab */
}

/* Enhanced tab colors with better contrast */
.tab.color-1 { 
    background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); 
    border-color: #3b82f6; 
    color: #ffffff;
}
.tab.color-2 { 
    background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%); 
    border-color: #7c3aed; 
    color: #ffffff;
}
.tab.color-3 { 
    background: linear-gradient(135deg, #059669 0%, #047857 100%); 
    border-color: #059669; 
    color: #ffffff;
}
.tab.color-4 { 
    background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%); 
    border-color: #ea580c; 
    color: #ffffff;
}

/* Dark theme adjustments for tabs */
[data-theme="black"] .tab {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}

[data-theme="black"] .tab.active {
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.6);
}

/* Light theme adjustments for tabs */
[data-theme="white"] .tab {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

[data-theme="white"] .tab.active {
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.2);
}

/* Past Papers Management Styles */
.past-papers-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 16px;
    margin-top: 16px;
}

.past-paper-slot {
    background: var(--glass-bg);
    border: 2px dashed var(--border-color);
    border-radius: 16px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    min-height: 120px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 12px;
}

.past-paper-slot:hover {
    border-color: var(--accent-blue);
    background: var(--accent-blue-light);
    transform: translateY(-2px);
}

.past-paper-slot.filled {
    border-style: solid;
    border-color: var(--accent-green);
    background: rgba(5, 150, 105, 0.05);
}

.past-paper-info {
    display: flex;
    flex-direction: column;
    gap: 8px;
    width: 100%;
}

.past-paper-subject {
    font-weight: 700;
    color: var(--accent-blue);
    font-size: 1.1rem;
}

.past-paper-file {
    font-size: 0.9rem;
    color: var(--text-secondary);
    word-break: break-all;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
}

.past-paper-remove {
    background: var(--accent-red);
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.past-paper-remove:hover {
    background: #b91c1c;
    transform: scale(1.05);
}

/* Enhanced Past Papers Display */
.past-papers-section {
    margin-top: 40px;
    padding-top: 32px;
    border-top: 3px solid var(--border-color);
}

.past-papers-container {
    background: var(--glass-bg);
    border: 2px solid var(--glass-border);
    border-radius: 24px;
    padding: 32px;
    margin-bottom: 20px;
    backdrop-filter: blur(20px);
    box-shadow: var(--shadow-md);
    transition: all 0.3s ease;
}

.past-papers-container:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.past-papers-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 24px;
    color: var(--accent-blue);
    font-size: 1.5rem;
    font-weight: 800;
}

.past-papers-grid-display {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 20px;
}

.past-paper-card {
    background: var(--bg-secondary);
    border: 2px solid var(--border-color);
    border-radius: 20px;
    padding: 20px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    gap: 16px;
    position: relative;
    overflow: hidden;
}

.past-paper-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--gradient-overlay);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.past-paper-card:hover {
    transform: translateY(-6px);
    box-shadow: var(--shadow-xl);
    border-color: var(--accent-blue);
}

.past-paper-card:hover::before {
    opacity: 1;
}

.past-paper-card-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 16px;
}

.past-paper-card-content {
    flex: 1;
}

.past-paper-card-title {
    font-weight: 700;
    color: var(--text-primary);
    font-size: 1.2rem;
    margin-bottom: 8px;
    line-height: 1.3;
}

.past-paper-card-subject {
    background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-blue-hover) 100%);
    color: white;
    padding: 6px 16px;
    border-radius: 16px;
    font-size: 0.85rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    flex-shrink: 0;
}

.past-paper-card-path {
    color: var(--text-muted);
    font-size: 0.9rem;
    word-break: break-all;
    background: var(--calendar-day);
    padding: 12px;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    font-family: 'Courier New', monospace;
}

.past-paper-card-icon {
    position: absolute;
    top: 16px;
    right: 16px;
    color: var(--accent-blue);
    opacity: 0.7;
    transition: all 0.3s ease;
}

.past-paper-card:hover .past-paper-card-icon {
    opacity: 1;
    transform: scale(1.1);
}

/* Empty state for no past papers */
.no-past-papers {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-muted);
    font-style: italic;
}
    </style>
</head>
<body>
    <!-- Sidebar Trigger Area -->
    <div class="sidebar-trigger" onmouseenter="openSidebar()"></div>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

    <!-- Sidebar -->
    <div class="sidebar" id="sidebar" onmouseleave="handleSidebarLeave()">
        <div class="sidebar-header">
            <h2>
                <svg class="icon icon-lg" viewBox="0 0 24 24">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9,22 9,12 15,12 15,22"/>
                </svg>
                Navigation
            </h2>
        </div>
        <nav class="sidebar-nav">
            <a href="#" class="sidebar-item active" onclick="showPage('home')">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9,22 9,12 15,12 15,22"/>
                </svg>
                Home
            </a>
            <a href="#" class="sidebar-item" onclick="showPage('dashboard')">
                <svg class="icon" viewBox="0 0 24 24">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                </svg>
                Dashboard
            </a>
            <a href="#" class="sidebar-item" onclick="showPage('progress')">
                <svg class="icon" viewBox="0 0 24 24">
                    <line x1="18" y1="20" x2="18" y2="10"/>
                    <line x1="12" y1="20" x2="12" y2="4"/>
                    <line x1="6" y1="20" x2="6" y2="14"/>
                </svg>
                Progress
            </a>
            <a href="#" class="sidebar-item" onclick="showPage('settings')">
                <svg class="icon" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
                Settings
            </a>
        </nav>
    </div>

    <div class="container" id="container">
        <!-- Header -->
        <header class="header">
            <h1>GCSE Revision Planner</h1>
        </header>

        <!-- Home Page -->
<div id="home" class="page active">
    <div class="card">
        <h2 style="color: var(--accent-blue); margin-bottom: 24px; font-size: 1.8rem; font-weight: 800;">Create Your Revision Schedule</h2>
        <form onsubmit="generateSchedule(event)">
            <div class="input-group">
                <label for="subjects">Enter your GCSE subjects (comma-separated):</label>
                <input 
                    type="text" 
                    id="subjects" 
                    placeholder="e.g., English Literature, Mathematics, Biology, Chemistry, History" 
                    required 
                />
            </div>
            <button type="submit" class="btn-primary" id="generateBtn">
                <svg class="icon" viewBox="0 0 24 24">
                    <polygon points="13,2 3,14 12,14 11,22 21,10 12,10 13,2"/>
                </svg>
                Create Schedule
            </button>
        </form>
    </div>
</div>

        <!-- Dashboard Page -->
        <div id="dashboard" class="page">
            <div class="tab-carousel" id="scheduleTabsCarousel">
                <!-- Tabs will be dynamically added here -->
            </div>
            
            <!-- Loading Animation -->
            <div class="loading-container" id="loadingContainer">
                <h3 style="color: var(--accent-blue); margin-bottom: 24px; text-align: center; font-weight: 800; font-size: 1.6rem;">
                    Generating your personalized revision schedule...
                </h3>
                <div class="loading-grid" id="loadingGrid">
                    <!-- Loading cards will be generated here -->
                </div>
            </div>

            <!-- Schedule Content -->
            <div id="scheduleContent">
                <div class="empty-state">
                    <h3>No schedules created yet</h3>
                    <p>Go to the Home page to create your first revision schedule</p>
                </div>
            </div>
        </div>

        <!-- Progress Page -->
        <div id="progress" class="page">
            <div class="card">
                <h2 style="color: var(--accent-blue); margin-bottom: 24px; font-size: 1.8rem; font-weight: 800;">Your Progress</h2>
                <div id="progressContent">
                    <div class="empty-state">
                        <h3>No progress data yet</h3>
                        <p>Complete some revision tasks to see your progress here</p>
                    </div>
                </div>
            </div>
        </div>

       <!-- Settings Page -->
<div id="settings" class="page">
    <div class="card">
        <h2 style="color: var(--accent-blue); margin-bottom: 24px; font-size: 1.8rem; font-weight: 800;">Settings & Preferences</h2>
        
        <div class="settings-grid">
            <div class="settings-card">
                <h4>
                    <svg class="icon" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"/>
                        <polygon points="10,8 16,12 10,16 10,8"/>
                    </svg>
                    Study Sessions
                </h4>
                <p>Customize your default study session length and break intervals</p>
                <div class="settings-control">
                    <label style="color: var(--text-secondary); font-weight: 600;">Session Length:</label>
                    <select class="settings-select" id="sessionLength" onchange="updateSessionLength(this.value)">
                        <option value="30">30 minutes</option>
                        <option value="45" selected>45 minutes</option>
                        <option value="60">60 minutes</option>
                        <option value="90">90 minutes</option>
                    </select>
                </div>
                <div class="settings-control">
                    <label style="color: var(--text-secondary); font-weight: 600;">Break Length:</label>
                    <select class="settings-select" id="breakLength" onchange="updateBreakLength(this.value)">
                        <option value="5">5 minutes</option>
                        <option value="10" selected>10 minutes</option>
                        <option value="15">15 minutes</option>
                        <option value="20">20 minutes</option>
                    </select>
                </div>
            </div>

            <div class="settings-card">
                <h4>
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                    </svg>
                    Notifications
                </h4>
                <p>Set up reminders for your study sessions and break times</p>
                <div class="settings-control">
                    <label style="color: var(--text-secondary); font-weight: 600;">Study Reminders:</label>
                    <div class="settings-toggle" id="studyNotifications" onclick="toggleNotifications('study')"></div>
                </div>
                <div class="settings-control">
                    <label style="color: var(--text-secondary); font-weight: 600;">Break Reminders:</label>
                    <div class="settings-toggle" id="breakNotifications" onclick="toggleNotifications('break')"></div>
                </div>
            </div>

            <div class="settings-card">
                <h4>
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7,10 12,15 17,10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Export Data
                </h4>
                <p>Download your schedules and progress as PDF or CSV files</p>
                <div class="settings-control">
                    <button class="btn-secondary" onclick="exportData('csv')">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                        </svg>
                        Export CSV
                    </button>
                    <button class="btn-secondary" onclick="exportData('json')">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                        </svg>
                        Export JSON
                    </button>
                </div>
            </div>

            <div class="settings-card">
    <h4>
        <svg class="icon" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="3"/>
            <path d="M12 1v6m0 6v6"/>
            <path d="M1 12h6m6 0h6"/>
        </svg>
        Theme Options
    </h4>
    <p>Choose between Light or Dark theme</p>
    <div class="theme-selector">
        <div class="theme-option theme-white active" onclick="changeTheme('white')" title="Light Theme">
            <div style="width: 100%; height: 100%; border-radius: 9px; background: linear-gradient(135deg, #ffffff 0%, #f3f4f6 100%); display: flex; align-items: center; justify-content: center; color: #374151; font-weight: 800; font-size: 10px;">Light</div>
        </div>
        <div class="theme-option theme-black" onclick="changeTheme('black')" title="Dark Theme">
            <div style="width: 100%; height: 100%; border-radius: 9px; background: linear-gradient(135deg, #0f172a 0%, #334155 100%); display: flex; align-items: center; justify-content: center; color: #f1f5f9; font-weight: 800; font-size: 10px;">Dark</div>
        </div>
    </div>
</div>

            <div class="settings-card">
                <h4>
                    <svg class="icon" viewBox="0 0 24 24">
                        <polyline points="23 4 23 10 17 10"/>
                        <polyline points="1 20 1 14 7 14"/>
                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                    </svg>
                    Backup & Sync
                </h4>
                <p>Sync your data across devices and create automatic backups</p>
                <div class="settings-control">
                    <button class="btn-secondary" onclick="createBackup()">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17,8 12,3 7,8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        Create Backup
                    </button>
                    <button class="btn-secondary" onclick="restoreBackup()">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M3 15v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4"/>
                            <polyline points="7,10 12,15 17,10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Restore Backup
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add this as a new settings card -->
<div class="settings-card">
    <h4>
        
    </h4>
        <!-- Past paper slots will be generated here -->
    </div>
</div>

    <!-- Dropdown overlay for closing when clicking outside -->
    <div id="dropdownOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 999; display: none;" onclick="closeAllDropdowns()"></div>

    <script>
        // Enhanced Global Application State
let appState = {
    schedules: {},
    activeSchedule: null,
    currentPage: 'home',
    currentTabIndex: 0,
    visibleTabCount: 2,
    showingCompleted: false,
    isInitialized: false
};

// Comprehensive Past Papers Data with Multiple URLs and Alternative Names
let pastPapersData = {
    // Mathematics variants
    mathematics: [
        'https://cdn.sanity.io/files/p28bar15/green/81f858bbcacde1898015f88a8b3fdfec08453a75.pdf',
        'https://filesamples.com/samples/document/pdf/sample3.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
        'https://filesamples.com/samples/document/pdf/sample1.pdf'
    ],
    maths: [
        'https://cdn.sanity.io/files/p28bar15/green/81f858bbcacde1898015f88a8b3fdfec08453a75.pdf',
        'https://filesamples.com/samples/document/pdf/sample3.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
        'https://filesamples.com/samples/document/pdf/sample1.pdf'
    ],
    
    // English variants
    english: [
        'https://filesamples.com/samples/document/pdf/sample2.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
        'https://filesamples.com/samples/document/pdf/sample1.pdf'
    ],
    'english literature': [
        'https://filesamples.com/samples/document/pdf/sample2.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    'english language': [
        'https://cdn.sanity.io/files/p28bar15/green/28842ff0d169e821a8ef19ba98a123c2454f2ff6.pdf',
        'https://filestore.aqa.org.uk/sample-papers-and-mark-schemes/2023/june/AQA-87002-QP-JUN23.PDF'
    ],
    
    // Science subjects
    biology: [
        'https://filesamples.com/samples/document/pdf/sample3.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
        'https://filesamples.com/samples/document/pdf/sample2.pdf'
    ],
    bio: [
        'https://filesamples.com/samples/document/pdf/sample3.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    
    chemistry: [
        'https://filesamples.com/samples/document/pdf/sample1.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
        'https://filesamples.com/samples/document/pdf/sample3.pdf'
    ],
    chem: [
        'https://filesamples.com/samples/document/pdf/sample1.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    
    physics: [
        'https://filesamples.com/samples/document/pdf/sample2.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
        'https://filesamples.com/samples/document/pdf/sample1.pdf'
    ],
    
    // Humanities
    history: [
        'https://filesamples.com/samples/document/pdf/sample3.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
        'https://filesamples.com/samples/document/pdf/sample2.pdf'
    ],
    
    geography: [
        'https://filesamples.com/samples/document/pdf/sample1.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
        'https://filesamples.com/samples/document/pdf/sample3.pdf'
    ],
    geo: [
        'https://filesamples.com/samples/document/pdf/sample1.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    
    // Technology and Arts
    'computer science': [
        'https://filesamples.com/samples/document/pdf/sample2.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    'computing': [
        'https://filesamples.com/samples/document/pdf/sample2.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    'ict': [
        'https://filesamples.com/samples/document/pdf/sample3.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    
    art: [
        'https://filesamples.com/samples/document/pdf/sample1.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    'art and design': [
        'https://filesamples.com/samples/document/pdf/sample1.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    
    // Languages
    french: [
        'https://filesamples.com/samples/document/pdf/sample2.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    spanish: [
        'https://filesamples.com/samples/document/pdf/sample3.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    german: [
        'https://filesamples.com/samples/document/pdf/sample1.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    
    // Other subjects
    'religious studies': [
        'https://filesamples.com/samples/document/pdf/sample2.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    'rs': [
        'https://filesamples.com/samples/document/pdf/sample2.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    
    'business studies': [
        'https://filesamples.com/samples/document/pdf/sample3.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    'business': [
        'https://filesamples.com/samples/document/pdf/sample3.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    
    psychology: [
        'https://filesamples.com/samples/document/pdf/sample1.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    
    sociology: [
        'https://filesamples.com/samples/document/pdf/sample2.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    
    drama: [
        'https://filesamples.com/samples/document/pdf/sample3.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    
    music: [
        'https://filesamples.com/samples/document/pdf/sample1.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    
    'physical education': [
        'https://filesamples.com/samples/document/pdf/sample2.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ],
    'pe': [
        'https://filesamples.com/samples/document/pdf/sample2.pdf',
        'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
    ]
};

// Missing variable declarations - ADD THESE
    let activeDropdown = null;
    let sidebarTimeout = null;
    let navigationTimeout = null;
    let isNavigating = false; // ADD THIS LINE

// Enhanced initialization with proper centering
document.addEventListener('DOMContentLoaded', function() {
    loadAppState();
    
    // Multi-stage initialization for proper centering
    setTimeout(() => {
        updateDashboard();
        updateProgress();
    }, 100);
    
    setTimeout(() => {
        if (Object.keys(appState.schedules).length > 0) {
            updateCenteredCarousel();
        }
        appState.isInitialized = true;
    }, 300);
    
    // Final centering check after all styles load
    window.addEventListener('load', function() {
        setTimeout(() => {
            if (Object.keys(appState.schedules).length > 0) {
                updateCenteredCarousel();
            }
        }, 500);
    });
});


        // Enhanced Sidebar Management
        function openSidebar() {
            clearTimeout(sidebarTimeout);
            document.getElementById('sidebar').classList.add('open');
            document.getElementById('container').classList.add('sidebar-open');
            document.getElementById('sidebarOverlay').classList.add('show');
        }

        function handleSidebarLeave() {
            sidebarTimeout = setTimeout(() => {
                // Only close if mouse is not over the trigger area
                const trigger = document.querySelector('.sidebar-trigger');
                const rect = trigger.getBoundingClientRect();
                const mouseX = event.clientX;
                if (mouseX > rect.right) {
                    closeSidebar();
                }
            }, 300);
        }

        function closeSidebar() {
            clearTimeout(sidebarTimeout);
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('container').classList.remove('sidebar-open');
            document.getElementById('sidebarOverlay').classList.remove('show');
        }

        // Enhanced page navigation with smooth transitions
function showPage(pageId) {
    const currentPage = document.querySelector('.page.active');
    const targetPage = document.getElementById(pageId);
    
    if (!targetPage || currentPage === targetPage) return;
    
    // Add transitioning out class to current page
    if (currentPage) {
        currentPage.classList.add('transitioning-out');
    }
    
    setTimeout(() => {
        // Hide current page
        if (currentPage) {
            currentPage.classList.remove('active', 'transitioning-out');
        }
        
        // Show target page with transition
        targetPage.classList.add('transitioning-in');
        targetPage.classList.add('active');
        
        setTimeout(() => {
            targetPage.classList.remove('transitioning-in');
        }, 50);
    }, 200);
    
    // Update sidebar active state
    document.querySelectorAll('.sidebar-item').forEach(item => {
        item.classList.remove('active');
    });
    
    const sidebarItem = document.querySelector(`[onclick="showPage('${pageId}')"]`);
    if (sidebarItem) {
        sidebarItem.closest('.sidebar-item').classList.add('active');
    }
    
    // Close sidebar on mobile
    if (window.innerWidth <= 768) {
        closeSidebar();
    }
    
    appState.currentPage = pageId;
    saveAppState();
}

// Enhanced view schedule from progress with smooth transition
function viewScheduleFromProgress(scheduleId) {
    // Add button press animation
    event.target.style.transform = 'translateY(-8px) scale(0.95)';
    
    setTimeout(() => {
        // Switch to that schedule
        appState.activeSchedule = scheduleId;
        appState.currentTabIndex = 0;
        saveAppState();
        
        // Navigate to dashboard with smooth transition
        showPage('dashboard');
        
        // Update dashboard after page transition
        setTimeout(() => {
            updateDashboard();
        }, 300);
        
        // Reset button animation
        event.target.style.transform = '';
    }, 150);
}

        // Fixed schedule generation with proper element checking
async function generateSchedule(event) {
    event.preventDefault();
    
    const subjectsInput = document.getElementById('subjects');
    const studyDetails = document.getElementById('studyDetails');
    
    // Check if elements exist before accessing their values
    if (!subjectsInput) {
        showAlert('Form elements not found. Please refresh the page.', 'error');
        return;
    }
    
    const subjectsValue = subjectsInput.value.trim();
    const studyDetailsValue = studyDetails ? studyDetails.value.trim() : '';
    
    if (!subjectsValue) {
        showAlert('Please enter your subjects', 'error');
        return;
    }
    
    const subjects = subjectsValue.split(',').map(s => s.trim()).filter(s => s);
    const scheduleId = `schedule_${Date.now()}`;
    
    // Switch to dashboard and show loading
    showDashboardWithLoading();
    
    // Create enhanced schedule
    createEnhancedSchedule(scheduleId, subjects);
    showAlert('Schedule created successfully!', 'success');
    
    setTimeout(() => {
        hideLoading();
        switchToSchedule(scheduleId);
    }, 1500);
    
    // Clear inputs safely
    subjectsInput.value = '';
    if (studyDetails) {
        studyDetails.value = '';
    }
}

        function showDashboardWithLoading() {
            // Switch to dashboard page
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById('dashboard').classList.add('active');
            
            // Update sidebar
            document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
            document.querySelector('[onclick="showPage(\'dashboard\')"]').closest('.sidebar-item').classList.add('active');
            
            // Show loading
            document.getElementById('loadingContainer').classList.add('show');
            document.getElementById('scheduleContent').innerHTML = '';
            
            // Generate loading cards
            const loadingGrid = document.getElementById('loadingGrid');
            loadingGrid.innerHTML = '';
            for (let i = 0; i < 6; i++) {
                const loadingCard = document.createElement('div');
                loadingCard.className = 'loading-card';
                loadingGrid.appendChild(loadingCard);
            }
        }

        function hideLoading() {
            document.getElementById('loadingContainer').classList.remove('show');
        }

        // Enhanced demo schedule creation with realistic variation
        function createEnhancedSchedule(scheduleId, subjects) {
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const times = ['09:00-10:00', '10:15-11:15', '11:30-12:30', '14:00-15:00', '15:15-16:15', '16:30-17:30', '19:00-20:00'];
            const difficulties = ['Easy', 'Medium', 'Hard'];
            
            const detailedTopics = {
                'Mathematics': [
                    'Quadratic Equations', 'Linear Equations', 'Algebraic Manipulation', 
                    'Trigonometry SOHCAHTOA', 'Pythagoras Theorem', 'Circle Theorems',
                    'Statistics', 'Sequences & Series', 'Simultaneous Equations',
                    'Indices & Surds', 'Factorisation', 'Graph Transformations'
                ],
                'English Literature': [
                    'Macbeth Analysis', 'Romeo & Juliet', 'Inspector Calls',
                    'Poetry Comparison', 'Language Techniques', 'Structure & Form',
                    'Historical Context', 'Quote Analysis', 'Essay Planning',
                    'Dramatic Irony', 'Symbolism', 'Writer\'s Methods'
                ],
                'Biology': [
                    'Cell Division', 'DNA Structure', 'Enzyme Activity',
                    'Photosynthesis', 'Respiratory System', 'Circulatory System',
                    'Inheritance', 'Evolution', 'Ecology Food Chains',
                    'Plant Transport', 'Nervous System', 'Hormones'
                ],
                'Chemistry': [
                    'Atomic Structure', 'Periodic Table', 'Chemical Bonding',
                    'Chemical Reactions', 'Acids & Bases', 'Metals',
                    'Organic Chemistry', 'Reaction Rates', 'Electrolysis',
                    'Gas Tests', 'Calculations', 'Environment'
                ],
                'Physics': [
                    'Forces & Motion', 'Energy Transfers', 'Wave Properties',
                    'Electricity', 'Magnetism', 'Radioactivity',
                    'Space', 'Pressure', 'Heat Transfer',
                    'Light & EM Spectrum', 'Motion Graphs', 'Power'
                ],
                'History': [
                    'WWI Causes', 'Russian Revolution', 'Nazi Germany',
                    'Cold War', 'Medieval Life', 'Industrial Revolution',
                    'American West', 'Medicine Progress', 'Weimar Republic',
                    'Hitler\'s Rise', 'Treaty of Versailles', 'Nazi Life'
                ],
                'Geography': [
                    'Plate Tectonics', 'Climate Change', 'River Landscapes',
                    'Coastal Management', 'Urban Issues', 'Development',
                    'Resource Management', 'Weather Hazards', 'Ecosystems',
                    'Economic Development', 'Population Change', 'Globalisation'
                ],
                'English Language': [
                    'Creative Writing', 'Text Analysis', 'Persuasive Writing',
                    'Grammar', 'Comprehension', 'Descriptive Writing',
                    'Argument', 'Language Devices', 'Text Structure',
                    'Audience & Purpose', 'Vocabulary', 'Proofreading'
                ],
                'Computer Science': [
                    'Algorithm Design', 'Programming Loops', 'Data Structures',
                    'Boolean Logic', 'Computer Systems', 'Networks',
                    'Database Design', 'Cybersecurity', 'Software Development',
                    'Binary Numbers', 'Computational Thinking', 'Debugging'
                ],
                'Art': [
                    'Observational Drawing', 'Colour Theory', 'Artist Study',
                    'Painting Techniques', 'Sculpture', 'Photography',
                    'Design Development', 'Cultural Context', 'Portfolio',
                    'Mixed Media', 'Critical Analysis', 'Exhibition'
                ]
            };
            
            // Get topics for subjects, with fallbacks for uncommon subjects
            const getTopicsForSubject = (subject) => {
                const normalizedSubject = Object.keys(detailedTopics).find(key => 
                    key.toLowerCase().includes(subject.toLowerCase()) || 
                    subject.toLowerCase().includes(key.toLowerCase())
                );
                return detailedTopics[normalizedSubject] || [
                    `${subject} Concepts`,
                    `${subject} Practice`,
                    `${subject} Techniques`,
                    `${subject} Analysis`,
                    `${subject} Theory`,
                    `${subject} Past Papers`
                ];
            };
            
            const weeklySchedule = {};
            let usedTopics = {};
            subjects.forEach(subj => usedTopics[subj] = []);
            
            days.forEach((day, dayIndex) => {
                weeklySchedule[day] = [];
                
                // Vary sessions per day (weekend lighter, weekdays heavier)
                let sessionsPerDay;
                if (day === 'Saturday' || day === 'Sunday') {
                    sessionsPerDay = Math.min(2, Math.max(1, Math.floor(subjects.length * 0.5)));
                } else {
                    sessionsPerDay = Math.min(3, Math.max(1, Math.floor(subjects.length * 0.8)));
                }
                
                // Create balanced subject rotation
                const daySubjects = [];
                for (let i = 0; i < sessionsPerDay; i++) {
                    daySubjects.push(subjects[(dayIndex * sessionsPerDay + i) % subjects.length]);
                }
                
                daySubjects.forEach((subject, sessionIndex) => {
                    const availableTopics = getTopicsForSubject(subject);
                    
                    // Avoid repeating topics too soon
                    const availableUnusedTopics = availableTopics.filter(topic => 
                        !usedTopics[subject].includes(topic)
                    );
                    
                    const topicsToChooseFrom = availableUnusedTopics.length > 0 ? 
                        availableUnusedTopics : availableTopics;
                    
                    const selectedTopic = topicsToChooseFrom[
                        Math.floor(Math.random() * topicsToChooseFrom.length)
                    ];
                    
                    // Track used topics
                    usedTopics[subject].push(selectedTopic);
                    if (usedTopics[subject].length > availableTopics.length * 0.7) {
                        usedTopics[subject] = []; // Reset when most topics used
                    }
                    
                    // Smart difficulty progression
                    let difficulty;
                    if (day === 'Saturday' || day === 'Sunday') {
                        difficulty = Math.random() < 0.6 ? 'Easy' : 'Medium';
                    } else {
                        difficulty = difficulties[Math.floor(Math.random() * difficulties.length)];
                    }
                    
                    weeklySchedule[day].push({
                        subject: subject,
                        topic: selectedTopic,
                        time: times[sessionIndex] || `${17 + sessionIndex}:00-${18 + sessionIndex}:00`,
                        difficulty: difficulty
                    });
                });
            });
            
            createRevisionScheduleFromData(scheduleId, subjects, weeklySchedule);
        }

        // Create Revision Schedule from Data
        function createRevisionScheduleFromData(scheduleId, subjects, scheduleData) {
            const schedule = {
                id: scheduleId,
                name: subjects.join(', '),
                subjects: subjects,
                weeklySchedule: scheduleData,
                created: new Date().toISOString(),
                completedTasks: {}
            };
            
            appState.schedules[scheduleId] = schedule;
            appState.activeSchedule = scheduleId;
            appState.currentTabIndex = 0; // Reset to first tab
            saveAppState();
            updateDashboard();
        }

        // Fixed Dashboard Management with proper initialization
function updateDashboard() {
    updateScheduleTabs();
    updateScheduleContent();
    
    // Ensure proper centering after DOM is fully rendered
    setTimeout(() => {
        updateCenteredCarousel();
    }, 100);
    
    // Double-check centering after styles are applied
    setTimeout(() => {
        updateCenteredCarousel();
    }, 300);
}

// Enhanced initialization for proper first load
document.addEventListener('DOMContentLoaded', function() {
    loadAppState();
    
    // Initialize with proper timing
    setTimeout(() => {
        updateDashboard();
        updateProgress();
    }, 150);
    
    // Ensure centering after everything loads
    window.addEventListener('load', function() {
        setTimeout(updateCenteredCarousel, 200);
    });
});

        function updateScheduleTabs() {
    const carousel = document.getElementById('scheduleTabsCarousel');
    
    if (Object.keys(appState.schedules).length === 0) {
        carousel.innerHTML = '';
        return;
    }
    
    // Create tabs for ALL schedules
    const allTabs = [];
    const scheduleEntries = Object.entries(appState.schedules);
    
    scheduleEntries.forEach(([scheduleId, schedule], scheduleIndex) => {
        // Ensure color assignment cycles through 1-4
        const colorIndex = (scheduleIndex % 4) + 1;
        
        allTabs.push({
            type: 'schedule',
            name: schedule.name.length > 25 ? schedule.name.substring(0, 25) + '...' : schedule.name,
            fullName: schedule.name,
            scheduleId: scheduleId,
            index: scheduleIndex,
            colorClass: `color-${colorIndex}`, // Ensure this always gets a value 1-4
            isActive: scheduleId === appState.activeSchedule
        });
    });
    
    // Create centered carousel structure
    let html = `
        <button class="carousel-nav prev" onclick="previousScheduleSmooth()">
            <svg class="icon" viewBox="0 0 24 24">
                <polyline points="15,18 9,12 15,6"/>
            </svg>
        </button>
        <div class="tab-viewport">
            <div class="tab-container" id="tabContainer">
    `;
    
    allTabs.forEach((tab, index) => {
        const isActive = tab.isActive;
        
        html += `
            <div class="tab ${tab.colorClass} ${isActive ? 'active' : ''}" 
                 onclick="selectScheduleDirectly('${tab.scheduleId}', ${index})" 
                 data-tab-type="${tab.type}" 
                 data-tab-name="${tab.fullName}"
                 data-schedule-id="${tab.scheduleId}"
                 data-tab-index="${index}"
                 title="${tab.fullName}">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                </svg>
                ${tab.name}
            </div>
        `;
    });
    
    html += `
            </div>
        </div>
        <button class="carousel-nav next" onclick="nextScheduleSmooth()">
            <svg class="icon" viewBox="0 0 24 24">
                <polyline points="9,18 15,12 9,6"/>
            </svg>
        </button>
    `;
    
    carousel.innerHTML = html;
    updateCenteredCarousel();
    
    // Initialize scroll wheel after tabs are created
    setTimeout(initializeScrollWheelNavigation, 100);
}

// Schedule selection with animation
function selectScheduleWithAnimation(scheduleId, index) {
    if (scheduleId === appState.activeSchedule) return;
    
    // Add transition class to content
    const contentContainer = document.querySelector('.schedule-grid-container');
    if (contentContainer) {
        contentContainer.classList.add('transitioning');
    }
    
    // Update active states
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    const newActiveTab = document.querySelector(`[data-schedule-id="${scheduleId}"]`);
    if (newActiveTab) {
        newActiveTab.classList.add('active');
    }
    
    // Update state and content
    setTimeout(() => {
        appState.activeSchedule = scheduleId;
        appState.currentTabIndex = index;
        saveAppState();
        updateScheduleContent();
        updateTabCarousel();
        
        // Remove transition class
        if (contentContainer) {
            contentContainer.classList.remove('transitioning');
        }
    }, 150);
}

// Scroll wheel navigation support
function initializeScrollWheelNavigation() {
    const carousel = document.getElementById('scheduleTabsCarousel');
    if (!carousel) return;
    
    let isScrolling = false;
    
    carousel.addEventListener('wheel', function(e) {
        e.preventDefault();
        
        // Throttle scroll events
        if (isScrolling) return;
        isScrolling = true;
        
        const delta = e.deltaY;
        
        // Scroll down = next, scroll up = previous
        if (delta > 0) {
            nextScheduleSmooth();
        } else {
            previousScheduleSmooth();
        }
        
        // Reset throttle after animation
        setTimeout(() => {
            isScrolling = false;
        }, 800);
    }, { passive: false });
}

// Fixed smooth navigation without glitches
function previousScheduleSmooth() {
    if (isNavigating) return;
    isNavigating = true;
    
    const schedules = Object.keys(appState.schedules);
    if (schedules.length <= 1) {
        isNavigating = false;
        return;
    }
    
    const currentIndex = schedules.indexOf(appState.activeSchedule);
    const newIndex = currentIndex === 0 ? schedules.length - 1 : currentIndex - 1;
    const newScheduleId = schedules[newIndex];
    
    selectScheduleDirectly(newScheduleId, newIndex);
}

function nextScheduleSmooth() {
    if (isNavigating) return;
    isNavigating = true;
    
    const schedules = Object.keys(appState.schedules);
    if (schedules.length <= 1) {
        isNavigating = false;
        return;
    }
    
    const currentIndex = schedules.indexOf(appState.activeSchedule);
    const newIndex = currentIndex === schedules.length - 1 ? 0 : currentIndex + 1;
    const newScheduleId = schedules[newIndex];
    
    selectScheduleDirectly(newScheduleId, newIndex);
}

function selectScheduleDirectly(scheduleId, index) {
    if (scheduleId === appState.activeSchedule) {
        isNavigating = false;
        return;
    }
    
    // Start content transition
    const contentContainer = document.querySelector('.schedule-grid-container');
    if (contentContainer) {
        contentContainer.classList.add('transitioning');
    }
    
    // Update state
    appState.activeSchedule = scheduleId;
    appState.currentTabIndex = index;
    saveAppState();
    
    // Update visual states immediately
    updateTabStates();
    updateCenteredCarousel();
    
    // Update content after carousel animation
    setTimeout(() => {
        updateScheduleContent();
        
        setTimeout(() => {
            if (contentContainer) {
                contentContainer.classList.remove('transitioning');
            }
            isNavigating = false;
        }, 100);
    }, 400);
}

// Infinite smooth transition
function selectScheduleWithInfiniteTransition(scheduleId, index, direction = 'next') {
    if (scheduleId === appState.activeSchedule) {
        isNavigating = false;
        return;
    }
    
    // Start content transition
    const contentContainer = document.querySelector('.schedule-grid-container');
    if (contentContainer) {
        contentContainer.classList.add('transitioning');
    }
    
    // Update state
    appState.activeSchedule = scheduleId;
    appState.currentTabIndex = index;
    saveAppState();
    
    // Handle infinite rotation visual effect
    const container = document.getElementById('tabContainer');
    const tabs = container.querySelectorAll('.tab');
    
    // Update visual states immediately
    updateTabStates();
    
    // Apply centering with seamless infinite rotation
    const schedules = Object.keys(appState.schedules);
    const tabWidth = 320;
    const currentOffset = index * tabWidth;
    
    // For infinite rotation, handle wrapping
    let targetOffset = currentOffset;
    
    if (direction === 'next' && index === 0) {
        // Going from last to first - animate forward then snap back
        const tempOffset = schedules.length * tabWidth;
        container.style.transition = 'transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1)';
        container.style.transform = `translateX(-${tempOffset - (tabWidth * 0.5)}px)`;
        
        setTimeout(() => {
            container.style.transition = 'none';
            container.style.transform = `translateX(-${targetOffset - (tabWidth * 0.5)}px)`;
            setTimeout(() => {
                container.style.transition = 'transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1)';
            }, 50);
        }, 600);
        
    } else if (direction === 'prev' && index === schedules.length - 1) {
        // Going from first to last - animate backward then snap forward
        const tempOffset = -tabWidth;
        container.style.transition = 'transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1)';
        container.style.transform = `translateX(-${tempOffset - (tabWidth * 0.5)}px)`;
        
        setTimeout(() => {
            container.style.transition = 'none';
            container.style.transform = `translateX(-${targetOffset - (tabWidth * 0.5)}px)`;
            setTimeout(() => {
                container.style.transition = 'transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1)';
            }, 50);
        }, 600);
        
    } else {
        // Normal transition
        updateCenteredCarousel();
    }
    
    // Update content after carousel animation
    setTimeout(() => {
        updateScheduleContent();
        
        setTimeout(() => {
            if (contentContainer) {
                contentContainer.classList.remove('transitioning');
            }
            isNavigating = false;
        }, 100);
    }, 300);
}

// Update tab visual states
function updateTabStates() {
    const tabs = document.querySelectorAll('.tab');
    const schedules = Object.keys(appState.schedules);
    const currentIndex = schedules.indexOf(appState.activeSchedule);
    
    tabs.forEach((tab, index) => {
        // Remove all state classes
        tab.classList.remove('active', 'prev-tab', 'next-tab');
        
        // Add appropriate class based on position
        if (index === currentIndex) {
            tab.classList.add('active');
        } else if (index === currentIndex - 1 || (currentIndex === 0 && index === tabs.length - 1)) {
            tab.classList.add('prev-tab');
        } else if (index === currentIndex + 1 || (currentIndex === tabs.length - 1 && index === 0)) {
            tab.classList.add('next-tab');
        }
    });
}

// Simplified centered carousel positioning
function updateCenteredCarousel() {
    const container = document.getElementById('tabContainer');
    const viewport = container?.parentElement;
    if (!container || !viewport) return;
    
    const tabs = container.querySelectorAll('.tab');
    const schedules = Object.keys(appState.schedules);
    const currentIndex = schedules.indexOf(appState.activeSchedule);
    
    if (tabs.length === 0 || currentIndex === -1) return;
    
    // Simple centering calculation
    const tabWidth = 320; // tab width + gap
    const viewportCenter = viewport.offsetWidth / 2;
    const activeTabPosition = (currentIndex * tabWidth) + (280 / 2); // 280 = actual tab width
    const offset = activeTabPosition - viewportCenter;
    
    container.style.transform = `translateX(-${Math.max(0, offset)}px)`;
}

// Replace the old updateTabCarousel function with this
function updateTabCarousel() {
    updateCenteredCarousel();
}

// Add smooth entrance animation for new tabs - PUT IT HERE
function animateTabEntrance(tabElement) {
    tabElement.classList.add('entering');
    setTimeout(() => {
        tabElement.classList.remove('entering');
    }, 500);
}

// Legacy function compatibility
function selectTab(index) {
    selectTabWithAnimation(index);
}

        // Smooth tab selection with animation
function selectTabWithAnimation(index) {
    if (index === appState.currentTabIndex) return;
    
    // Add transition class to content
    const contentContainer = document.querySelector('.schedule-grid-container');
    if (contentContainer) {
        contentContainer.classList.add('transitioning');
    }
    
    // Update active states with animation
    const currentActiveTab = document.querySelector('.tab.active');
    const newActiveTab = document.querySelector(`[data-tab-index="${index}"]`);
    
    if (currentActiveTab) {
        currentActiveTab.classList.remove('active');
    }
    
    if (newActiveTab) {
        newActiveTab.classList.add('active');
    }
    
    // Update state and content after a brief delay for smooth transition
    setTimeout(() => {
        appState.currentTabIndex = index;
        saveAppState();
        updateScheduleContent();
        updateTabCarousel();
        
        // Remove transition class
        if (contentContainer) {
            contentContainer.classList.remove('transitioning');
        }
    }, 150);
}

// Enhanced previous tab with smooth animation
function previousTab() {
    if (appState.currentTabIndex > 0) {
        selectTabWithAnimation(appState.currentTabIndex - 1);
    }
}

// Enhanced next tab with smooth animation
function nextTab() {
    const container = document.getElementById('tabContainer');
    const tabs = container.querySelectorAll('.tab');
    const maxIndex = tabs.length - 1;
    
    if (appState.currentTabIndex < maxIndex) {
        selectTabWithAnimation(appState.currentTabIndex + 1);
    }
}

        function updateScheduleContent() {
    const content = document.getElementById('scheduleContent');
    
    if (!appState.activeSchedule || !appState.schedules[appState.activeSchedule]) {
        content.innerHTML = `
            <div class="empty-state">
                <h3>No schedules created yet</h3>
                <p>Go to the Home page to create your first revision schedule</p>
            </div>
        `;
        return;
    }
    
    const schedule = appState.schedules[appState.activeSchedule];
    const today = new Date();
    const currentDay = today.getDay();
    const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    const dayOrder = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    
    // Check if there are completed tasks
    const hasCompletedTasks = Object.values(schedule.completedTasks).some(completed => completed);
    
    // Set CSS variable for dynamic grid sizing
    document.documentElement.style.setProperty('--subject-count', schedule.subjects.length);
    
    let html = '';
    
    // Add completed tab if there are completed tasks
    if (hasCompletedTasks) {
        html += `
            <div class="completed-tab-container">
                <div class="completed-tab ${appState.showingCompleted ? 'active show' : 'show'}" 
                     onclick="toggleCompletedView()" id="completedTab">
                    <svg class="icon" viewBox="0 0 24 24">
                        <polyline points="20,6 9,17 4,12"/>
                    </svg>
                    ${appState.showingCompleted ? 'Show All Tasks' : 'Show Completed Only'}
                </div>
            </div>
        `;
    }
    
    // Create grid layout
    html += `
        <div class="schedule-grid-container" id="scheduleGrid">
            <div class="schedule-grid">
                <!-- Empty corner cell -->
                <div class="grid-header"></div>
    `;
    
    // Add day headers
    dayOrder.forEach(day => {
        const isToday = days[currentDay] === day;
        html += `<div class="grid-header ${isToday ? 'today' : ''}">${day}</div>`;
    });
    
    // Add subject rows
    schedule.subjects.forEach(subject => {
        // Subject label
        html += `<div class="subject-label">${subject}</div>`;
        
        // Add cells for each day
        dayOrder.forEach(day => {
            const isToday = days[currentDay] === day;
            const dayTasks = schedule.weeklySchedule[day] || [];
            
            // Filter tasks for this subject
            let filteredTasks = dayTasks.filter(task => task.subject === subject);
            
            html += `<div class="schedule-cell ${isToday ? 'today' : ''}" data-subject="${subject}" data-day="${day}">`;
            
            filteredTasks.forEach((task, taskIndex) => {
                // Find the original task index for proper ID generation
                const originalIndex = dayTasks.findIndex(t => 
                    t.subject === task.subject && 
                    t.topic === task.topic && 
                    t.time === task.time
                );
                const taskId = `${schedule.id}_${day}_${originalIndex}`;
                const isCompleted = schedule.completedTasks[taskId] || false;
                
                html += `
                    <div class="revision-card-mini ${isCompleted ? 'completed' : ''}" 
                         data-task-id="${taskId}" 
                         data-completed="${isCompleted}"
                         onclick="event.stopPropagation();">
                        <div class="revision-card-mini-content">
                            <div class="revision-card-mini-title">${task.subject}</div>
                            <div class="revision-card-mini-topic">${task.topic}</div>
                            <div class="revision-card-mini-meta">
                                <span>${task.time}</span>
                                <span>${task.difficulty}</span>
                            </div>
                        </div>
                        <div class="revision-card-mini-menu" onclick="event.stopPropagation(); toggleDropdown(event, '${taskId}', ${isCompleted})">
                            <svg class="icon" viewBox="0 0 24 24" style="width: 10px; height: 10px;">
                                <circle cx="12" cy="12" r="1"/>
                                <circle cx="12" cy="5" r="1"/>
                                <circle cx="12" cy="19" r="1"/>
                            </svg>
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
        });
    });
    
    html += `
            </div>
        </div>
    `;

    // Add past papers section if relevant papers exist
    const relevantPapers = getRelevantPastPapers();
    if (Object.keys(relevantPapers).length > 0) {
        html += `
            <div class="past-papers-section">
                <div class="past-papers-container">
                    <div class="past-papers-header">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10,9 9,9 8,9"/>
                        </svg>
                        Available Past Papers
                    </div>
                    <div class="past-papers-grid-display">
        `;
        
        Object.entries(relevantPapers).forEach(([subject, papers]) => {
            papers.forEach((paperPath, index) => {
                const fileName = paperPath.split('/').pop() || paperPath;
                html += `
                    <div class="past-paper-card" onclick="openPastPaper('${paperPath}')">
                        <div class="past-paper-card-header">
                            <div class="past-paper-card-title">${fileName}</div>
                            <div class="past-paper-card-subject">${subject}</div>
                        </div>
                        <div class="past-paper-card-path">${paperPath}</div>
                    </div>
                `;
            });
        });
        
        html += `
                    </div>
                </div>
            </div>
        `;
    }
    
    content.innerHTML = html;
    
    // Apply filtering if showing completed only
    if (appState.showingCompleted) {
        filterCompletedTasks(false);
    }
}

// Function to handle opening past papers
function openPastPaper(paperPath) {
    // Try to open the file
    try {
        // For local files, create a link element
        if (paperPath.startsWith('http://') || paperPath.startsWith('https://')) {
            window.open(paperPath, '_blank');
        } else {
            // For local file paths, attempt to open
            const link = document.createElement('a');
            link.href = paperPath;
            link.target = '_blank';
            link.click();
        }
        showAlert('Opening past paper...', 'success');
    } catch (error) {
        showAlert('Could not open past paper. Please check the file path.', 'error');
        console.error('Error opening past paper:', error);
    }
}

// Toggle completed view function
function toggleCompletedView() {
    appState.showingCompleted = !appState.showingCompleted;
    saveAppState();
    
    const completedTab = document.getElementById('completedTab');
    if (completedTab) {
        completedTab.innerHTML = `
            <svg class="icon" viewBox="0 0 24 24">
                <polyline points="20,6 9,17 4,12"/>
            </svg>
            ${appState.showingCompleted ? 'Show All Tasks' : 'Show Completed Only'}
        `;
        
        completedTab.classList.toggle('active', appState.showingCompleted);
    }
    
    filterCompletedTasks(true);
}

// Smooth filtering function
function filterCompletedTasks(animate = true) {
    const cards = document.querySelectorAll('.revision-card-mini');
    
    cards.forEach((card, index) => {
        const isCompleted = card.dataset.completed === 'true';
        const shouldShow = appState.showingCompleted ? isCompleted : true;
        
        if (animate) {
            // Add staggered animation delay
            setTimeout(() => {
                if (shouldShow) {
                    card.classList.remove('filtering-out');
                    card.classList.add('filtering-in');
                    card.style.display = 'flex';
                } else {
                    card.classList.remove('filtering-in');
                    card.classList.add('filtering-out');
                    setTimeout(() => {
                        card.style.display = 'none';
                    }, 400);
                }
            }, index * 50);
        } else {
            // Instant filtering
            if (shouldShow) {
                card.style.display = 'flex';
                card.classList.add('filtering-in');
            } else {
                card.style.display = 'none';
            }
        }
    });
}

// Enhanced task completion with completed tab management
function toggleTaskComplete(taskId) {
    const schedule = appState.schedules[appState.activeSchedule];
    if (!schedule) return;
    
    const wasCompleted = schedule.completedTasks[taskId];
    schedule.completedTasks[taskId] = !wasCompleted;
    
    // Check if this is the first completed task
    const hasCompletedTasks = Object.values(schedule.completedTasks).some(completed => completed);
    const hadCompletedTasks = document.getElementById('completedTab') !== null;
    
    saveAppState();
    
    // If this is the first completed task, regenerate content to show completed tab
    if (hasCompletedTasks && !hadCompletedTasks) {
        updateScheduleContent();
    } else if (!hasCompletedTasks && hadCompletedTasks) {
        // If no more completed tasks, remove completed view
        appState.showingCompleted = false;
        updateScheduleContent();
    } else {
        // Just update the specific card
        const card = document.querySelector(`[data-task-id="${taskId}"]`);
        if (card) {
            card.classList.toggle('completed', !wasCompleted);
            card.dataset.completed = !wasCompleted;
            
            // If in completed view, apply filtering
            if (appState.showingCompleted) {
                filterCompletedTasks(true);
            }
        }
    }
    
    closeAllDropdowns();
    updateProgress();
}

        // Schedule Management Functions
        function switchToSchedule(scheduleId) {
            appState.activeSchedule = scheduleId;
            appState.currentTabIndex = 0; // Reset to first tab
            saveAppState();
            updateDashboard();
            updateProgress();
        }

        function deleteSchedule(scheduleId) {
            if (confirm('Are you sure you want to delete this schedule?')) {
                delete appState.schedules[scheduleId];
                
                // If we deleted the active schedule, switch to another one or none
                if (appState.activeSchedule === scheduleId) {
                    const remainingSchedules = Object.keys(appState.schedules);
                    appState.activeSchedule = remainingSchedules.length > 0 ? remainingSchedules[0] : null;
                    appState.currentTabIndex = 0;
                }
                
                saveAppState();
                updateDashboard();
                updateProgress();
            }
        }

        function toggleTaskComplete(taskId) {
            const schedule = appState.schedules[appState.activeSchedule];
            if (!schedule) return;
            
            schedule.completedTasks[taskId] = !schedule.completedTasks[taskId];
            saveAppState();
            updateDashboard();
            updateProgress();
            closeAllDropdowns();
        }

        // Dropdown Management
        function toggleDropdown(event, taskId, isCompleted) {
            event.stopPropagation();
            
            // Close existing dropdown
            closeAllDropdowns();
            
            // Create new dropdown
            const dropdown = document.createElement('div');
            dropdown.className = 'dropdown show';
            dropdown.innerHTML = `
                <div class="dropdown-item" onclick="toggleTaskComplete('${taskId}')">
                    <svg class="icon" viewBox="0 0 24 24">
                        ${isCompleted ? 
                            '<rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><path d="M9 9h6v6H9z"/>' :
                            '<polyline points="20,6 9,17 4,12"/>'
                        }
                    </svg>
                    ${isCompleted ? 'Mark as Incomplete' : 'Mark as Complete'}
                </div>
            `;
            
            // Position dropdown
            const rect = event.target.getBoundingClientRect();
            dropdown.style.left = `${rect.left - 150}px`;
            dropdown.style.top = `${rect.bottom + 8}px`;
            
            // Add to document
            document.body.appendChild(dropdown);
            activeDropdown = dropdown;
            
            // Show overlay
            document.getElementById('dropdownOverlay').style.display = 'block';
        }

        function closeAllDropdowns() {
            if (activeDropdown) {
                activeDropdown.remove();
                activeDropdown = null;
            }
            document.getElementById('dropdownOverlay').style.display = 'none';
        }

        // Enhanced Progress Tracking with View Schedule Button
function updateProgress() {
    const content = document.getElementById('progressContent');
    
    if (Object.keys(appState.schedules).length === 0) {
        content.innerHTML = `
            <div class="empty-state">
                <h3>No progress data yet</h3>
                <p>Complete some revision tasks to see your progress here</p>
            </div>
        `;
        return;
    }
    
    let html = '';
    
    Object.values(appState.schedules).forEach(schedule => {
        let totalTasks = 0;
        let completedTasks = 0;
        
        Object.values(schedule.weeklySchedule).forEach(dayTasks => {
            totalTasks += dayTasks.length;
        });
        
        completedTasks = Object.values(schedule.completedTasks).filter(completed => completed).length;
        
        const progressPercentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
        
        html += `
            <div class="progress-card">
                <button class="progress-view-button" onclick="viewScheduleFromProgress('${schedule.id}')">
                    <svg class="icon" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                    View Schedule
                </button>
                <h4 style="color: var(--accent-blue); margin-bottom: 16px; font-weight: 800; display: flex; align-items: center; gap: 12px; font-size: 1.2rem; padding-right: 140px;">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                    </svg>
                    ${schedule.name}
                </h4>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${progressPercentage}%;"></div>
                </div>
                <p style="color: var(--text-secondary); font-size: 0.95rem; font-weight: 600;">
                    ${completedTasks}/${totalTasks} tasks completed (${progressPercentage}%)
                </p>
            </div>
        `;
    });
    
    content.innerHTML = html;
}

// Function to view schedule from progress page
function viewScheduleFromProgress(scheduleId) {
    // Switch to that schedule
    appState.activeSchedule = scheduleId;
    appState.currentTabIndex = 0;
    saveAppState();
    
    // Navigate to dashboard
    showPage('dashboard');
    updateDashboard();
}

        // Settings Functions
        function exportData() {
            showAlert('Export feature coming soon!', 'success');
        }

        function syncData() {
            showAlert('Sync feature coming soon!', 'success');
        }

        function toggleTheme() {
            showAlert('Theme customization coming soon!', 'success');
        }

        // Updated settings with white as default
let userSettings = {
    sessionLength: 45,
    breakLength: 10,
    studyNotifications: false,
    breakNotifications: false,
    theme: 'white' // Changed default to white
};

// Load settings from localStorage
function loadSettings() {
    const saved = localStorage.getItem('gcseRevisionSettings');
    if (saved) {
        userSettings = { ...userSettings, ...JSON.parse(saved) };
        applySettings();
    }
}

// Save settings to localStorage
function saveSettings() {
    localStorage.setItem('gcseRevisionSettings', JSON.stringify(userSettings));
}

// Apply settings to UI
function applySettings() {
    // Update selects
    const sessionSelect = document.getElementById('sessionLength');
    const breakSelect = document.getElementById('breakLength');
    if (sessionSelect) sessionSelect.value = userSettings.sessionLength;
    if (breakSelect) breakSelect.value = userSettings.breakLength;
    
    // Update toggles
    const studyToggle = document.getElementById('studyNotifications');
    const breakToggle = document.getElementById('breakNotifications');
    if (studyToggle) studyToggle.classList.toggle('active', userSettings.studyNotifications);
    if (breakToggle) breakToggle.classList.toggle('active', userSettings.breakNotifications);
    
    // Apply theme
    changeTheme(userSettings.theme, false);
}

// Update session length
function updateSessionLength(value) {
    userSettings.sessionLength = parseInt(value);
    saveSettings();
    showAlert(`Study session length updated to ${value} minutes`, 'success');
}

// Update break length
function updateBreakLength(value) {
    userSettings.breakLength = parseInt(value);
    saveSettings();
    showAlert(`Break length updated to ${value} minutes`, 'success');
}

// Toggle notifications
function toggleNotifications(type) {
    if (type === 'study') {
        userSettings.studyNotifications = !userSettings.studyNotifications;
        document.getElementById('studyNotifications').classList.toggle('active', userSettings.studyNotifications);
        
        if (userSettings.studyNotifications) {
            requestNotificationPermission();
            showAlert('Study reminders enabled', 'success');
        } else {
            showAlert('Study reminders disabled', 'success');
        }
    } else if (type === 'break') {
        userSettings.breakNotifications = !userSettings.breakNotifications;
        document.getElementById('breakNotifications').classList.toggle('active', userSettings.breakNotifications);
        
        if (userSettings.breakNotifications) {
            requestNotificationPermission();
            showAlert('Break reminders enabled', 'success');
        } else {
            showAlert('Break reminders disabled', 'success');
        }
    }
    saveSettings();
}

// Request notification permission
function requestNotificationPermission() {
    if ('Notification' in window && Notification.permission === 'default') {
        Notification.requestPermission().then(permission => {
            if (permission === 'granted') {
                new Notification('GCSE Revision Planner', {
                    body: 'Notifications enabled successfully!',
                    icon: '/favicon.ico'
                });
            }
        });
    }
}

// Export data functionality
function exportData(format) {
    const data = {
        schedules: appState.schedules,
        settings: userSettings,
        exportDate: new Date().toISOString()
    };
    
    let content, filename, mimeType;
    
    if (format === 'csv') {
        content = convertToCSV(data);
        filename = `gcse-revision-data-${new Date().toISOString().split('T')[0]}.csv`;
        mimeType = 'text/csv';
    } else {
        content = JSON.stringify(data, null, 2);
        filename = `gcse-revision-data-${new Date().toISOString().split('T')[0]}.json`;
        mimeType = 'application/json';
    }
    
    downloadFile(content, filename, mimeType);
    showAlert(`Data exported as ${format.toUpperCase()}`, 'success');
}

// Convert data to CSV
function convertToCSV(data) {
    let csv = 'Schedule,Subject,Day,Topic,Time,Difficulty,Completed\n';
    
    Object.values(data.schedules).forEach(schedule => {
        Object.entries(schedule.weeklySchedule).forEach(([day, tasks]) => {
            tasks.forEach((task, index) => {
                const taskId = `${schedule.id}_${day}_${index}`;
                const completed = schedule.completedTasks[taskId] || false;
                csv += `"${schedule.name}","${task.subject}","${day}","${task.topic}","${task.time}","${task.difficulty}","${completed}"\n`;
            });
        });
    });
    
    return csv;
}

// Download file
function downloadFile(content, filename, mimeType) {
    const blob = new Blob([content], { type: mimeType });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = filename;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
}

// Enhanced theme system with smooth animations
function changeTheme(theme, save = true) {
    // Create transition overlay
    const overlay = document.createElement('div');
    overlay.className = 'theme-transition-overlay';
    document.body.appendChild(overlay);
    
    // Show overlay
    setTimeout(() => {
        overlay.classList.add('active');
    }, 50);
    
    // Change theme after overlay appears
    setTimeout(() => {
        userSettings.theme = theme;
        
        // Update active theme selector
        document.querySelectorAll('.theme-option').forEach(option => {
            option.classList.remove('active');
        });
        
        const selectedOption = document.querySelector(`.theme-${theme}`);
        if (selectedOption) {
            selectedOption.classList.add('active');
        }
        
        // Apply theme to document
        document.documentElement.setAttribute('data-theme', theme);
        
        if (save) {
            saveSettings();
            showAlert(`Theme changed to ${theme.charAt(0).toUpperCase() + theme.slice(1)}`, 'success');
        }
        
        // Remove overlay
        setTimeout(() => {
            overlay.classList.remove('active');
            setTimeout(() => {
                if (overlay.parentNode) {
                    overlay.parentNode.removeChild(overlay);
                }
            }, 600);
        }, 300);
        
    }, 300);
}

// Apply theme on page load
function applySettings() {
    // Update selects
    const sessionSelect = document.getElementById('sessionLength');
    const breakSelect = document.getElementById('breakLength');
    if (sessionSelect) sessionSelect.value = userSettings.sessionLength;
    if (breakSelect) breakSelect.value = userSettings.breakLength;
    
    // Update toggles
    const studyToggle = document.getElementById('studyNotifications');
    const breakToggle = document.getElementById('breakNotifications');
    if (studyToggle) studyToggle.classList.toggle('active', userSettings.studyNotifications);
    if (breakToggle) breakToggle.classList.toggle('active', userSettings.breakNotifications);
    
    // Apply theme without animation on load
    document.documentElement.setAttribute('data-theme', userSettings.theme);
    
    // Update theme selector
    setTimeout(() => {
        const selectedOption = document.querySelector(`.theme-${userSettings.theme}`);
        if (selectedOption) {
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
            });
            selectedOption.classList.add('active');
        }
    }, 100);
}
// Create backup
function createBackup() {
    exportData('json');
    showAlert('Backup created and downloaded', 'success');
}

// Restore backup
function restoreBackup() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = function(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.schedules) {
                        appState.schedules = data.schedules;
                        if (data.settings) {
                            userSettings = { ...userSettings, ...data.settings };
                            applySettings();
                        }
                        saveAppState();
                        saveSettings();
                        updateDashboard();
                        updateProgress();
                        showAlert('Backup restored successfully', 'success');
                    } else {
                        showAlert('Invalid backup file', 'error');
                    }
                } catch (error) {
                    showAlert('Error reading backup file', 'error');
                }
            };
            reader.readAsText(file);
        }
    };
    input.click();
}

// Enhanced initialization with past papers
document.addEventListener('DOMContentLoaded', function() {
    loadAppState();
    loadSettings();
    
    setTimeout(() => {
        updateDashboard();
        updateProgress();
    }, 100);
    
    setTimeout(() => {
        if (Object.keys(appState.schedules).length > 0) {
            updateCenteredCarousel();
        }
        appState.isInitialized = true;
    }, 300);
    
    // Final centering check after all styles load
    window.addEventListener('load', function() {
        setTimeout(() => {
            if (Object.keys(appState.schedules).length > 0) {
                updateCenteredCarousel();
            }
        }, 500);
    });
});

// Past Papers Management Functions
function initializePastPapers() {
    const savedPapers = localStorage.getItem('gcsePastPapers');
    if (savedPapers) {
        pastPapersData = { ...pastPapersData, ...JSON.parse(savedPapers) };
    }
    renderPastPapersGrid();
}

function savePastPapers() {
    localStorage.setItem('gcsePastPapers', JSON.stringify(pastPapersData));
}

function renderPastPapersGrid() {
    const grid = document.getElementById('pastPapersGrid');
    if (!grid) return;
    
    const subjects = ['Mathematics', 'English', 'Biology', 'Chemistry', 'Physics', 'History'];
    const maxSlots = 6;
    
    let html = '';
    
    for (let i = 0; i < maxSlots; i++) {
        const subject = subjects[i];
        const subjectKey = subject.toLowerCase();
        const papers = pastPapersData[subjectKey] || [];
        const isOccupied = papers.length > 0;
        
        if (isOccupied) {
            html += `
                <div class="past-paper-slot filled">
                    <div class="past-paper-info">
                        <div class="past-paper-subject">${subject}</div>
                        <div class="past-paper-file">${papers[0] || 'No file set'}</div>
                        <button class="past-paper-remove" onclick="removePastPaper('${subjectKey}')">
                            Remove
                        </button>
                    </div>
                </div>
            `;
        } else {
            html += `
                <div class="past-paper-slot" onclick="addPastPaper('${subjectKey}', '${subject}')">
                    <svg class="icon" viewBox="0 0 24 24" style="width: 32px; height: 32px; color: var(--text-muted);">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="16"/>
                        <line x1="8" y1="12" x2="16" y2="12"/>
                    </svg>
                    <div style="color: var(--text-muted); font-weight: 600;">Add ${subject} Past Paper</div>
                    <div style="color: var(--text-muted); font-size: 0.8rem;">Click to set file path</div>
                </div>
            `;
        }
    }
    
    grid.innerHTML = html;
}

function addPastPaper(subjectKey, subjectName) {
    const filePath = prompt(`Enter the file path for ${subjectName} past paper:\n\nExample: /papers/mathematics-2023.pdf`);
    
    if (filePath && filePath.trim()) {
        pastPapersData[subjectKey] = [filePath.trim()];
        savePastPapers();
        renderPastPapersGrid();
        showAlert(`${subjectName} past paper added successfully`, 'success');
    }
}

function removePastPaper(subjectKey) {
    if (confirm('Are you sure you want to remove this past paper?')) {
        pastPapersData[subjectKey] = [];
        savePastPapers();
        renderPastPapersGrid();
        showAlert('Past paper removed successfully', 'success');
    }
}

// Enhanced function to handle alternative subject names
function getPastPapersForSubject(subjectName) {
    // Normalize subject name for matching
    const subjectKey = subjectName.toLowerCase().trim();
    
    // Try exact match first
    if (pastPapersData[subjectKey]) {
        return pastPapersData[subjectKey].filter(paper => paper && paper.trim());
    }
    
    // Define alternative name mappings
    const alternativeNames = {
        'mathematics': ['maths', 'math'],
        'maths': ['mathematics', 'math'],
        'math': ['mathematics', 'maths'],
        'biology': ['bio'],
        'bio': ['biology'],
        'chemistry': ['chem'],
        'chem': ['chemistry'],
        'geography': ['geo'],
        'geo': ['geography'],
        'computer science': ['computing', 'ict', 'comp sci'],
        'computing': ['computer science', 'ict'],
        'ict': ['computer science', 'computing'],
        'religious studies': ['rs', 'religion'],
        'rs': ['religious studies', 'religion'],
        'business studies': ['business'],
        'business': ['business studies'],
        'physical education': ['pe', 'sport'],
        'pe': ['physical education', 'sport'],
        'art and design': ['art'],
        'art': ['art and design'],
        'english literature': ['english lit', 'eng lit'],
        'english language': ['english lang', 'eng lang']
    };
    
    // Check alternative names
    if (alternativeNames[subjectKey]) {
        for (const altName of alternativeNames[subjectKey]) {
            if (pastPapersData[altName]) {
                return pastPapersData[altName].filter(paper => paper && paper.trim());
            }
        }
    }
    
    // Try partial matches for compound subjects
    const matchingKey = Object.keys(pastPapersData).find(key => 
        key.includes(subjectKey) || subjectKey.includes(key) ||
        key.replace(/\s+/g, '').includes(subjectKey.replace(/\s+/g, '')) ||
        subjectKey.replace(/\s+/g, '').includes(key.replace(/\s+/g, ''))
    );
    
    if (matchingKey) {
        return pastPapersData[matchingKey].filter(paper => paper && paper.trim());
    }
    
    return [];
}

// Check if any past papers exist for current schedule subjects
function getRelevantPastPapers() {
    if (!appState.activeSchedule || !appState.schedules[appState.activeSchedule]) {
        return {};
    }
    
    const schedule = appState.schedules[appState.activeSchedule];
    const relevantPapers = {};
    
    schedule.subjects.forEach(subject => {
        const papers = getPastPapersForSubject(subject);
        if (papers.length > 0) {
            relevantPapers[subject] = papers;
        }
    });
    
    return relevantPapers;
}

// Function to handle opening past papers
function openPastPaper(paperPath) {
    try {
        if (paperPath.startsWith('http://') || paperPath.startsWith('https://')) {
            // For URLs
            window.open(paperPath, '_blank');
        } else {
            // For local file paths
            const link = document.createElement('a');
            link.href = paperPath;
            link.target = '_blank';
            link.click();
        }
        showAlert('Opening past paper...', 'success');
    } catch (error) {
        showAlert('Could not open past paper. Please check the file path.', 'error');
        console.error('Error opening past paper:', error);
    }
}

        // Enhanced Alert System with Smooth Animations
function showAlert(message, type = 'success') {
    // Create notification container if it doesn't exist
    let container = document.getElementById('notificationContainer');
    if (!container) {
        container = document.createElement('div');
        container.id = 'notificationContainer';
        container.className = 'notification-container';
        document.body.appendChild(container);
    }
    
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <svg class="icon" viewBox="0 0 24 24">
            ${type === 'error' ? 
                '<circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>' :
                '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22,4 12,14.01 9,11.01"/>'
            }
        </svg>
        ${message}
        <div class="notification-progress"></div>
    `;
    
    // Add to container
    container.appendChild(notification);
    
    // Trigger show animation
    setTimeout(() => {
        notification.classList.add('show');
    }, 100);
    
    // Auto remove with hide animation
    setTimeout(() => {
        notification.classList.add('hide');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 400);
    }, 4000);
}

        // Data Management
        function saveAppState() {
            try {
                localStorage.setItem('gcseRevisionPlannerState', JSON.stringify(appState));
            } catch (error) {
                console.error('Failed to save app state:', error);
            }
        }

        function loadAppState() {
            try {
                const savedState = localStorage.getItem('gcseRevisionPlannerState');
                if (savedState) {
                    const parsed = JSON.parse(savedState);
                    appState = { ...appState, ...parsed };
                }
            } catch (error) {
                console.error('Failed to load app state:', error);
            }
        }

        // Event Listeners
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.revision-card-mini-menu') && !event.target.closest('.dropdown')) {
                closeAllDropdowns();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeSidebar();
                closeAllDropdowns();
            }
            
            if ((event.ctrlKey || event.metaKey) && event.key === 'k') {
                event.preventDefault();
                openSidebar();
            }
        });

        // Responsive handling
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                appState.visibleTabCount = 2;
            } else {
                appState.visibleTabCount = 1;
            }
            updateTabCarousel();
        });

        // Prevent sidebar closing when hovering over trigger while leaving sidebar
        document.querySelector('.sidebar-trigger').addEventListener('mouseenter', function() {
            clearTimeout(sidebarTimeout);
        });
    </script>
</body>
</html>