<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GCSE Revision Planner</title>
    <style>
        /* Enhanced Theme System - Root Variables */
/* Updated Theme System - Only White and Black */
:root {
    /* Default White Theme */
    --bg-primary: linear-gradient(135deg, #ffffff 0%, #fefefe 25%, #f9fafb 50%, #f3f4f6 75%, #e5e7eb 100%);
    --bg-secondary: #ffffff;
    --bg-card: rgba(255, 255, 255, 0.98);
    --bg-card-hover: rgba(255, 255, 255, 1);
    --text-primary: #111827;
    --text-secondary: #374151;
    --text-muted: #6b7280;
    --accent-blue: #3b82f6;
    --accent-blue-hover: #2563eb;
    --accent-blue-light: rgba(59, 130, 246, 0.08);
    --accent-green: #059669;
    --accent-red: #dc2626;
    --border-color: rgba(209, 213, 219, 0.3);
    --border-hover: rgba(59, 130, 246, 0.3);
    --glass-bg: rgba(255, 255, 255, 0.95);
    --glass-border: rgba(209, 213, 219, 0.3);
    --sidebar-bg: rgba(255, 255, 255, 0.99);
    --sidebar-highlight: linear-gradient(135deg, rgba(59, 130, 246, 0.12) 0%, rgba(59, 130, 246, 0.04) 100%);
    --calendar-header: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
    --calendar-day: #fefefe;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
}

/* Black Theme */
[data-theme="black"] {
    --bg-primary: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #334155 50%, #475569 75%, #64748b 100%);
    --bg-secondary: #1e293b;
    --bg-card: rgba(30, 41, 59, 0.95);
    --bg-card-hover: rgba(30, 41, 59, 0.98);
    --text-primary: #f1f5f9;
    --text-secondary: #cbd5e1;
    --text-muted: #94a3b8;
    --accent-blue: #60a5fa;
    --accent-blue-hover: #3b82f6;
    --accent-blue-light: rgba(96, 165, 250, 0.15);
    --accent-green: #34d399;
    --accent-red: #f87171;
    --border-color: rgba(71, 85, 105, 0.3);
    --border-hover: rgba(96, 165, 250, 0.4);
    --glass-bg: rgba(30, 41, 59, 0.9);
    --glass-border: rgba(71, 85, 105, 0.4);
    --sidebar-bg: rgba(15, 23, 42, 0.98);
    --sidebar-highlight: linear-gradient(135deg, rgba(96, 165, 250, 0.2) 0%, rgba(96, 165, 250, 0.08) 100%);
    --calendar-header: linear-gradient(135deg, #1e293b 0%, #334155 100%);
    --calendar-day: #334155;
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.4);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.6), 0 10px 10px -5px rgba(0, 0, 0, 0.5);
}

/* Ensure only 4 tab colors work consistently */
.tab.color-1 { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-color: #3b82f6; }
.tab.color-2 { background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%); border-color: #7c3aed; }
.tab.color-3 { background: linear-gradient(135deg, #059669 0%, #047857 100%); border-color: #059669; }
.tab.color-4 { background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%); border-color: #ea580c; }

/* Smooth theme transitions */
* {
    transition: background-color 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                color 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                border-color 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                box-shadow 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            font-weight: 400;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-overlay);
            backdrop-filter: blur(0.5px);
            z-index: -1;
        }

        /* Container and Layout */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
            transition: margin-left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 50px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 2px solid var(--glass-border);
            box-shadow: var(--shadow-lg);
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .container.sidebar-open {
            margin-left: 280px;
        }

        /* Header Styles */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding: 20px 0;
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 800;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 25%, #60a5fa  75%, #93c5fd 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.04em;
            text-shadow: 0 0 30px rgba(59, 130, 246, 0.3);
        }

        /* Professional Icon Styles */
        .icon {
            width: 20px;
            height: 20px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2.5;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .icon-lg {
            width: 24px;
            height: 24px;
        }

        /* Enhanced Sidebar Styles */
        .sidebar {
            position: fixed;
            left: -280px;
            top: 0;
            width: 280px;
            height: 100vh;
            background: var(--sidebar-bg);
            backdrop-filter: blur(30px);
            border-right: 2px solid var(--glass-border);
            transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            box-shadow: 8px 0 32px rgba(0, 0, 0, 0.12);
        }

        .sidebar.open {
            left: 0;
        }

        .sidebar-header {
            padding: 32px 28px;
            border-bottom: 2px solid var(--glass-border);
            background: var(--gradient-overlay);
        }

        .sidebar-header h2 {
            color: var(--accent-blue);
            font-size: 1.5rem;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 16px;
            letter-spacing: -0.02em;
        }

        .sidebar-nav {
            padding: 32px 0;
        }

        /* Enhanced Sidebar Item with Oval Highlighting */
        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 20px 28px;
            margin: 8px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            font-weight: 600;
            font-size: 1.05rem;
            position: relative;
            border-radius: 24px;
            overflow: hidden;
        }

        .sidebar-item::before {
            content: '';
            position: absolute;
            left: -100%;
            top: 0;
            height: 100%;
            width: 100%;
            background: var(--sidebar-highlight);
            border-radius: 24px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: -1;
        }

        .sidebar-item::after {
            content: '';
            position: absolute;
            left: 8px;
            top: 50%;
            transform: translateY(-50%);
            width: 0;
            height: 32px;
            background: var(--accent-blue);
            border-radius: 16px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .sidebar-item:hover,
        .sidebar-item.active {
            color: var(--accent-blue);
            background: var(--sidebar-highlight);
            border-radius: 24px;
            transform: translateX(4px);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.15);
        }

        .sidebar-item:hover::before,
        .sidebar-item.active::before {
            left: 0;
        }

        .sidebar-item:hover::after,
        .sidebar-item.active::after {
            width: 4px;
        }

        .sidebar-item.active {
            background: var(--accent-blue-light);
            border: 2px solid rgba(37, 99, 235, 0.2);
        }

        /* Sidebar Trigger - Updated for hover */
        .sidebar-trigger {
            position: fixed;
            left: 0;
            top: 0;
            width: 32px;
            height: 100vh;
            z-index: 998;
            cursor: pointer;
            background: linear-gradient(90deg, rgba(37, 99, 235, 0.05) 0%, transparent 100%);
            transition: all 0.3s ease;
        }

        .sidebar-trigger:hover {
            background: linear-gradient(90deg, rgba(37, 99, 235, 0.1) 0%, transparent 100%);
            width: 40px;
        }

        /* Sidebar Overlay */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .sidebar-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        /* Page Styles */
        .page {
            display: none;
            opacity: 0;
            transform: translateY(24px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .page.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }

        /* Enhanced Card Styles */
        .card {
            background: var(--bg-card);
            border: 2px solid var(--glass-border);
            border-radius: 40px;
            padding: 32px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-overlay);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -8px rgba(0, 0, 0, 0.15);
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
        }

        .card:hover::before {
            opacity: 1;
        }

        /* Form Styles */
        .input-group {
            margin-bottom: 24px;
        }

        .input-group label {
            display: block;
            margin-bottom: 12px;
            color: var(--accent-blue);
            font-weight: 700;
            font-size: 1.05rem;
            letter-spacing: -0.01em;
        }

        .input-group input, .input-group textarea {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: inherit;
            box-shadow: var(--shadow-sm);
        }

        .input-group textarea {
            resize: vertical;
            min-height: 100px;
            line-height: 1.6;
        }

        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 4px var(--accent-blue-light), var(--shadow-md);
            transform: translateY(-2px);
        }

        /* Enhanced Button Styles */
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-blue-hover) 100%);
            color: white;
            border: none;
            padding: 18px 32px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 8px 32px rgba(37, 99, 235, 0.3);
            letter-spacing: -0.01em;
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(37, 99, 235, 0.4);
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            padding: 14px 24px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow-sm);
        }

        .btn-secondary:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Enhanced Tab Container with Carousel */
        .tab-carousel {
            position: relative;
            margin-bottom: 32px;
            padding: 20px;
            border-radius: 30px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 2px solid var(--glass-border);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
        }

        .tab-viewport {
            overflow: hidden;
            width: 100%;
        }

        .tab-container {
            display: flex;
            gap: 16px;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 100%;
        }

        .tab {
            border: 2px solid;
            color: white;
            padding: 16px 28px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            backdrop-filter: blur(12px);
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
            min-width: 200px;
            justify-content: center;
        }

        .tab.color-1 { background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-blue-hover) 100%); border-color: var(--accent-blue); }
        .tab.color-2 { background: linear-gradient(135deg, var(--accent-purple) 0%, #6d28d9 100%); border-color: var(--accent-purple); }
        .tab.color-3 { background: linear-gradient(135deg, var(--accent-green) 0%, #047857 100%); border-color: var(--accent-green); }
        .tab.color-4 { background: linear-gradient(135deg, var(--accent-orange) 0%, #c2410c 100%); border-color: var(--accent-orange); }
        .tab.color-5 { background: linear-gradient(135deg, var(--accent-pink) 0%, #be185d 100%); border-color: var(--accent-pink); }
        .tab.color-6 { background: linear-gradient(135deg, var(--accent-yellow) 0%, #a16207 100%); border-color: var(--accent-yellow); }

        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.4s ease;
        }

        .tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 28px rgba(0, 0, 0, 0.2);
        }

        .tab:hover::before {
            left: 100%;
        }

        .tab.active {
            box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
            transform: translateY(-2px) scale(1.05);
        }

        /* Carousel Navigation */
        .carousel-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: var(--bg-secondary);
            border: 2px solid var(--glass-border);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            z-index: 10;
        }

        .carousel-nav:hover {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
            transform: translateY(-50%) scale(1.1);
        }

        .carousel-nav.prev {
            left: -10px;
        }

        .carousel-nav.next {
            right: -10px;
        }

        .carousel-nav:disabled {
            opacity: 0.3;
            cursor: not-allowed;
            transform: translateY(-50%);
        }

        /* New Schedule Grid Layout */
        .schedule-grid-container {
            background: var(--glass-bg);
            border: 2px solid var(--glass-border);
            border-radius: 40px;
            overflow: hidden;
            backdrop-filter: blur(30px);
            margin-bottom: 24px;
            box-shadow: var(--shadow-lg);
        }

        .schedule-grid {
            display: grid;
            grid-template-columns: 200px repeat(7, 1fr);
            grid-template-rows: auto repeat(var(--subject-count, 6), 1fr);
            min-height: 600px;
            gap: 2px;
            background: var(--border-color);
            padding: 2px;
        }

        .grid-header {
            background: var(--calendar-header);
            padding: 20px 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            color: var(--accent-blue);
            font-size: 1rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            border-bottom: 2px solid var(--glass-border);
            position: relative;
        }

        .grid-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 30px;
            height: 3px;
            background: var(--accent-blue);
            border-radius: 2px;
            opacity: 0.6;
        }

        .subject-label {
            background: var(--calendar-header);
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            color: var(--accent-blue);
            font-size: 0.95rem;
            text-align: center;
            word-wrap: break-word;
            border-right: 2px solid var(--glass-border);
            writing-mode: horizontal-tb;
            min-height: 120px;
        }

        .schedule-cell {
            background: var(--calendar-day);
            padding: 8px;
            min-height: 120px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            gap: 4px;
            overflow: hidden;
        }

        .schedule-cell.today {
            background: var(--calendar-today);
            box-shadow: inset 0 0 0 2px rgba(37, 99, 235, 0.3);
        }

        .schedule-cell:hover {
            background: rgba(37, 99, 235, 0.03);
            transform: scale(1.02);
            z-index: 10;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }

        /* Revision Card Styles - Compact for Grid */
        .revision-card-mini {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 6px 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            cursor: pointer;
            font-size: 0.75rem;
            box-shadow: var(--shadow-sm);
            min-height: 45px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            word-wrap: break-word;
            overflow: hidden;
        }

        .revision-card-mini:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
            border-color: var(--accent-blue);
            background: rgba(37, 99, 235, 0.02);
            z-index: 5;
        }

        .revision-card-mini.completed {
            background: rgba(5, 150, 105, 0.08);
            border-color: var(--accent-green);
            opacity: 0.85;
        }

        .revision-card-mini-content {
            flex: 1;
            overflow: hidden;
        }

        .revision-card-mini-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
            line-height: 1.2;
            font-size: 0.8rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .revision-card-mini-topic {
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 3px;
            font-size: 0.7rem;
            line-height: 1.1;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .revision-card-mini-meta {
            color: var(--text-muted);
            font-size: 0.65rem;
            display: flex;
            justify-content: space-between;
            font-weight: 500;
            margin-top: auto;
        }

        .revision-card-mini-menu {
            position: absolute;
            top: 2px;
            right: 2px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 2px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(12px);
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-sm);
        }

        .revision-card-mini:hover .revision-card-mini-menu {
            opacity: 1;
        }

        .revision-card-mini-menu:hover {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
        }

        /* Enhanced Dropdown Menu */
        .dropdown {
            position: fixed;
            background: var(--bg-secondary);
            border: 2px solid var(--glass-border);
            border-radius: 20px;
            min-width: 200px;
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            opacity: 0;
            transform: translateY(-12px) scale(0.9);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            backdrop-filter: blur(30px);
        }

        .dropdown.show {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: all;
        }

        .dropdown-item {
            padding: 16px 20px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: var(--accent-blue);
            color: white;
            transform: translateX(4px);
        }

        /* Loading Animation Styles */
        .loading-container {
            display: none;
            padding: 32px 0;
        }

        .loading-container.show {
            display: block;
        }

        .loading-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .loading-card {
            height: 200px;
            border-radius: 30px;
            background: var(--loading-bg);
            background-size: 400% 400%;
            animation: glowPulse 2.5s ease-in-out infinite;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(12px);
            box-shadow: var(--shadow-lg);
        }

        .loading-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: wave 2s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { 
                background-position: 0% 50%;
                opacity: 0.9;
                transform: scale(1);
            }
            50% { 
                background-position: 100% 50%;
                opacity: 1;
                transform: scale(1.01);
            }
        }

        @keyframes wave {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state h3 {
            color: var(--text-primary);
            margin-bottom: 12px;
            font-size: 1.4rem;
            font-weight: 700;
        }

        .empty-state p {
            font-size: 1rem;
            font-weight: 500;
        }

        /* Progress Bars */
        .progress-bar {
            background: var(--calendar-day);
            border-radius: 20px;
            height: 24px;
            overflow: hidden;
            margin-bottom: 12px;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-blue-hover) 100%);
            border-radius: 20px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
        }

        .progress-fill::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShimmer 2.5s ease-in-out infinite;
        }

        @keyframes progressShimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Settings Grid */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }

        .settings-card {
            background: var(--glass-bg);
            border: 2px solid var(--glass-border);
            border-radius: 30px;
            padding: 24px;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }

        .settings-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .settings-card h4 {
            color: var(--accent-blue);
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .settings-card p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 16px;
            line-height: 1.5;
        }

        /* Alert Styles */
        .alert {
            padding: 16px 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            box-shadow: var(--shadow-md);
        }

        .alert.error {
            background: rgba(220, 38, 38, 0.1);
            border: 2px solid var(--accent-red);
            color: var(--accent-red);
        }

        .alert.success {
            background: rgba(5, 150, 105, 0.1);
            border: 2px solid var(--accent-green);
            color: var(--accent-green);
        }

        /* Hide scrollbars globally */
        * {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        *::-webkit-scrollbar {
            display: none;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .container {
                padding: 16px;
                border-radius: 30px;
            }

            .header h1 {
                font-size: 2.4rem;
            }

            .schedule-grid {
                grid-template-columns: 150px repeat(7, 1fr);
            }

            .subject-label {
                padding: 12px 8px;
                font-size: 0.85rem;
            }

            .loading-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 12px;
                border-radius: 20px;
                margin: 10px;
            }

            .container.sidebar-open {
                margin-left: 0;
            }

            .header {
                margin-bottom: 24px;
                padding: 12px 0;
            }

            .header h1 {
                font-size: 2rem;
            }

            .sidebar {
                width: 100%;
                left: -100%;
            }

            .schedule-grid {
                grid-template-columns: 100px repeat(3, 1fr);
                gap: 1px;
            }

            .schedule-cell {
                min-height: 80px;
                padding: 4px;
            }

            .revision-card-mini {
                min-height: 35px;
                padding: 4px 6px;
                font-size: 0.65rem;
            }

            .revision-card-mini-title {
                font-size: 0.7rem;
            }

            .revision-card-mini-topic {
                font-size: 0.65rem;
            }

            .revision-card-mini-meta {
                font-size: 0.6rem;
            }

            .grid-header {
                padding: 12px 8px;
                font-size: 0.8rem;
            }

            .subject-label {
                padding: 8px 4px;
                font-size: 0.75rem;
                min-height: 80px;
            }

            .card {
                padding: 20px;
                border-radius: 25px;
            }

            .loading-grid {
                grid-template-columns: 1fr;
            }

            .tab {
                min-width: 160px;
                padding: 14px 20px;
            }

            .carousel-nav {
                width: 36px;
                height: 36px;
            }
        }

        /* Accessibility Improvements */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --border-color: rgba(0, 0, 0, 0.5);
                --glass-border: rgba(0, 0, 0, 0.6);
            }
        }

        /* Enhanced Tab Carousel with Hover Navigation */
.tab-carousel {
    position: relative;
    margin-bottom: 32px;
    padding: 20px 60px; /* Add space for arrows */
    border-radius: 30px;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 2px solid var(--glass-border);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
}

.tab-carousel:hover .carousel-nav {
    opacity: 1;
    transform: translateY(-50%) scale(1);
}

/* Smooth Carousel Navigation */
.carousel-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%) scale(0.8);
    background: var(--bg-secondary);
    border: 2px solid var(--glass-border);
    border-radius: 50%;
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: var(--shadow-lg);
    z-index: 20;
    opacity: 0;
    backdrop-filter: blur(20px);
}

.carousel-nav:hover {
    background: var(--accent-blue);
    color: white;
    border-color: var(--accent-blue);
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
}

.carousel-nav.prev {
    left: 16px;
}

.carousel-nav.next {
    right: 16px;
}

.carousel-nav:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    transform: translateY(-50%) scale(0.8);
    background: var(--bg-secondary);
    color: var(--text-muted);
    border-color: var(--border-color);
}

.carousel-nav:disabled:hover {
    background: var(--bg-secondary);
    color: var(--text-muted);
    border-color: var(--border-color);
    transform: translateY(-50%) scale(0.8);
    box-shadow: var(--shadow-md);
}

/* Smooth Tab Container Animation */
.tab-container {
    display: flex;
    gap: 16px;
    transition: transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
    min-width: 100%;
    will-change: transform;
}

/* Enhanced Tab Animations */
.tab {
    border: 2px solid;
    color: white;
    padding: 16px 28px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 700;
    backdrop-filter: blur(12px);
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
    min-width: 200px;
    justify-content: center;
    opacity: 0.8;
    transform: scale(0.95);
}

.tab.active {
    opacity: 1;
    transform: scale(1);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.3);
    z-index: 10;
}

.tab:not(.active):hover {
    opacity: 0.9;
    transform: scale(0.98);
}

/* Smooth Tab Entrance/Exit Animations */
@keyframes tabSlideIn {
    from {
        opacity: 0;
        transform: translateX(30px) scale(0.9);
    }
    to {
        opacity: 0.8;
        transform: translateX(0) scale(0.95);
    }
}

@keyframes tabSlideOut {
    from {
        opacity: 0.8;
        transform: translateX(0) scale(0.95);
    }
    to {
        opacity: 0;
        transform: translateX(-30px) scale(0.9);
    }
}

.tab.entering {
    animation: tabSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.tab.exiting {
    animation: tabSlideOut 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

/* Smooth Content Transition */
.schedule-grid-container {
    opacity: 1;
    transform: translateY(0);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.schedule-grid-container.transitioning {
    opacity: 0.7;
    transform: translateY(10px);
}

/* Enhanced Progress Cards with Hover Button */
.progress-card {
    margin-bottom: 24px; 
    padding: 24px; 
    background: var(--glass-bg); 
    border-radius: 30px; 
    border: 2px solid var(--glass-border); 
    backdrop-filter: blur(20px); 
    box-shadow: var(--shadow-lg);
    position: relative;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.progress-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
}

.progress-view-button {
    position: absolute;
    top: 20px;
    right: 20px;
    background: var(--accent-blue);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 16px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    opacity: 0;
    transform: translateY(-10px) scale(0.9);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 16px rgba(37, 99, 235, 0.3);
    display: flex;
    align-items: center;
    gap: 8px;
}

.progress-card:hover .progress-view-button {
    opacity: 1;
    transform: translateY(0) scale(1);
}

.progress-view-button:hover {
    background: var(--accent-blue-hover);
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
}

/* Centered Tab Carousel */
.tab-carousel {
    position: relative;
    margin-bottom: 32px;
    padding: 20px 80px; /* More space for arrows */
    border-radius: 30px;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 2px solid var(--glass-border);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
}

.tab-viewport {
    width: 300px; /* Fixed width to show one tab */
    overflow: hidden;
    position: relative;
}

.tab-container {
    display: flex;
    gap: 20px;
    transition: transform 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
    will-change: transform;
}

/* Centered Tab Styling */
.tab {
    border: 2px solid;
    color: white;
    padding: 20px 32px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 700;
    backdrop-filter: blur(12px);
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
    width: 280px; /* Fixed width */
    justify-content: center;
    opacity: 0.6;
    transform: scale(0.85);
    filter: blur(1px);
}

.tab.active {
    opacity: 1;
    transform: scale(1);
    filter: blur(0);
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.3);
    z-index: 10;
}

.tab.prev-tab,
.tab.next-tab {
    opacity: 0.4;
    transform: scale(0.75);
    filter: blur(2px);
}

/* Enhanced Navigation Arrows */
.carousel-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: var(--accent-blue);
    color: white;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 8px 25px rgba(37, 99, 235, 0.4);
    z-index: 20;
    opacity: 0.8;
}

.carousel-nav:hover {
    opacity: 1;
    transform: translateY(-50%) scale(1.1);
    box-shadow: 0 12px 30px rgba(37, 99, 235, 0.6);
}

.carousel-nav.prev {
    left: 20px;
}

.carousel-nav.next {
    right: 20px;
}

/* Smooth Content Transition */
.schedule-grid-container {
    opacity: 1;
    transform: translateY(0);
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.schedule-grid-container.transitioning {
    opacity: 0.3;
    transform: translateY(20px);
}

/* Fixed Centered Tab Carousel */
.tab-viewport {
    width: 320px; /* Slightly wider for better centering */
    overflow: hidden;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

.tab-container {
    display: flex;
    gap: 40px; /* Increased gap for better spacing */
    transition: transform 0.8s cubic-bezier(0.25, 0.8, 0.25, 1);
    will-change: transform;
    align-items: center;
}

.tab {
    border: 2px solid;
    color: white;
    padding: 20px 32px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 700;
    backdrop-filter: blur(12px);
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
    width: 280px; /* Fixed width */
    justify-content: center;
    opacity: 0.4;
    transform: scale(0.8);
    filter: blur(1.5px);
}

.tab.active {
    opacity: 1;
    transform: scale(1);
    filter: blur(0);
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.3);
    z-index: 10;
}

/* Enhanced Tab Carousel with Scroll Support */
.tab-carousel {
    position: relative;
    margin-bottom: 32px;
    padding: 20px 80px;
    border-radius: 30px;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 2px solid var(--glass-border);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: grab; /* Indicate scrollable */
}

.tab-carousel:active {
    cursor: grabbing;
}

/* Page Transition Animations */
.page {
    display: none;
    opacity: 0;
    transform: translateY(24px);
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.page.active {
    display: block;
    opacity: 1;
    transform: translateY(0);
}

.page.transitioning-out {
    opacity: 0;
    transform: translateY(-24px);
}

.page.transitioning-in {
    opacity: 0;
    transform: translateY(24px);
}

/* Enhanced Progress Button Animation */
.progress-view-button {
    position: absolute;
    top: 20px;
    right: 20px;
    background: var(--accent-blue);
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 16px;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    opacity: 0;
    transform: translateY(-10px) scale(0.9);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 16px rgba(37, 99, 235, 0.3);
    display: flex;
    align-items: center;
    gap: 8px;
}

.progress-view-button:active {
    transform: translateY(-8px) scale(0.95);
}

/* Dynamic Completed Tab Animation */
.completed-tab-container {
    position: relative;
    overflow: hidden;
    margin-bottom: 16px;
}

.completed-tab {
    background: linear-gradient(135deg, var(--accent-green) 0%, #047857 100%);
    border: 2px solid var(--accent-green);
    color: white;
    padding: 16px 28px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 700;
    backdrop-filter: blur(12px);
    position: relative;
    overflow: hidden;
    justify-content: center;
    transform: translateY(-100%);
    opacity: 0;
    margin-bottom: 0;
}

.completed-tab.show {
    transform: translateY(0);
    opacity: 1;
}

.completed-tab.active {
    box-shadow: 0 12px 32px rgba(5, 150, 105, 0.4);
    transform: translateY(0) scale(1.05);
}

.completed-tab:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 16px 36px rgba(5, 150, 105, 0.5);
}

/* Smooth card filtering animation */
.revision-card-mini.filtering-out {
    opacity: 0;
    transform: scale(0.8) translateY(-20px);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.revision-card-mini.filtering-in {
    opacity: 1;
    transform: scale(1) translateY(0);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Functional Settings Styles */
.settings-control {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-top: 12px;
}

.settings-select {
    padding: 10px 16px;
    border: 2px solid var(--border-color);
    border-radius: 12px;
    background: var(--bg-secondary);
    color: var(--text-primary);
    font-weight: 600;
    transition: all 0.3s ease;
    cursor: pointer;
}

.settings-select:hover, .settings-select:focus {
    border-color: var(--accent-blue);
    outline: none;
}

.settings-toggle {
    position: relative;
    width: 60px;
    height: 30px;
    background: var(--border-color);
    border-radius: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.settings-toggle.active {
    background: var(--accent-blue);
}

.settings-toggle::after {
    content: '';
    position: absolute;
    top: 3px;
    left: 3px;
    width: 24px;
    height: 24px;
    background: white;
    border-radius: 50%;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.settings-toggle.active::after {
    transform: translateX(30px);
}

.theme-selector {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-top: 12px;
}

.theme-option {
    width: 40px;
    height: 40px;
    border-radius: 12px;
    cursor: pointer;
    border: 3px solid transparent;
    transition: all 0.3s ease;
}

.theme-option.active {
    border-color: var(--accent-blue);
    transform: scale(1.1);
}

.theme-blue { background: linear-gradient(135deg, #2563eb, #3b82f6); }
.theme-green { background: linear-gradient(135deg, #059669, #10b981); }
.theme-purple { background: linear-gradient(135deg, #7c3aed, #8b5cf6); }
.theme-orange { background: linear-gradient(135deg, #ea580c, #f97316); }
.theme-pink { background: linear-gradient(135deg, #db2777, #ec4899); }
.theme-dark { background: linear-gradient(135deg, #374151, #4b5563); }

/* Enhanced Notification System */
.notification-container {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 2000;
    display: flex;
    flex-direction: column;
    gap: 12px;
    pointer-events: none;
}

.notification {
    background: var(--glass-bg);
    border: 2px solid var(--glass-border);
    border-radius: 16px;
    padding: 16px 20px;
    min-width: 300px;
    box-shadow: var(--shadow-xl);
    backdrop-filter: blur(20px);
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 600;
    pointer-events: all;
    
    /* Animation properties */
    opacity: 0;
    transform: translateX(100%) scale(0.9);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.notification.show {
    opacity: 1;
    transform: translateX(0) scale(1);
}

.notification.hide {
    opacity: 0;
    transform: translateX(100%) scale(0.8);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.6, 1);
}

.notification.success {
    border-color: var(--accent-green);
    color: var(--accent-green);
    background: rgba(5, 150, 105, 0.1);
}

.notification.error {
    border-color: var(--accent-red);
    color: var(--accent-red);
    background: rgba(220, 38, 38, 0.1);
}

.notification-progress {
    position: absolute;
    bottom: 0;
    left: 0;
    height: 3px;
    background: currentColor;
    border-radius: 0 0 14px 14px;
    opacity: 0.3;
    animation: notificationProgress 4s linear forwards;
}

@keyframes notificationProgress {
    from { width: 100%; }
    to { width: 0%; }
}

/* Theme transition overlay */
.theme-transition-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--bg-primary);
    z-index: 10000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
}

.theme-transition-overlay.active {
    opacity: 0.9;
    visibility: visible;
}

/* Enhanced Tab Styling for Better Readability */
.tab {
    border: 2px solid;
    color: white;
    padding: 20px 32px;
    border-radius: 20px;
    cursor: pointer;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 700;
    backdrop-filter: blur(12px);
    position: relative;
    overflow: hidden;
    flex-shrink: 0;
    width: 280px;
    justify-content: center;
    opacity: 0.4;
    transform: scale(0.8);
    filter: blur(1.5px);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3); /* Add text shadow for readability */
}

.tab.active {
    opacity: 1;
    transform: scale(1);
    filter: blur(0);
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.3);
    z-index: 10;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.4); /* Stronger shadow for active tab */
}

/* Enhanced tab colors with better contrast */
.tab.color-1 { 
    background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); 
    border-color: #3b82f6; 
    color: #ffffff;
}
.tab.color-2 { 
    background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%); 
    border-color: #7c3aed; 
    color: #ffffff;
}
.tab.color-3 { 
    background: linear-gradient(135deg, #059669 0%, #047857 100%); 
    border-color: #059669; 
    color: #ffffff;
}
.tab.color-4 { 
    background: linear-gradient(135deg, #ea580c 0%, #c2410c 100%); 
    border-color: #ea580c; 
    color: #ffffff;
}

/* Dark theme adjustments for tabs */
[data-theme="black"] .tab {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
}

[data-theme="black"] .tab.active {
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7);
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.6);
}

/* Light theme adjustments for tabs */
[data-theme="white"] .tab {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

[data-theme="white"] .tab.active {
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    box-shadow: 0 16px 40px rgba(0, 0, 0, 0.2);
}

/* Past Papers Management Styles */
.past-papers-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 16px;
    margin-top: 16px;
}

.past-paper-slot {
    background: var(--glass-bg);
    border: 2px dashed var(--border-color);
    border-radius: 16px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    min-height: 120px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    gap: 12px;
}

.past-paper-slot:hover {
    border-color: var(--accent-blue);
    background: var(--accent-blue-light);
    transform: translateY(-2px);
}

.past-paper-slot.filled {
    border-style: solid;
    border-color: var(--accent-green);
    background: rgba(5, 150, 105, 0.05);
}

.past-paper-info {
    display: flex;
    flex-direction: column;
    gap: 8px;
    width: 100%;
}

.past-paper-subject {
    font-weight: 700;
    color: var(--accent-blue);
    font-size: 1.1rem;
}

.past-paper-file {
    font-size: 0.9rem;
    color: var(--text-secondary);
    word-break: break-all;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
}

.past-paper-remove {
    background: var(--accent-red);
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 8px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all 0.3s ease;
}

.past-paper-remove:hover {
    background: #b91c1c;
    transform: scale(1.05);
}

/* Enhanced Past Papers Display */
.past-papers-section {
    margin-top: 40px;
    padding-top: 32px;
    border-top: 3px solid var(--border-color);
}

.past-papers-container {
    background: var(--glass-bg);
    border: 2px solid var(--glass-border);
    border-radius: 24px;
    padding: 32px;
    margin-bottom: 20px;
    backdrop-filter: blur(20px);
    box-shadow: var(--shadow-md);
    transition: all 0.3s ease;
}

.past-papers-container:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.past-papers-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 24px;
    color: var(--accent-blue);
    font-size: 1.5rem;
    font-weight: 800;
}

.past-papers-grid-display {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 20px;
}

.past-paper-card {
    background: var(--bg-secondary);
    border: 2px solid var(--border-color);
    border-radius: 20px;
    padding: 20px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    display: flex;
    flex-direction: column;
    gap: 16px;
    position: relative;
    overflow: hidden;
}

.past-paper-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--gradient-overlay);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.past-paper-card:hover {
    transform: translateY(-6px);
    box-shadow: var(--shadow-xl);
    border-color: var(--accent-blue);
}

.past-paper-card:hover::before {
    opacity: 1;
}

.past-paper-card-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 16px;
}

.past-paper-card-content {
    flex: 1;
}

.past-paper-card-title {
    font-weight: 700;
    color: var(--text-primary);
    font-size: 1.2rem;
    margin-bottom: 8px;
    line-height: 1.3;
}

.past-paper-card-subject {
    background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-blue-hover) 100%);
    color: white;
    padding: 6px 16px;
    border-radius: 16px;
    font-size: 0.85rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    flex-shrink: 0;
}

.past-paper-card-path {
    color: var(--text-muted);
    font-size: 0.9rem;
    word-break: break-all;
    background: var(--calendar-day);
    padding: 12px;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    font-family: 'Courier New', monospace;
}

.past-paper-card-icon {
    position: absolute;
    top: 16px;
    right: 16px;
    color: var(--accent-blue);
    opacity: 0.7;
    transition: all 0.3s ease;
}

.past-paper-card:hover .past-paper-card-icon {
    opacity: 1;
    transform: scale(1.1);
}

/* Empty state for no past papers */
.no-past-papers {
    text-align: center;
    padding: 40px 20px;
    color: var(--text-muted);
    font-style: italic;
}

/* Tab Menu Styles */
.tab-menu {
    position: absolute;
    top: 8px;
    right: 8px;
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 20;
}

.tab:hover .tab-menu {
    opacity: 1;
}

.tab-menu-dots {
    background: rgba(255, 255, 255, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 50%;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
}

.tab-menu-dots:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.1);
}

.tab-dropdown {
    position: absolute;
    top: 30px;
    right: 0;
    background: var(--bg-secondary);
    border: 2px solid var(--glass-border);
    border-radius: 12px;
    min-width: 160px;
    box-shadow: var(--shadow-xl);
    opacity: 0;
    transform: translateY(-10px) scale(0.9);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
    backdrop-filter: blur(20px);
    z-index: 1000;
}

.tab-dropdown.show {
    opacity: 1;
    transform: translateY(0) scale(1);
    pointer-events: all;
}

.tab-dropdown-item {
    padding: 12px 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.85rem;
}

.tab-dropdown-item:hover {
    background: var(--accent-red);
    color: white;
}

.tab-dropdown-item:first-child {
    border-radius: 10px 10px 0 0;
}

.tab-dropdown-item:last-child {
    border-radius: 0 0 10px 10px;
}

/* Duplicate Confirmation Modal */
.duplicate-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(8px);
}

.duplicate-modal-overlay.show {
    opacity: 1;
    visibility: visible;
}

.duplicate-modal {
    background: var(--glass-bg);
    border: 2px solid var(--glass-border);
    border-radius: 24px;
    padding: 32px;
    max-width: 480px;
    margin: 20px;
    backdrop-filter: blur(30px);
    box-shadow: var(--shadow-xl);
    transform: scale(0.8) translateY(20px);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.duplicate-modal-overlay.show .duplicate-modal {
    transform: scale(1) translateY(0);
}

.duplicate-modal h3 {
    color: var(--accent-blue);
    font-size: 1.4rem;
    font-weight: 800;
    margin-bottom: 16px;
    text-align: center;
}

.duplicate-modal p {
    color: var(--text-secondary);
    font-size: 1rem;
    line-height: 1.6;
    margin-bottom: 24px;
    text-align: center;
}

.duplicate-modal-buttons {
    display: flex;
    gap: 12px;
    justify-content: center;
}

.duplicate-modal-button {
    padding: 12px 24px;
    border: none;
    border-radius: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    font-size: 0.9rem;
}

.duplicate-modal-button.replace {
    background: var(--accent-red);
    color: white;
}

.duplicate-modal-button.add-new {
    background: var(--accent-blue);
    color: white;
}

.duplicate-modal-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}

/* Enhanced Tab Dropdown Overlay */
.tab-dropdown-overlay {
    position: fixed;
    z-index: 10000;
    opacity: 0;
    transform: translateY(-10px) scale(0.9);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
}

.tab-dropdown-overlay.show {
    opacity: 1;
    transform: translateY(0) scale(1);
    pointer-events: all;
}

.tab-dropdown-content {
    background: var(--glass-bg);
    border: 2px solid var(--glass-border);
    border-radius: 16px;
    min-width: 180px;
    box-shadow: var(--shadow-xl);
    backdrop-filter: blur(30px);
    overflow: hidden;
}

.tab-dropdown-item {
    padding: 16px 20px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.9rem;
    position: relative;
}

.tab-dropdown-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 0;
    height: 100%;
    background: var(--accent-red);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.tab-dropdown-item:hover {
    color: white;
    transform: translateX(4px);
}

.tab-dropdown-item:hover::before {
    width: 100%;
}

/* Enhanced Floating Sidebar */
.sidebar {
    position: fixed;
    left: -280px;
    top: 20px;
    bottom: 20px;
    width: 280px;
    background: var(--sidebar-bg);
    backdrop-filter: blur(30px);
    border: 2px solid var(--glass-border);
    border-radius: 32px;
    transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1000;
    box-shadow: 
        8px 0 32px rgba(0, 0, 0, 0.12),
        0 0 0 1px rgba(255, 255, 255, 0.05),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    overflow: hidden;
}

.sidebar.open {
    left: 20px;
    box-shadow: 
        0 25px 50px -12px rgba(0, 0, 0, 0.25),
        0 0 80px rgba(59, 130, 246, 0.15),
        0 0 0 1px rgba(255, 255, 255, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
}

.sidebar-header {
    padding: 32px 28px;
    border-bottom: 2px solid var(--glass-border);
    background: linear-gradient(135deg, 
        rgba(59, 130, 246, 0.1) 0%, 
        rgba(59, 130, 246, 0.05) 50%, 
        transparent 100%);
    border-radius: 30px 30px 0 0;
}

/* Enhanced Sidebar Overlay with Gradient */
.sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
        rgba(0, 0, 0, 0.4);
    z-index: 999;
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(8px);
}

.sidebar-overlay.show {
    opacity: 1;
    visibility: visible;
}

/* Dark theme sidebar enhancements */
[data-theme="black"] .sidebar.open {
    box-shadow: 
        0 25px 50px -12px rgba(0, 0, 0, 0.6),
        0 0 80px rgba(96, 165, 250, 0.2),
        0 0 0 1px rgba(255, 255, 255, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

[data-theme="black"] .sidebar-overlay.show {
    background: 
        radial-gradient(circle at 20% 50%, rgba(96, 165, 250, 0.15) 0%, transparent 50%),
        rgba(0, 0, 0, 0.6);
}

/* Enhanced Sidebar - Attached with Right Curves */
.sidebar {
    position: fixed;
    left: -280px;
    top: 0;
    width: 280px;
    height: 100vh;
    background: var(--sidebar-bg);
    backdrop-filter: blur(30px);
    border: 2px solid var(--glass-border);
    border-left: none;
    border-radius: 0 32px 32px 0;
    transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1000;
    box-shadow: 8px 0 32px rgba(0, 0, 0, 0.12);
    overflow: hidden;
}

.sidebar.open {
    left: 0;
    box-shadow: 
        8px 0 32px rgba(0, 0, 0, 0.2),
        0 0 0 1px rgba(255, 255, 255, 0.05);
}

.sidebar-header {
    padding: 32px 28px;
    border-bottom: 2px solid var(--glass-border);
    background: linear-gradient(135deg, 
        rgba(59, 130, 246, 0.1) 0%, 
        rgba(59, 130, 246, 0.05) 50%, 
        transparent 100%);
}

/* Simple Dim Overlay */
.sidebar-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.4);
    z-index: 999;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.sidebar-overlay.show {
    opacity: 1;
    visibility: visible;
}

/* Dark theme sidebar */
[data-theme="black"] .sidebar.open {
    box-shadow: 
        8px 0 32px rgba(0, 0, 0, 0.4),
        0 0 0 1px rgba(255, 255, 255, 0.1);
}

[data-theme="black"] .sidebar-overlay.show {
    background: rgba(0, 0, 0, 0.6);
}

/* Fixed Tab Dropdown with Better Readability */
.tab-dropdown-overlay {
    position: fixed;
    z-index: 10000;
    opacity: 0;
    transform: translateY(-10px) scale(0.9);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
}

.tab-dropdown-overlay.show {
    opacity: 1;
    transform: translateY(0) scale(1);
    pointer-events: all;
}

.tab-dropdown-content {
    background: var(--glass-bg);
    border: 2px solid var(--glass-border);
    border-radius: 16px;
    min-width: 180px;
    box-shadow: var(--shadow-xl);
    backdrop-filter: blur(30px);
    overflow: hidden;
}

.tab-dropdown-item {
    padding: 16px 20px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.9rem;
    position: relative;
    background: var(--bg-secondary);
}

.tab-dropdown-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    width: 0;
    height: 100%;
    background: var(--accent-red);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: -1;
}

.tab-dropdown-item:hover {
    color: white;
    transform: translateX(4px);
}

.tab-dropdown-item:hover::before {
    width: 100%;
}

/* Better contrast for delete button */
.tab-dropdown-item:hover svg {
    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.3));
}

/* Enhanced Floating Sidebar with Top/Bottom Spacing */
.sidebar {
    position: fixed;
    left: -280px;
    top: 20px;
    bottom: 20px;
    width: 280px;
    height: calc(100vh - 40px);
    background: var(--sidebar-bg);
    backdrop-filter: blur(30px);
    border: 2px solid var(--glass-border);
    border-radius: 0 32px 32px 0;
    transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 1000;
    box-shadow: 8px 0 32px rgba(0, 0, 0, 0.12);
    overflow: hidden;
}

.sidebar.open {
    left: 0;
    box-shadow: 
        8px 0 32px rgba(0, 0, 0, 0.2),
        0 8px 32px rgba(0, 0, 0, 0.1),
        0 -8px 32px rgba(0, 0, 0, 0.1),
        0 0 0 1px rgba(255, 255, 255, 0.05);
}

/* Dark theme floating sidebar */
[data-theme="black"] .sidebar.open {
    box-shadow: 
        8px 0 32px rgba(0, 0, 0, 0.4),
        0 8px 32px rgba(0, 0, 0, 0.3),
        0 -8px 32px rgba(0, 0, 0, 0.3),
        0 0 0 1px rgba(255, 255, 255, 0.1);
}

/* Mobile Sidebar Full Screen */
@media (max-width: 768px) {
    .sidebar {
        top: 0;
        bottom: 0;
        height: 100vh;
        border-radius: 0 20px 20px 0;
        width: 100%;
        left: -100%;
    }
    
    .sidebar.open {
        left: 0;
        box-shadow: none;
    }
}

/* Mobile Header Layout */
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 40px;
    padding: 20px 0;
}

.header-left {
    display: flex;
    align-items: center;
    gap: 20px;
}

/* Hamburger Menu */
.hamburger-menu {
    display: none;
    flex-direction: column;
    justify-content: space-around;
    width: 32px;
    height: 32px;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 4px;
    z-index: 1001;
    transition: all 0.3s ease;
}

.hamburger-menu span {
    width: 24px;
    height: 3px;
    background: var(--accent-blue);
    border-radius: 2px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform-origin: center;
}

.hamburger-menu.active span:nth-child(1) {
    transform: translateY(8px) rotate(45deg);
}

.hamburger-menu.active span:nth-child(2) {
    opacity: 0;
    transform: scaleX(0);
}

.hamburger-menu.active span:nth-child(3) {
    transform: translateY(-8px) rotate(-45deg);
}

/* Show hamburger on mobile */
@media (max-width: 768px) {
    .hamburger-menu {
        display: flex;
    }
    
    .sidebar-trigger {
        display: none;
    }
    
    .header h1 {
        font-size: 1.8rem;
    }
}

/* Enhanced Mobile Optimization */
@media (max-width: 768px) {
    .container {
        padding: 12px;
        border-radius: 20px;
        margin: 10px;
        margin-left: 10px !important; /* Override sidebar-open margin */
    }
    
    .container.sidebar-open {
        margin-left: 10px; /* Keep consistent margin on mobile */
    }
    
    .header {
        margin-bottom: 20px;
        padding: 10px 0;
    }
    
    .header h1 {
        font-size: 1.8rem;
    }
    
    /* Mobile tab carousel */
    .tab-carousel {
        padding: 15px 40px;
    }
    
    .tab {
        min-width: 240px;
        padding: 16px 24px;
        font-size: 0.9rem;
    }
    
    .carousel-nav {
        width: 36px;
        height: 36px;
    }
    
    .carousel-nav.prev {
        left: 8px;
    }
    
    .carousel-nav.next {
        right: 8px;
    }
    
    /* Mobile schedule grid */
    .schedule-grid {
        grid-template-columns: 100px repeat(3, 1fr);
        gap: 1px;
        font-size: 0.8rem;
    }
    
    .schedule-cell {
        min-height: 80px;
        padding: 4px;
    }
    
    .revision-card-mini {
        min-height: 35px;
        padding: 4px 6px;
        font-size: 0.65rem;
    }
    
    /* Mobile dropdown positioning */
    .tab-dropdown-overlay {
        position: fixed !important;
        left: 50% !important;
        top: 50% !important;
        transform: translate(-50%, -50%) scale(0.9) !important;
    }
    
    .tab-dropdown-overlay.show {
        transform: translate(-50%, -50%) scale(1) !important;
    }
}

/* Tablet optimizations */
@media (max-width: 1024px) and (min-width: 769px) {
    .sidebar {
        top: 15px;
        bottom: 15px;
        height: calc(100vh - 30px);
    }
    
    .container {
        padding: 16px;
        border-radius: 25px;
    }
    
    .tab {
        min-width: 220px;
        padding: 16px 26px;
    }
}

/* Smaller Home Form Container */
#home .card {
    max-width: 800px;
    margin: 0 auto 24px auto;
}

@media (max-width: 768px) {
    #home .card {
        max-width: 100%;
    }
}

/* Fixed Hamburger Menu - No Scrolling */
.hamburger-menu {
    display: none;
    flex-direction: column;
    justify-content: space-around;
    width: 32px;
    height: 32px;
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 4px;
    z-index: 1001;
    transition: all 0.3s ease;
    position: fixed;
    top: 20px;
    left: 20px;
}

.hamburger-menu span {
    width: 24px;
    height: 3px;
    background: var(--accent-blue);
    border-radius: 2px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    transform-origin: center;
}

.hamburger-menu.active span:nth-child(1) {
    transform: translateY(8px) rotate(45deg);
}

.hamburger-menu.active span:nth-child(2) {
    opacity: 0;
    transform: scaleX(0);
}

.hamburger-menu.active span:nth-child(3) {
    transform: translateY(-8px) rotate(-45deg);
}

/* Prevent body scroll when sidebar is open on mobile */
body.sidebar-open-mobile {
    overflow: hidden;
}

/* Mobile adjustments */
@media (max-width: 768px) {
    .hamburger-menu {
        display: flex;
    }
    
    .header-left h1 {
        margin-left: 60px;
    }
}

/* Mobile Vertical Calendar Layout */
@media (max-width: 768px) {
    .schedule-grid-container {
        border-radius: 20px;
    }
    
    .schedule-grid {
        display: block;
        overflow-x: auto;
        padding: 8px;
        gap: 0;
    }
    
    .grid-header:first-child {
        display: none;
    }
    
    .subject-label {
        display: none;
    }
    
    .mobile-day-section {
        margin-bottom: 24px;
        background: var(--glass-bg);
        border-radius: 16px;
        padding: 16px;
        border: 1px solid var(--border-color);
    }
    
    .mobile-day-header {
        background: var(--calendar-header);
        padding: 12px;
        border-radius: 12px;
        margin-bottom: 12px;
        text-align: center;
        font-weight: 800;
        color: var(--accent-blue);
        font-size: 1.1rem;
    }
    
    .mobile-day-header.today {
        background: var(--accent-blue);
        color: white;
    }
    
    .mobile-subject-group {
        margin-bottom: 16px;
    }
    
    .mobile-subject-title {
        font-weight: 700;
        color: var(--text-primary);
        margin-bottom: 8px;
        font-size: 0.9rem;
        padding: 6px 12px;
        background: var(--calendar-day);
        border-radius: 8px;
        border: 1px solid var(--border-color);
    }
    
    .mobile-tasks-container {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
}

/* Swipeable Task Styles */
.swipeable-task {
    position: relative;
    overflow: hidden;
    transition: transform 0.3s ease;
}

.task-content {
    position: relative;
    z-index: 2;
    background: var(--bg-secondary);
    transition: transform 0.3s ease;
}

.task-action-complete,
.task-action-delete {
    position: absolute;
    top: 0;
    height: 100%;
    width: 80px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    font-weight: 600;
    color: white;
    z-index: 1;
    transition: all 0.3s ease;
}

.task-action-complete {
    right: 0;
    background: var(--accent-green);
    transform: translateX(100%);
}

.task-action-delete {
    left: 0;
    background: var(--accent-red);
    transform: translateX(-100%);
}

.task-action-complete svg,
.task-action-delete svg {
    width: 16px;
    height: 16px;
    margin-bottom: 4px;
}

/* Swipe states */
.swipeable-task.swiping-right .task-content {
    transform: translateX(80px);
}

.swipeable-task.swiping-right .task-action-complete {
    transform: translateX(0);
}

.swipeable-task.swiping-left .task-content {
    transform: translateX(-80px);
}

.swipeable-task.swiping-left .task-action-delete {
    transform: translateX(0);
}

/* Ensure desktop layout stays original */
.desktop-layout .schedule-grid {
    display: grid;
    grid-template-columns: 200px repeat(7, 1fr);
    grid-template-rows: auto repeat(var(--subject-count, 6), 1fr);
    min-height: 600px;
    gap: 2px;
    background: var(--border-color);
    padding: 2px;
}

.mobile-layout {
    display: block !important;
}

/* Prevent mobile styles from affecting desktop */
@media (min-width: 769px) {
    .mobile-day-section,
    .mobile-day-header,
    .mobile-subject-group,
    .mobile-subject-title,
    .mobile-tasks-container {
        display: none !important;
    }
    
    .schedule-grid {
        display: grid !important;
    }
}

/* Bottom Navigation for Mobile */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border-top: 2px solid var(--glass-border);
    display: none;
    z-index: 1000;
    padding: 8px 0;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
}

.bottom-nav-container {
    display: flex;
    justify-content: space-around;
    align-items: center;
    max-width: 100%;
    margin: 0 auto;
    padding: 0 16px;
}

.bottom-nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    padding: 8px 12px;
    border-radius: 16px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    position: relative;
    min-width: 60px;
}

.bottom-nav-item.active {
    background: var(--accent-blue-light);
    transform: translateY(-2px);
}

.bottom-nav-item.active .bottom-nav-icon {
    color: var(--accent-blue);
    transform: scale(1.1);
}

.bottom-nav-item.active .bottom-nav-label {
    color: var(--accent-blue);
    font-weight: 700;
}

.bottom-nav-icon {
    width: 24px;
    height: 24px;
    stroke: var(--text-secondary);
    transition: all 0.3s ease;
}

.bottom-nav-label {
    font-size: 0.7rem;
    font-weight: 600;
    color: var(--text-secondary);
    transition: all 0.3s ease;
    text-align: center;
    line-height: 1;
}

/* Haptic feedback animation */
.bottom-nav-item.haptic {
    animation: hapticPulse 0.3s ease-out;
}

@keyframes hapticPulse {
    0% { transform: translateY(-2px) scale(1); }
    50% { transform: translateY(-4px) scale(1.05); }
    100% { transform: translateY(-2px) scale(1); }
}

/* Show bottom nav on mobile */
@media (max-width: 768px) {
    .bottom-nav {
        display: block;
    }
    
    /* Hide original sidebar elements */
    .sidebar-trigger,
    .hamburger-menu {
        display: none !important;
    }
    
    /* Add bottom padding to container */
    .container {
        margin-bottom: 80px;
    }
    
    body {
        padding-bottom: 80px;
    }
}

/* Authentication Modal Styles */
.auth-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(8px);
}

.auth-overlay.show {
    opacity: 1;
    visibility: visible;
}

.auth-modal {
    background: var(--glass-bg);
    border: 2px solid var(--glass-border);
    border-radius: 24px;
    padding: 32px;
    max-width: 400px;
    width: 90%;
    margin: 20px;
    backdrop-filter: blur(30px);
    box-shadow: var(--shadow-xl);
    transform: scale(0.8) translateY(20px);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.auth-overlay.show .auth-modal {
    transform: scale(1) translateY(0);
}

.auth-header {
    text-align: center;
    margin-bottom: 24px;
}

.auth-header h2 {
    color: var(--accent-blue);
    font-size: 1.8rem;
    font-weight: 800;
    margin-bottom: 8px;
}

.auth-header p {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.auth-tabs {
    display: flex;
    background: var(--calendar-day);
    border-radius: 16px;
    padding: 4px;
    margin-bottom: 24px;
    border: 2px solid var(--border-color);
}

.auth-tab {
    flex: 1;
    padding: 12px 16px;
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.auth-tab.active {
    background: var(--accent-blue);
    color: white;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
}

.auth-form {
    display: none;
}

.auth-form.active {
    display: block;
}

.auth-input-group {
    margin-bottom: 20px;
}

.auth-input-group label {
    display: block;
    margin-bottom: 8px;
    color: var(--text-primary);
    font-weight: 600;
    font-size: 0.9rem;
}

.auth-input {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid var(--border-color);
    border-radius: 16px;
    background: var(--bg-secondary);
    color: var(--text-primary);
    font-size: 16px;
    transition: all 0.3s ease;
    font-family: inherit;
}

.auth-input:focus {
    outline: none;
    border-color: var(--accent-blue);
    box-shadow: 0 0 0 3px var(--accent-blue-light);
}

.auth-submit {
    width: 100%;
    background: linear-gradient(135deg, var(--accent-blue) 0%, var(--accent-blue-hover) 100%);
    color: white;
    border: none;
    padding: 16px;
    border-radius: 16px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-bottom: 16px;
}

.auth-submit:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
}

.auth-submit:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.auth-close {
    position: absolute;
    top: 16px;
    right: 16px;
    background: transparent;
    border: none;
    cursor: pointer;
    color: var(--text-muted);
    padding: 8px;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.auth-close:hover {
    background: var(--accent-red);
    color: white;
}

.user-info {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: var(--glass-bg);
    border-radius: 16px;
    border: 2px solid var(--border-color);
    margin-bottom: 16px;
}

.user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--accent-blue);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 700;
    font-size: 1.2rem;
}

.user-details h4 {
    color: var(--text-primary);
    font-weight: 700;
    margin-bottom: 4px;
}

.user-details p {
    color: var(--text-secondary);
    font-size: 0.85rem;
}

/* Swipe Indicator Styles */
.swipe-indicator {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: 1;
    border-radius: 8px;
    overflow: hidden;
}

/* Enhanced Mobile Task Cards with Better Swipe Support */
.revision-card-mini {
    position: relative;
    overflow: hidden;
    touch-action: pan-x;
    user-select: none;
    transition: background-color 0.3s ease;
}

.task-content {
    position: relative;
    z-index: 2;
    background: inherit;
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 8px;
}

/* Swipe Action Buttons - Hidden by default */
.task-action-complete,
.task-action-delete {
    position: absolute;
    top: 0;
    height: 100%;
    width: 120px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    font-weight: 600;
    color: white;
    z-index: 1;
    transition: all 0.3s ease;
    border-radius: 8px;
    opacity: 0;
}

.task-action-complete {
    right: 0;
    background: var(--accent-green);
}

.task-action-delete {
    left: 0;
    background: var(--accent-red);
}

/* Mobile-specific optimizations */
@media (max-width: 768px) {
    .revision-card-mini {
        min-height: 60px;
        padding: 8px 12px;
        margin-bottom: 8px;
        cursor: pointer;
    }
    
    .revision-card-mini-content {
        pointer-events: none; /* Prevent text selection during swipe */
    }
    
    .revision-card-mini-title {
        font-size: 0.85rem;
        margin-bottom: 4px;
    }
    
    .revision-card-mini-topic {
        font-size: 0.75rem;
        margin-bottom: 6px;
    }
    
    .revision-card-mini-meta {
        font-size: 0.7rem;
    }
}

/* Disable menu button on mobile since we use swipe */
@media (max-width: 768px) {
    .revision-card-mini-menu {
        display: none;
    }
}

/* Long press ripple effect */
.long-press-ripple {
    position: absolute;
    border-radius: 50%;
    background: rgba(59, 130, 246, 0.3);
    transform: scale(0);
    animation: ripple 0.6s linear;
    pointer-events: none;
}

@keyframes ripple {
    to {
        transform: scale(4);
        opacity: 0;
    }
}

/* Full-Page Authentication Styles */
.auth-fullpage {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, 
        #667eea 0%, 
        #764ba2 25%, 
        #f093fb 50%, 
        #f5576c 75%, 
        #4facfe 100%);
    background-size: 400% 400%;
    animation: gradientShift 15s ease infinite;
    z-index: 50000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 1;
    visibility: visible;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.auth-fullpage.hide {
    opacity: 0;
    visibility: hidden;
    transform: scale(1.1);
}

@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* Floating elements */
.auth-background-elements {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    pointer-events: none;
}

.floating-element {
    position: absolute;
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    animation: float 20s infinite ease-in-out;
}

.floating-element:nth-child(1) {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    top: 20%;
    left: 10%;
    animation-delay: 0s;
}

.floating-element:nth-child(2) {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    top: 60%;
    right: 15%;
    animation-delay: -5s;
}

.floating-element:nth-child(3) {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    bottom: 30%;
    left: 20%;
    animation-delay: -10s;
}

.floating-element:nth-child(4) {
    width: 120px;
    height: 40px;
    border-radius: 20px;
    top: 40%;
    right: 25%;
    animation-delay: -15s;
}

@keyframes float {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    33% { transform: translateY(-30px) rotate(120deg); }
    66% { transform: translateY(15px) rotate(240deg); }
}

/* Main auth container */
.auth-fullpage-container {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 32px;
    padding: 48px;
    max-width: 480px;
    width: 90%;
    margin: 20px;
    box-shadow: 
        0 32px 64px rgba(0, 0, 0, 0.12),
        0 0 0 1px rgba(255, 255, 255, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
    position: relative;
    transform: translateY(0);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.auth-fullpage-container::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(135deg, 
        rgba(255, 255, 255, 0.8) 0%, 
        rgba(255, 255, 255, 0.2) 100%);
    border-radius: 32px;
    z-index: -1;
}

/* Welcome section */
.auth-welcome {
    text-align: center;
    margin-bottom: 32px;
}

.auth-logo {
    width: 80px;
    height: 80px;
    margin: 0 auto 20px auto;
    background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
    border-radius: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 8px 32px rgba(59, 130, 246, 0.3);
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); box-shadow: 0 8px 32px rgba(59, 130, 246, 0.3); }
    50% { transform: scale(1.05); box-shadow: 0 12px 48px rgba(59, 130, 246, 0.5); }
}

.auth-welcome h1 {
    color: #1e293b;
    font-size: 2.2rem;
    font-weight: 800;
    margin-bottom: 8px;
    background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.auth-welcome p {
    color: #64748b;
    font-size: 1.1rem;
    font-weight: 500;
    line-height: 1.6;
}

/* Enhanced form styles */
.auth-fullpage .auth-tabs {
    background: rgba(243, 244, 246, 0.8);
    border-radius: 20px;
    padding: 6px;
    margin-bottom: 32px;
    border: 1px solid rgba(209, 213, 219, 0.3);
    backdrop-filter: blur(10px);
}

.auth-fullpage .auth-tab {
    padding: 14px 20px;
    border-radius: 16px;
    font-weight: 700;
    font-size: 1rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    color: #6b7280;
}

.auth-fullpage .auth-tab.active {
    background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
    color: white;
    transform: scale(1.02);
    box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
}

.auth-fullpage .auth-input {
    padding: 18px 20px;
    border: 2px solid rgba(209, 213, 219, 0.3);
    border-radius: 20px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    font-size: 16px;
    font-weight: 500;
    color: #1e293b;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.auth-fullpage .auth-input:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
    background: rgba(255, 255, 255, 1);
    transform: translateY(-1px);
}

.auth-fullpage .auth-submit {
    padding: 18px 24px;
    border-radius: 20px;
    font-size: 16px;
    font-weight: 700;
    background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%);
    box-shadow: 0 8px 32px rgba(59, 130, 246, 0.4);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.auth-fullpage .auth-submit:hover:not(:disabled) {
    transform: translateY(-3px);
    box-shadow: 0 16px 48px rgba(59, 130, 246, 0.5);
}

.auth-fullpage .auth-submit::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
    transition: left 0.5s ease;
}

.auth-fullpage .auth-submit:hover::before {
    left: 100%;
}

/* Security features */
.security-indicators {
    display: flex;
    justify-content: center;
    gap: 16px;
    margin-top: 24px;
    padding-top: 24px;
    border-top: 1px solid rgba(209, 213, 219, 0.3);
}

.security-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #10b981;
    font-size: 0.85rem;
    font-weight: 600;
}

.security-item svg {
    width: 16px;
    height: 16px;
}

/* Password strength indicator */
.password-strength {
    margin-top: 8px;
    height: 4px;
    background: rgba(209, 213, 219, 0.3);
    border-radius: 2px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.password-strength-bar {
    height: 100%;
    transition: all 0.3s ease;
    border-radius: 2px;
}

.strength-weak { background: #ef4444; width: 25%; }
.strength-fair { background: #f59e0b; width: 50%; }
.strength-good { background: #10b981; width: 75%; }
.strength-strong { background: #059669; width: 100%; }

/* Mobile optimizations */
@media (max-width: 768px) {
    .auth-fullpage-container {
        padding: 32px 24px;
        margin: 16px;
        border-radius: 24px;
    }
    
    .auth-welcome h1 {
        font-size: 1.8rem;
    }
    
    .auth-welcome p {
        font-size: 1rem;
    }
    
    .floating-element {
        display: none;
    }
    
    .security-indicators {
        flex-direction: column;
        gap: 8px;
    }
}

/* Loading state */
.auth-loading {
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.auth-spinner {
    width: 16px;
    height: 16px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top: 2px solid white;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Mobile Schedule Day Navigation */
.mobile-day-navigator {
    position: sticky;
    top: 0;
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 2px solid var(--glass-border);
    border-radius: 20px;
    margin-bottom: 20px;
    padding: 16px;
    z-index: 100;
    box-shadow: var(--shadow-lg);
}

.day-nav-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.current-day-display {
    font-size: 1.3rem;
    font-weight: 800;
    color: var(--accent-blue);
    display: flex;
    align-items: center;
    gap: 12px;
}

.day-counter {
    background: var(--accent-blue-light);
    color: var(--accent-blue);
    padding: 6px 12px;
    border-radius: 16px;
    font-size: 0.8rem;
    font-weight: 700;
}

.day-nav-controls {
    display: flex;
    gap: 12px;
}

.day-nav-btn {
    width: 44px;
    height: 44px;
    border: 2px solid var(--border-color);
    background: var(--bg-secondary);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    color: var(--text-secondary);
}

.day-nav-btn:hover:not(:disabled) {
    background: var(--accent-blue);
    border-color: var(--accent-blue);
    color: white;
    transform: scale(1.1);
}

.day-nav-btn:disabled {
    opacity: 0.4;
    cursor: not-allowed;
}

.day-nav-btn svg {
    width: 20px;
    height: 20px;
}

/* Day indicator dots */
.day-indicators {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 12px;
}

.day-dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--border-color);
    transition: all 0.3s ease;
    cursor: pointer;
}

.day-dot.active {
    background: var(--accent-blue);
    transform: scale(1.5);
}

.day-dot.has-tasks {
    background: var(--text-muted);
}

.day-dot.has-tasks.active {
    background: var(--accent-blue);
}

/* Enhanced mobile day content */
.mobile-day-content {
    opacity: 1;
    transform: translateX(0);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.mobile-day-content.sliding-left {
    opacity: 0;
    transform: translateX(-100%);
}

.mobile-day-content.sliding-right {
    opacity: 0;
    transform: translateX(100%);
}

.mobile-day-content.sliding-in-left {
    opacity: 0;
    transform: translateX(100%);
}

.mobile-day-content.sliding-in-right {
    opacity: 0;
    transform: translateX(-100%);
}

/* Enhanced mobile day section */
.mobile-day-section {
    margin-bottom: 0;
    background: var(--glass-bg);
    border-radius: 20px;
    padding: 20px;
    border: 2px solid var(--border-color);
    min-height: 400px;
}

.mobile-day-header {
    display: none; /* Hidden since we have navigator */
}

/* Task summary for current day */
.day-summary {
    background: var(--calendar-day);
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.summary-stats {
    display: flex;
    gap: 16px;
}

.summary-stat {
    text-align: center;
}

.summary-stat-number {
    font-size: 1.2rem;
    font-weight: 800;
    color: var(--text-primary);
}

.summary-stat-label {
    font-size: 0.7rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-weight: 600;
}

/* Empty day state */
.empty-day {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-muted);
}

.empty-day-icon {
    width: 64px;
    height: 64px;
    margin: 0 auto 16px auto;
    background: var(--border-color);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
}

.empty-day h3 {
    color: var(--text-secondary);
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 8px;
}

.empty-day p {
    font-size: 0.9rem;
    line-height: 1.5;
}

/* Swipe gestures for day navigation */
.mobile-schedule-container {
    position: relative;
    overflow: hidden;
    touch-action: pan-y;
}

/* Progress indicator for current day */
.day-progress {
    background: var(--calendar-day);
    border-radius: 12px;
    padding: 12px;
    margin-bottom: 16px;
}

.day-progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.day-progress-title {
    font-weight: 700;
    color: var(--text-primary);
    font-size: 0.9rem;
}

.day-progress-percentage {
    font-weight: 800;
    color: var(--accent-blue);
    font-size: 0.9rem;
}

.day-progress-bar {
    height: 6px;
    background: var(--border-color);
    border-radius: 3px;
    overflow: hidden;
}

.day-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent-blue) 0%, var(--accent-blue-hover) 100%);
    border-radius: 3px;
    transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Quick action buttons */
.day-quick-actions {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
}

.quick-action-btn {
    flex: 1;
    padding: 12px;
    border: 1px solid var(--border-color);
    background: var(--bg-secondary);
    border-radius: 12px;
    font-size: 0.8rem;
    font-weight: 600;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
}

.quick-action-btn:hover,
.quick-action-btn.active {
    background: var(--accent-blue);
    color: white;
    border-color: var(--accent-blue);
    transform: translateY(-1px);
}

.quick-action-btn svg {
    width: 14px;
    height: 14px;
}

/* Hide desktop grid on mobile */
@media (max-width: 768px) {
    .desktop-layout {
        display: none !important;
    }
    
    .mobile-layout {
        display: block !important;
    }
    
    /* Adjust container for mobile day navigation */
    .schedule-grid-container.mobile-layout {
        padding: 0;
        background: transparent;
        border: none;
        box-shadow: none;
    }
}

/* Add this to your CSS section around line 1800 */

/* Enhanced Delete Account Modal Styling */
.delete-account-modal .auth-modal {
    max-width: 600px !important;
    width: 95% !important;
    max-height: 90vh !important;
    overflow-y: auto !important;
    margin: 20px !important;
}

.delete-warning-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 12px;
    margin-bottom: 20px;
}

.warning-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 12px;
    background: rgba(255, 255, 255, 0.7);
    border-radius: 12px;
    border-left: 4px solid var(--accent-red);
}

.backup-progress-modal .auth-modal {
    max-width: 450px !important;
    text-align: center;
}

.sync-progress-bar {
    width: 100%;
    height: 8px;
    background: var(--border-color);
    border-radius: 4px;
    overflow: hidden;
    margin: 16px 0;
}

.sync-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent-blue) 0%, var(--accent-blue-hover) 100%);
    width: 0%;
    transition: width 0.3s ease;
    border-radius: 4px;
}

@media (max-width: 768px) {
    .delete-account-modal .auth-modal {
        width: 98% !important;
        margin: 10px !important;
        max-height: 95vh !important;
    }
    
    .delete-warning-grid {
        grid-template-columns: 1fr;
        gap: 8px;
    }
    
    .warning-item {
        padding: 10px;
        font-size: 0.9rem;
    }
}

/* Add this to your existing CSS section around line 1900 */

.restore-item {
    animation: slideInFromLeft 0.5s ease-out both;
}

.restore-item:nth-child(1) { animation-delay: 0.1s; }
.restore-item:nth-child(2) { animation-delay: 0.2s; }
.restore-item:nth-child(3) { animation-delay: 0.3s; }
.restore-item:nth-child(4) { animation-delay: 0.4s; }
.restore-item:nth-child(5) { animation-delay: 0.5s; }
.restore-item:nth-child(6) { animation-delay: 0.6s; }

@keyframes slideInFromLeft {
    0% { 
        opacity: 0; 
        transform: translateX(-50px) scale(0.9); 
    }
    100% { 
        opacity: 0.6; 
        transform: translateX(0) scale(1); 
    }
}

/* Smooth scrollbar for restore items */
#restoreItemsList::-webkit-scrollbar {
    width: 6px;
}

#restoreItemsList::-webkit-scrollbar-track {
    background: var(--border-color);
    border-radius: 3px;
}

#restoreItemsList::-webkit-scrollbar-thumb {
    background: var(--accent-green);
    border-radius: 3px;
}

#restoreItemsList::-webkit-scrollbar-thumb:hover {
    background: #047857;
}

/* Enhanced Dashboard Design */
.dashboard-container {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 2px solid var(--glass-border);
    border-radius: 40px;
    margin-bottom: 32px;
    overflow: hidden;
    box-shadow: var(--shadow-xl);
    position: relative;
}

.dashboard-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, 
        var(--accent-blue) 0%, 
        #7c3aed 25%, 
        var(--accent-green) 50%, 
        #ea580c 75%, 
        #db2777 100%);
    opacity: 0.8;
}

/* Enhanced Tab Carousel */
.tab-carousel {
    position: relative;
    padding: 32px 80px 24px 80px;
    background: linear-gradient(135deg, 
        rgba(59, 130, 246, 0.03) 0%, 
        rgba(124, 58, 237, 0.03) 25%, 
        rgba(5, 150, 105, 0.03) 50%, 
        rgba(234, 88, 12, 0.03) 75%, 
        rgba(219, 39, 119, 0.03) 100%);
    border-bottom: 2px solid var(--glass-border);
}

/* Enhanced Schedule Grid */
.schedule-grid-container {
    background: transparent;
    border: none;
    border-radius: 0;
    margin-bottom: 0;
    box-shadow: none;
    padding: 32px;
    position: relative;
}

.schedule-grid-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, 
        rgba(59, 130, 246, 0.02) 0%, 
        rgba(124, 58, 237, 0.02) 25%, 
        rgba(5, 150, 105, 0.02) 50%, 
        rgba(234, 88, 12, 0.02) 75%, 
        rgba(219, 39, 119, 0.02) 100%);
    pointer-events: none;
}

.schedule-grid {
    background: var(--glass-bg);
    border: 2px solid var(--glass-border);
    border-radius: 24px;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
    backdrop-filter: blur(15px);
}

/* Enhanced Grid Headers */
.grid-header {
    background: linear-gradient(135deg, var(--calendar-header) 0%, rgba(59, 130, 246, 0.08) 100%);
    padding: 24px 16px;
    font-weight: 800;
    color: var(--accent-blue);
    font-size: 1.1rem;
    letter-spacing: 0.05em;
    text-transform: uppercase;
    border-bottom: 3px solid var(--glass-border);
    position: relative;
    text-align: center;
}

.grid-header::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 40%;
    height: 4px;
    background: linear-gradient(90deg, transparent, var(--accent-blue), transparent);
    border-radius: 2px;
}

.grid-header.today {
    background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%);
    color: white;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
}

.grid-header.today::before {
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
}

/* Enhanced Subject Labels */
.subject-label {
    background: linear-gradient(135deg, var(--calendar-header) 0%, rgba(59, 130, 246, 0.06) 100%);
    padding: 20px 16px;
    font-weight: 800;
    color: var(--accent-blue);
    font-size: 1rem;
    text-align: center;
    border-right: 3px solid var(--glass-border);
    min-height: 140px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: relative;
}

.subject-label::after {
    content: '';
    position: absolute;
    right: 0;
    top: 20%;
    bottom: 20%;
    width: 4px;
    background: linear-gradient(180deg, transparent, var(--accent-blue), transparent);
    border-radius: 2px;
}

/* Enhanced Schedule Cells */
.schedule-cell {
    background: var(--calendar-day);
    padding: 12px;
    min-height: 140px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    flex-direction: column;
    gap: 8px;
    overflow: hidden;
    position: relative;
    border-right: 1px solid var(--border-color);
    border-bottom: 1px solid var(--border-color);
}

.schedule-cell::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, 
        rgba(59, 130, 246, 0.01) 0%, 
        rgba(124, 58, 237, 0.01) 25%, 
        rgba(5, 150, 105, 0.01) 50%, 
        rgba(234, 88, 12, 0.01) 75%, 
        rgba(219, 39, 119, 0.01) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.schedule-cell:hover::before {
    opacity: 1;
}

.schedule-cell.today {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.08) 0%, rgba(59, 130, 246, 0.04) 100%);
    border: 2px solid rgba(59, 130, 246, 0.3);
    box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.2),
        0 4px 20px rgba(59, 130, 246, 0.15);
}

.schedule-cell:hover {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.06) 0%, rgba(124, 58, 237, 0.06) 100%);
    transform: scale(1.02);
    z-index: 10;
    box-shadow: 
        0 12px 32px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
    border-color: rgba(59, 130, 246, 0.3);
}

/* Enhanced Revision Cards */
.revision-card-mini {
    background: linear-gradient(135deg, var(--bg-secondary) 0%, rgba(255, 255, 255, 0.95) 100%);
    border: 2px solid var(--border-color);
    border-radius: 12px;
    padding: 10px 12px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    cursor: pointer;
    font-size: 0.8rem;
    box-shadow: 
        var(--shadow-sm),
        inset 0 1px 0 rgba(255, 255, 255, 0.5);
    min-height: 55px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    overflow: hidden;
}

.revision-card-mini::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, 
        rgba(59, 130, 246, 0.08) 0%, 
        rgba(124, 58, 237, 0.08) 50%, 
        rgba(5, 150, 105, 0.08) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.revision-card-mini:hover::before {
    opacity: 1;
}

.revision-card-mini:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
    border-color: var(--accent-blue);
    z-index: 5;
}

.revision-card-mini.completed {
    background: linear-gradient(135deg, 
        rgba(5, 150, 105, 0.12) 0%, 
        rgba(5, 150, 105, 0.08) 100%);
    border-color: var(--accent-green);
    opacity: 0.9;
}

.revision-card-mini.completed::before {
    background: linear-gradient(135deg, 
        rgba(5, 150, 105, 0.1) 0%, 
        rgba(34, 197, 94, 0.1) 100%);
    opacity: 0.8;
}

/* Enhanced Mini Card Content */
.revision-card-mini-title {
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 4px;
    line-height: 1.3;
    font-size: 0.85rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.revision-card-mini-topic {
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 6px;
    font-size: 0.75rem;
    line-height: 1.2;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
}

.revision-card-mini-meta {
    color: var(--text-muted);
    font-size: 0.7rem;
    display: flex;
    justify-content: space-between;
    font-weight: 600;
    margin-top: auto;
}

/* Enhanced Dashboard Stats */
.dashboard-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin: 32px 0;
    padding: 0 32px;
}

.dashboard-stat {
    background: var(--glass-bg);
    backdrop-filter: blur(20px);
    border: 2px solid var(--glass-border);
    border-radius: 20px;
    padding: 24px;
    text-align: center;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.dashboard-stat::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, 
        rgba(59, 130, 246, 0.05) 0%, 
        rgba(124, 58, 237, 0.05) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
}

.dashboard-stat:hover::before {
    opacity: 1;
}

.dashboard-stat:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
}

.dashboard-stat-number {
    font-size: 2.5rem;
    font-weight: 800;
    color: var(--accent-blue);
    margin-bottom: 8px;
    line-height: 1;
}

.dashboard-stat-label {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

/* Mobile Dashboard Enhancements */
@media (max-width: 768px) {
    .dashboard-container {
        border-radius: 20px;
        margin-bottom: 20px;
    }
    
    .tab-carousel {
        padding: 20px 40px 16px 40px;
    }
    
    .schedule-grid-container {
        padding: 16px;
    }
    
    .dashboard-stats {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin: 20px 0;
        padding: 0 16px;
    }
    
    .dashboard-stat {
        padding: 16px;
    }
    
    .dashboard-stat-number {
        font-size: 2rem;
    }
    
    .dashboard-stat-label {
        font-size: 0.8rem;
    }
}
    </style>
</head>
<body>
    <!-- Sidebar Trigger Area -->
    <div class="sidebar-trigger" onmouseenter="openSidebar()"></div>

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

    <!-- Sidebar -->
    <!-- Sidebar -->
<div class="sidebar" id="sidebar" onmouseleave="handleSidebarLeave(event)">
        <div class="sidebar-header">
            <h2>
                <svg class="icon icon-lg" viewBox="0 0 24 24">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9,22 9,12 15,12 15,22"/>
                </svg>
                Navigation
            </h2>
        </div>
        <nav class="sidebar-nav">
            <a href="#" class="sidebar-item active" onclick="showPage('home')">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9,22 9,12 15,12 15,22"/>
                </svg>
                Home
            </a>
            <a href="#" class="sidebar-item" onclick="showPage('dashboard')">
                <svg class="icon" viewBox="0 0 24 24">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                </svg>
                Dashboard
            </a>
            <a href="#" class="sidebar-item" onclick="showPage('progress')">
                <svg class="icon" viewBox="0 0 24 24">
                    <line x1="18" y1="20" x2="18" y2="10"/>
                    <line x1="12" y1="20" x2="12" y2="4"/>
                    <line x1="6" y1="20" x2="6" y2="14"/>
                </svg>
                Progress
            </a>
            <a href="#" class="sidebar-item" onclick="showPage('settings')">
                <svg class="icon" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
                Settings
            </a>
        </nav>
    </div>

    <!-- Header -->
<header class="header">
    <div class="header-left">
        <button class="hamburger-menu" id="hamburgerMenu" onclick="toggleSidebarMobile()">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <h1>GCSE Revision Planner</h1>
    </div>
</header>

       <!-- Home Page -->
<div id="home" class="page active">
    <div class="card">
        <h2 style="color: var(--accent-blue); margin-bottom: 24px; font-size: 1.8rem; font-weight: 800;">Create Your Personalized Revision Schedule</h2>
        <form onsubmit="generateSchedule(event)">
            <div class="input-group">
                <label for="subjects">Enter your GCSE subjects (comma-separated):</label>
                <input 
                    type="text" 
                    id="subjects" 
                    placeholder="e.g., English Literature, Mathematics, Biology, Chemistry, History" 
                    required 
                />
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 24px;">
                <div class="input-group">
                    <label for="currentGrade">Current Grade Level:</label>
                    <select id="currentGrade" class="settings-select" style="width: 100%;" required>
                        <option value="">Select your current grade</option>
                        <option value="grade-9">Grade 9 (Excellent)</option>
                        <option value="grade-8">Grade 8 (Very Good)</option>
                        <option value="grade-7">Grade 7 (Good)</option>
                        <option value="grade-6">Grade 6 (Above Average)</option>
                        <option value="grade-5">Grade 5 (Average)</option>
                        <option value="grade-4">Grade 4 (Below Average)</option>
                        <option value="grade-3">Grade 3 (Needs Improvement)</option>
                        <option value="struggling">Struggling with GCSEs</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="examBoard">Exam Board:</label>
                    <select id="examBoard" class="settings-select" style="width: 100%;" required>
                        <option value="">Select your exam board</option>
                        <option value="aqa">AQA</option>
                        <option value="edexcel">Edexcel/Pearson</option>
                        <option value="ocr">OCR</option>
                        <option value="wjec">WJEC</option>
                        <option value="ccea">CCEA</option>
                        <option value="mixed">Mixed Boards</option>
                    </select>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 24px;">
                <div class="input-group">
                    <label for="examType">Exam Type:</label>
                    <select id="examType" class="settings-select" style="width: 100%;" required>
                        <option value="">Select exam type</option>
                        <option value="gcse">GCSE Final Exams</option>
                        <option value="mock">Mock Exams</option>
                        <option value="practice">Practice/Assessment</option>
                    </select>
                </div>

                <div class="input-group">
                    <label for="daysUntilExam">Days until exam:</label>
                    <select id="daysUntilExam" class="settings-select" style="width: 100%;" required>
                        <option value="">Select timeframe</option>
                        <option value="7">1 week (Intensive Review)</option>
                        <option value="14">2 weeks (Quick Prep)</option>
                        <option value="30">1 month (Standard)</option>
                        <option value="60">2 months (Comprehensive)</option>
                        <option value="90">3 months (Thorough)</option>
                        <option value="120">4+ months (Long-term)</option>
                        <option value="custom">Custom timeframe</option>
                    </select>
                </div>
            </div>

            <div class="input-group" id="customDaysGroup" style="display: none;">
                <label for="customDays">Enter custom number of days:</label>
                <input 
                    type="number" 
                    id="customDays" 
                    placeholder="Enter number of days until exam" 
                    min="1" 
                    max="365"
                />
            </div>

            <div class="input-group">
                <label for="studyIntensity">Study Intensity Level:</label>
                <select id="studyIntensity" class="settings-select" style="width: 100%;" required>
                    <option value="">Select intensity</option>
                    <option value="light">Light (1-2 hours/day)</option>
                    <option value="moderate">Moderate (2-4 hours/day)</option>
                    <option value="intensive">Intensive (4-6 hours/day)</option>
                    <option value="exam-mode">Exam Mode (6+ hours/day)</option>
                </select>
            </div>

            <button type="submit" class="btn-primary" id="generateBtn">
                <svg class="icon" viewBox="0 0 24 24">
                    <polygon points="13,2 3,14 12,14 11,22 21,10 12,10 13,2"/>
                </svg>
                Create Personalized Schedule
            </button>
        </form>
    </div>
</div>

        <!-- Dashboard Page -->
        <div id="dashboard" class="page">
            <div class="tab-carousel" id="scheduleTabsCarousel">
                <!-- Tabs will be dynamically added here -->
            </div>
            
            <!-- Loading Animation -->
            <div class="loading-container" id="loadingContainer">
                <h3 style="color: var(--accent-blue); margin-bottom: 24px; text-align: center; font-weight: 800; font-size: 1.6rem;">
                    Generating your personalized revision schedule...
                </h3>
                <div class="loading-grid" id="loadingGrid">
                    <!-- Loading cards will be generated here -->
                </div>
            </div>

            <!-- Schedule Content -->
            <div id="scheduleContent">
                <div class="empty-state">
                    <h3>No schedules created yet</h3>
                    <p>Go to the Home page to create your first revision schedule</p>
                </div>
            </div>
        </div>

        <!-- Progress Page -->
        <div id="progress" class="page">
            <div class="card">
                <h2 style="color: var(--accent-blue); margin-bottom: 24px; font-size: 1.8rem; font-weight: 800;">Your Progress</h2>
                <div id="progressContent">
                    <div class="empty-state">
                        <h3>No progress data yet</h3>
                        <p>Complete some revision tasks to see your progress here</p>
                    </div>
                </div>
            </div>
        </div>

       <!-- Settings Page -->
<div id="settings" class="page">
    <div class="card">
        <h2 style="color: var(--accent-blue); margin-bottom: 24px; font-size: 1.8rem; font-weight: 800;">Settings & Preferences</h2>
        
        <div class="settings-grid">
            <div class="settings-card">
                <h4>
                    <svg class="icon" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="10"/>
                        <polygon points="10,8 16,12 10,16 10,8"/>
                    </svg>
                    Study Sessions
                </h4>
                <p>Customize your default study session length and break intervals</p>
                <div class="settings-control">
                    <label style="color: var(--text-secondary); font-weight: 600;">Session Length:</label>
                    <select class="settings-select" id="sessionLength" onchange="updateSessionLength(this.value)">
                        <option value="30">30 minutes</option>
                        <option value="45" selected>45 minutes</option>
                        <option value="60">60 minutes</option>
                        <option value="90">90 minutes</option>
                    </select>
                </div>
                <div class="settings-control">
                    <label style="color: var(--text-secondary); font-weight: 600;">Break Length:</label>
                    <select class="settings-select" id="breakLength" onchange="updateBreakLength(this.value)">
                        <option value="5">5 minutes</option>
                        <option value="10" selected>10 minutes</option>
                        <option value="15">15 minutes</option>
                        <option value="20">20 minutes</option>
                    </select>
                </div>
            </div>

            <div class="settings-card">
                <h4>
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                    </svg>
                    Notifications
                </h4>
                <p>Set up reminders for your study sessions and break times</p>
                <div class="settings-control">
                    <label style="color: var(--text-secondary); font-weight: 600;">Study Reminders:</label>
                    <div class="settings-toggle" id="studyNotifications" onclick="toggleNotifications('study')"></div>
                </div>
                <div class="settings-control">
                    <label style="color: var(--text-secondary); font-weight: 600;">Break Reminders:</label>
                    <div class="settings-toggle" id="breakNotifications" onclick="toggleNotifications('break')"></div>
                </div>
            </div>

            <div class="settings-card">
                <h4>
                    <svg class="icon" viewBox="0 0 24 24">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M12 1v6m0 6v6"/>
                        <path d="M1 12h6m6 0h6"/>
                    </svg>
                    Theme Options
                </h4>
                <p>Choose between Light or Dark theme</p>
                <div class="theme-selector">
                    <div class="theme-option theme-white active" onclick="changeTheme('white')" title="Light Theme">
                        <div style="width: 100%; height: 100%; border-radius: 9px; background: linear-gradient(135deg, #ffffff 0%, #f3f4f6 100%); display: flex; align-items: center; justify-content: center; color: #374151; font-weight: 800; font-size: 10px;">Light</div>
                    </div>
                    <div class="theme-option theme-black" onclick="changeTheme('black')" title="Dark Theme">
                        <div style="width: 100%; height: 100%; border-radius: 9px; background: linear-gradient(135deg, #0f172a 0%, #334155 100%); display: flex; align-items: center; justify-content: center; color: #f1f5f9; font-weight: 800; font-size: 10px;">Dark</div>
                    </div>
                </div>
            </div>

            <div class="settings-card">
                <h4>
                    <svg class="icon" viewBox="0 0 24 24">
                        <polyline points="23 4 23 10 17 10"/>
                        <polyline points="1 20 1 14 7 14"/>
                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                    </svg>
                    Backup & Sync
                </h4>
                <p>Sync your data across devices and create automatic backups</p>
                <div class="settings-control">
                    <button class="btn-secondary" onclick="createBackup()">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17,8 12,3 7,8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        Create Backup
                    </button>
                    <button class="btn-secondary" onclick="restoreBackup()">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M3 15v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4"/>
                            <polyline points="7,10 12,15 17,10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Restore Backup
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Bottom Navigation for Mobile -->
<div class="bottom-nav" id="bottomNav">
    <div class="bottom-nav-container">
        <div class="bottom-nav-item active" onclick="navigateToPage('home')" onmousedown="triggerHaptic(this)">
            <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9,22 9,12 15,12 15,22"/>
            </svg>
            <span class="bottom-nav-label">Home</span>
        </div>
        
        <div class="bottom-nav-item" onclick="navigateToPage('dashboard')" onmousedown="triggerHaptic(this)">
            <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
            </svg>
            <span class="bottom-nav-label">Dashboard</span>
        </div>
        
        <div class="bottom-nav-item" onclick="navigateToPage('progress')" onmousedown="triggerHaptic(this)">
            <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="20" x2="18" y2="10"/>
                <line x1="12" y1="20" x2="12" y2="4"/>
                <line x1="6" y1="20" x2="6" y2="14"/>
            </svg>
            <span class="bottom-nav-label">Progress</span>
        </div>
        
        <div class="bottom-nav-item" onclick="navigateToPage('settings')" onmousedown="triggerHaptic(this)">
            <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
            <span class="bottom-nav-label">Settings</span>
        </div>
    </div>
</div>

<!-- Add this as a new settings card -->
<div class="settings-card">
    <h4>
        
    </h4>
        <!-- Past paper slots will be generated here -->
    </div>
</div>

    <!-- Dropdown overlay for closing when clicking outside -->
    <div id="dropdownOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 999; display: none;" onclick="closeAllDropdowns()"></div>

    <!-- Authentication Modal -->
<div class="auth-overlay" id="authOverlay">
    <div class="auth-modal">
        <button class="auth-close" onclick="closeAuthModal()">
            <svg class="icon" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        </button>
        
        <div class="auth-header">
            <h2>Welcome to GCSE Planner</h2>
            <p>Sign in to sync your progress across devices</p>
        </div>
        
        <div class="auth-tabs">
            <div class="auth-tab active" onclick="switchAuthTab('login')">Sign In</div>
            <div class="auth-tab" onclick="switchAuthTab('signup')">Sign Up</div>
        </div>
        
        <!-- Login Form -->
        <form class="auth-form active" id="loginForm" onsubmit="handleLogin(event)">
            <div class="auth-input-group">
                <label for="loginEmail">Email Address</label>
                <input type="email" id="loginEmail" class="auth-input" required placeholder="Enter your email">
            </div>
            <div class="auth-input-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" class="auth-input" required placeholder="Enter your password">
            </div>
            <button type="submit" class="auth-submit">Sign In</button>
        </form>
        
        <!-- Signup Form -->
        <form class="auth-form" id="signupForm" onsubmit="handleSignup(event)">
            <div class="auth-input-group">
                <label for="signupName">Full Name</label>
                <input type="text" id="signupName" class="auth-input" required placeholder="Enter your full name">
            </div>
            <div class="auth-input-group">
                <label for="signupEmail">Email Address</label>
                <input type="email" id="signupEmail" class="auth-input" required placeholder="Enter your email">
            </div>
            <div class="auth-input-group">
                <label for="signupPassword">Password</label>
                <input type="password" id="signupPassword" class="auth-input" required placeholder="Create a password" minlength="6">
            </div>
            <div class="auth-input-group">
                <label for="confirmPassword">Confirm Password</label>
                <input type="password" id="confirmPassword" class="auth-input" required placeholder="Confirm your password" minlength="6">
            </div>
            <button type="submit" class="auth-submit">Create Account</button>
        </form>
    </div>
</div>

    <script>
        // Global variables with proper initialization
let appState = {
    schedules: {},
    activeSchedule: null,
    currentPage: 'home',
    currentTabIndex: 0,
    visibleTabCount: 2,
    showingCompleted: false,
    isInitialized: false
};

let activeDropdown = null;
let sidebarTimeout = null;
let navigationTimeout = null;
let isNavigating = false;
let isSidebarOpen = false; // Add this global variable

        // Enhanced Past Papers Data with Exam Board Support
        let examBoardPastPapers = {
            aqa: {
                mathematics: [
                    'https://filestore.aqa.org.uk/sample-papers-and-mark-schemes/2023/june/AQA-83001H-QP-JUN23.PDF',
                    'https://filestore.aqa.org.uk/sample-papers-and-mark-schemes/2023/november/AQA-83002H-QP-NOV23.PDF'
                ],
                'english literature': [
                    'https://filestore.aqa.org.uk/sample-papers-and-mark-schemes/2023/june/AQA-87001-QP-JUN23.PDF',
                    'https://filestore.aqa.org.uk/sample-papers-and-mark-schemes/2023/november/AQA-87002-QP-NOV23.PDF'
                ],
                biology: [
                    'https://filestore.aqa.org.uk/sample-papers-and-mark-schemes/2023/june/AQA-84641H-QP-JUN23.PDF'
                ],
                chemistry: [
                    'https://filestore.aqa.org.uk/sample-papers-and-mark-schemes/2023/june/AQA-84651H-QP-JUN23.PDF'
                ],
                physics: [
                    'https://filestore.aqa.org.uk/sample-papers-and-mark-schemes/2023/june/AQA-84631H-QP-JUN23.PDF'
                ],
                history: [
                    'https://filestore.aqa.org.uk/sample-papers-and-mark-schemes/2023/june/AQA-84031-QP-JUN23.PDF'
                ],
                geography: [
                    'https://filestore.aqa.org.uk/sample-papers-and-mark-schemes/2023/june/AQA-84031-QP-JUN23.PDF'
                ],
                'computer science': [
                    'https://filestore.aqa.org.uk/sample-papers-and-mark-schemes/2023/june/AQA-84521-QP-JUN23.PDF'
                ]
            },
            edexcel: {
                mathematics: [
                    'https://cdn.sanity.io/files/p28bar15/green/81f858bbcacde1898015f88a8b3fdfec08453a75.pdf',
                    'https://filesamples.com/samples/document/pdf/sample3.pdf'
                ],
                'english literature': [
                    'https://filesamples.com/samples/document/pdf/sample2.pdf'
                ],
                biology: [
                    'https://filesamples.com/samples/document/pdf/sample3.pdf'
                ],
                chemistry: [
                    'https://filesamples.com/samples/document/pdf/sample1.pdf'
                ],
                physics: [
                    'https://filesamples.com/samples/document/pdf/sample2.pdf'
                ]
            },
            ocr: {
                mathematics: [
                    'https://filesamples.com/samples/document/pdf/sample1.pdf'
                ],
                'computer science': [
                    'https://filesamples.com/samples/document/pdf/sample2.pdf'
                ],
                biology: [
                    'https://filesamples.com/samples/document/pdf/sample3.pdf'
                ]
            },
            wjec: {
                mathematics: [
                    'https://filesamples.com/samples/document/pdf/sample1.pdf'
                ],
                'english literature': [
                    'https://filesamples.com/samples/document/pdf/sample2.pdf'
                ]
            },
            ccea: {
                mathematics: [
                    'https://filesamples.com/samples/document/pdf/sample3.pdf'
                ]
            }
        };

        // Comprehensive Past Papers Data with Multiple URLs and Alternative Names
        let pastPapersData = {
            // Mathematics variants
            mathematics: [
                'https://cdn.sanity.io/files/p28bar15/green/81f858bbcacde1898015f88a8b3fdfec08453a75.pdf',
                'https://filesamples.com/samples/document/pdf/sample3.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
                'https://filesamples.com/samples/document/pdf/sample1.pdf'
            ],
            maths: [
                'https://cdn.sanity.io/files/p28bar15/green/81f858bbcacde1898015f88a8b3fdfec08453a75.pdf',
                'https://filesamples.com/samples/document/pdf/sample3.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
                'https://filesamples.com/samples/document/pdf/sample1.pdf'
            ],
            
            // English variants
            english: [
                'https://filesamples.com/samples/document/pdf/sample2.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
                'https://filesamples.com/samples/document/pdf/sample1.pdf'
            ],
            'english literature': [
                'https://filesamples.com/samples/document/pdf/sample2.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            'english language': [
                'https://cdn.sanity.io/files/p28bar15/green/28842ff0d169e821a8ef19ba98a123c2454f2ff6.pdf',
                'https://filestore.aqa.org.uk/sample-papers-and-mark-schemes/2023/june/AQA-87002-QP-JUN23.PDF'
            ],
            
            // Science subjects
            biology: [
                'https://filesamples.com/samples/document/pdf/sample3.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
                'https://filesamples.com/samples/document/pdf/sample2.pdf'
            ],
            bio: [
                'https://filesamples.com/samples/document/pdf/sample3.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            
            chemistry: [
                'https://filesamples.com/samples/document/pdf/sample1.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
                'https://filesamples.com/samples/document/pdf/sample3.pdf'
            ],
            chem: [
                'https://filesamples.com/samples/document/pdf/sample1.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            
            physics: [
                'https://filesamples.com/samples/document/pdf/sample2.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
                'https://filesamples.com/samples/document/pdf/sample1.pdf'
            ],
            
            // Humanities
            history: [
                'https://filesamples.com/samples/document/pdf/sample3.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
                'https://filesamples.com/samples/document/pdf/sample2.pdf'
            ],
            
            geography: [
                'https://filesamples.com/samples/document/pdf/sample1.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf',
                'https://filesamples.com/samples/document/pdf/sample3.pdf'
            ],
            geo: [
                'https://filesamples.com/samples/document/pdf/sample1.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            
            // Technology and Arts
            'computer science': [
                'https://filesamples.com/samples/document/pdf/sample2.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            'computing': [
                'https://filesamples.com/samples/document/pdf/sample2.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            'ict': [
                'https://filesamples.com/samples/document/pdf/sample3.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            
            art: [
                'https://filesamples.com/samples/document/pdf/sample1.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            'art and design': [
                'https://filesamples.com/samples/document/pdf/sample1.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            
            // Languages
            french: [
                'https://filesamples.com/samples/document/pdf/sample2.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            spanish: [
                'https://filesamples.com/samples/document/pdf/sample3.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            german: [
                'https://filesamples.com/samples/document/pdf/sample1.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            
            // Other subjects
            'religious studies': [
                'https://filesamples.com/samples/document/pdf/sample2.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            'rs': [
                'https://filesamples.com/samples/document/pdf/sample2.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            
            'business studies': [
                'https://filesamples.com/samples/document/pdf/sample3.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            'business': [
                'https://filesamples.com/samples/document/pdf/sample3.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            
            psychology: [
                'https://filesamples.com/samples/document/pdf/sample1.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            
            sociology: [
                'https://filesamples.com/samples/document/pdf/sample2.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            
            drama: [
                'https://filesamples.com/samples/document/pdf/sample3.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            
            music: [
                'https://filesamples.com/samples/document/pdf/sample1.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            
            'physical education': [
                'https://filesamples.com/samples/document/pdf/sample2.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ],
            'pe': [
                'https://filesamples.com/samples/document/pdf/sample2.pdf',
                'https://www.w3.org/WAI/ER/tests/xhtml/testfiles/resources/pdf/dummy.pdf'
            ]
        };

        // Settings
        let userSettings = {
            sessionLength: 45,
            breakLength: 10,
            studyNotifications: false,
            breakNotifications: false,
            theme: 'white'
        };

        function openSidebar() {
    clearTimeout(sidebarTimeout);
    
    const sidebar = document.getElementById('sidebar');
    const container = document.getElementById('container');
    const overlay = document.getElementById('sidebarOverlay');
    
    if (sidebar) sidebar.classList.add('open');
    if (container) container.classList.add('sidebar-open');
    if (overlay) overlay.classList.add('show');
}

        function handleSidebarLeave(event) {
    // Only auto-close on desktop
    if (window.innerWidth > 768) {
        sidebarTimeout = setTimeout(() => {
            const trigger = document.querySelector('.sidebar-trigger');
            if (trigger && event && event.clientX !== undefined) {
                const rect = trigger.getBoundingClientRect();
                const mouseX = event.clientX;
                if (mouseX > rect.right) {
                    closeSidebar();
                }
            } else {
                // Fallback - just close the sidebar
                closeSidebar();
            }
        }, 300);
    }
}

        function closeSidebar() {
    clearTimeout(sidebarTimeout);
    
    const sidebar = document.getElementById('sidebar');
    const hamburger = document.getElementById('hamburgerMenu');
    const overlay = document.getElementById('sidebarOverlay');
    const container = document.getElementById('container');
    const body = document.body;
    
    if (sidebar) sidebar.classList.remove('open');
    if (hamburger) hamburger.classList.remove('active');
    if (overlay) overlay.classList.remove('show');
    if (container) container.classList.remove('sidebar-open');
    if (body) body.classList.remove('sidebar-open-mobile');
    
    if (typeof isSidebarOpen !== 'undefined') {
        isSidebarOpen = false;
    }
}
        function showPage(pageId) {
    const currentPage = document.querySelector('.page.active');
    const targetPage = document.getElementById(pageId);
    
    if (!targetPage || currentPage === targetPage) return;
    
    // Special handling for dashboard
    if (pageId === 'dashboard') {
        // Pre-load dashboard content for smooth transition
        ensureMostRecentScheduleActive();
        updateScheduleTabs();
        
        // Start loading schedule content immediately
        setTimeout(() => {
            updateScheduleContent();
            updateCenteredCarousel();
        }, 100);
    }
    
    // Close mobile sidebar properly with null checks
    if (window.innerWidth <= 768) {
        const sidebar = document.getElementById('sidebar');
        const hamburger = document.getElementById('hamburgerMenu');
        const overlay = document.getElementById('sidebarOverlay');
        const container = document.getElementById('container');
        const body = document.body;
        
        if (sidebar) sidebar.classList.remove('open');
        if (hamburger) hamburger.classList.remove('active');
        if (overlay) overlay.classList.remove('show');
        if (container) container.classList.remove('sidebar-open');
        if (body) body.classList.remove('sidebar-open-mobile');
        
        if (typeof isSidebarOpen !== 'undefined') {
            isSidebarOpen = false;
        }
    } else {
        closeSidebar();
    }
    
    if (currentPage) {
        currentPage.classList.add('transitioning-out');
    }
    
    setTimeout(() => {
        if (currentPage) {
            currentPage.classList.remove('active', 'transitioning-out');
        }
        
        targetPage.classList.add('transitioning-in');
        targetPage.classList.add('active');
        
        // Complete dashboard loading after transition
        if (pageId === 'dashboard') {
            setTimeout(() => {
                updateCenteredCarousel();
            }, 50);
        }
        
        setTimeout(() => {
            targetPage.classList.remove('transitioning-in');
        }, 50);
    }, 200);
    
    // Update sidebar item states
    document.querySelectorAll('.sidebar-item').forEach(item => {
        item.classList.remove('active');
    });
    
    const sidebarItem = document.querySelector(`[onclick="showPage('${pageId}')"]`);
    if (sidebarItem) {
        const closestItem = sidebarItem.closest('.sidebar-item');
        if (closestItem) closestItem.classList.add('active');
    }
    
    appState.currentPage = pageId;
    saveAppState();

    if (window.innerWidth <= 768) {
        updateBottomNavigation(pageId);
    }
}

        function viewScheduleFromProgress(scheduleId) {
            event.target.style.transform = 'translateY(-8px) scale(0.95)';
            
            setTimeout(() => {
                appState.activeSchedule = scheduleId;
                appState.currentTabIndex = 0;
                saveAppState();
                
                showPage('dashboard');
                
                setTimeout(() => {
                    updateDashboard();
                }, 300);
                
                event.target.style.transform = '';
            }, 150);
        }

        // Schedule Generation with Duplicate Detection
        async function generateSchedule(event) {
            event.preventDefault();
            
            const subjectsInput = document.getElementById('subjects');
            const currentGrade = document.getElementById('currentGrade');
            const examBoard = document.getElementById('examBoard');
            const examType = document.getElementById('examType');
            const daysUntilExam = document.getElementById('daysUntilExam');
            const customDays = document.getElementById('customDays');
            const studyIntensity = document.getElementById('studyIntensity');
            
            if (!subjectsInput?.value.trim()) {
                showAlert('Please enter your subjects', 'error');
                return;
            }
            
            if (!currentGrade?.value || !examBoard?.value || !examType?.value || !daysUntilExam?.value || !studyIntensity?.value) {
                showAlert('Please fill in all required fields', 'error');
                return;
            }
            
            let totalDays;
            if (daysUntilExam.value === 'custom') {
                totalDays = parseInt(customDays.value);
                if (!totalDays || totalDays < 1) {
                    showAlert('Please enter a valid number of days', 'error');
                    return;
                }
            } else {
                totalDays = parseInt(daysUntilExam.value);
            }
            
            const subjects = subjectsInput.value.split(',').map(s => s.trim()).filter(s => s);
            const scheduleName = subjects.join(', ');
            
            const existingSchedule = findSimilarSchedule(scheduleName, subjects);
            if (existingSchedule) {
                showDuplicateModal(scheduleName, subjects, {
                    currentGrade: currentGrade.value,
                    examBoard: examBoard.value,
                    examType: examType.value,
                    daysUntilExam: totalDays,
                    studyIntensity: studyIntensity.value,
                    examDate: new Date(Date.now() + totalDays * 24 * 60 * 60 * 1000)
                }, existingSchedule);
                return;
            }
            
            createNewSchedule(subjects, {
                currentGrade: currentGrade.value,
                examBoard: examBoard.value,
                examType: examType.value,
                daysUntilExam: totalDays,
                studyIntensity: studyIntensity.value,
                examDate: new Date(Date.now() + totalDays * 24 * 60 * 60 * 1000)
            });
            
            document.querySelector('form').reset();
        }

        // Helper functions for duplicate detection
        function findSimilarSchedule(scheduleName, subjects) {
            for (const [scheduleId, schedule] of Object.entries(appState.schedules)) {
                if (schedule.name === scheduleName) {
                    return { id: scheduleId, schedule: schedule, type: 'exact' };
                }
                
                const similarity = calculateSubjectSimilarity(subjects, schedule.subjects);
                if (similarity > 0.8) {
                    return { id: scheduleId, schedule: schedule, type: 'similar' };
                }
            }
            return null;
        }

        function calculateSubjectSimilarity(subjects1, subjects2) {
            const set1 = new Set(subjects1.map(s => s.toLowerCase().trim()));
            const set2 = new Set(subjects2.map(s => s.toLowerCase().trim()));
            
            const intersection = new Set([...set1].filter(x => set2.has(x)));
            const union = new Set([...set1, ...set2]);
            
            return intersection.size / union.size;
        }

        function showDuplicateModal(scheduleName, subjects, scheduleData, existingSchedule) {
            const modal = document.createElement('div');
            modal.className = 'duplicate-modal-overlay';
            modal.innerHTML = `
                <div class="duplicate-modal">
                    <h3>Schedule Already Exists</h3>
                    <p>A schedule with ${existingSchedule.type === 'exact' ? 'the same name' : 'similar subjects'} already exists: "<strong>${existingSchedule.schedule.name}</strong>"</p>
                    <p>Would you like to replace the existing schedule or add this as a new schedule?</p>
                    <div class="duplicate-modal-buttons">
                        <button class="duplicate-modal-button replace" onclick="replaceExistingSchedule('${existingSchedule.id}', '${JSON.stringify(subjects).replace(/"/g, '&quot;')}', '${JSON.stringify(scheduleData).replace(/"/g, '&quot;')}')">
                            Replace Current
                        </button>
                        <button class="duplicate-modal-button add-new" onclick="addAsNewSchedule('${JSON.stringify(subjects).replace(/"/g, '&quot;')}', '${JSON.stringify(scheduleData).replace(/"/g, '&quot;')}')">
                            Add as New
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            setTimeout(() => {
                modal.classList.add('show');
            }, 100);
        }

        function replaceExistingSchedule(existingId, subjectsJson, scheduleDataJson) {
            const subjects = JSON.parse(subjectsJson.replace(/&quot;/g, '"'));
            const scheduleData = JSON.parse(scheduleDataJson.replace(/&quot;/g, '"'));
            
            delete appState.schedules[existingId];
            
            createNewSchedule(subjects, scheduleData, existingId);
            
            closeDuplicateModal();
            showAlert('Schedule replaced successfully!', 'success');
        }

        function addAsNewSchedule(subjectsJson, scheduleDataJson) {
            const subjects = JSON.parse(subjectsJson.replace(/&quot;/g, '"'));
            const scheduleData = JSON.parse(scheduleDataJson.replace(/&quot;/g, '"'));
            
            createNewSchedule(subjects, scheduleData);
            
            closeDuplicateModal();
            showAlert('New schedule created successfully!', 'success');
        }

        function closeDuplicateModal() {
            const modal = document.querySelector('.duplicate-modal-overlay');
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.remove();
                }, 400);
            }
        }

        function createNewSchedule(subjects, scheduleData, existingId = null) {
            const scheduleId = existingId || `schedule_${Date.now()}`;
            
            showDashboardWithLoading();
            
            createPersonalizedSchedule(scheduleId, { subjects, ...scheduleData });
            
            setTimeout(() => {
                hideLoading();
                switchToSchedule(scheduleId);
            }, 1500);
        }

        function showDashboardWithLoading() {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById('dashboard').classList.add('active');
            
            document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));
            document.querySelector('[onclick="showPage(\'dashboard\')"]').closest('.sidebar-item').classList.add('active');
            
            document.getElementById('loadingContainer').classList.add('show');
            document.getElementById('scheduleContent').innerHTML = '';
            
            const loadingGrid = document.getElementById('loadingGrid');
            loadingGrid.innerHTML = '';
            for (let i = 0; i < 6; i++) {
                const loadingCard = document.createElement('div');
                loadingCard.className = 'loading-card';
                loadingGrid.appendChild(loadingCard);
            }
        }

        function hideLoading() {
            document.getElementById('loadingContainer').classList.remove('show');
        }

        // Personalized Schedule Creation
        function createPersonalizedSchedule(scheduleId, scheduleData) {
            const { subjects, currentGrade, examBoard, examType, daysUntilExam, studyIntensity } = scheduleData;
            
            const intensityMultipliers = {
                'light': 0.6,
                'moderate': 1.0,
                'intensive': 1.5,
                'exam-mode': 2.0
            };
            
            const gradeAdjustments = {
                'grade-9': { advanced: 0.6, medium: 0.3, easy: 0.1 },
                'grade-8': { advanced: 0.5, medium: 0.4, easy: 0.1 },
                'grade-7': { advanced: 0.4, medium: 0.4, easy: 0.2 },
                'grade-6': { advanced: 0.3, medium: 0.5, easy: 0.2 },
                'grade-5': { advanced: 0.2, medium: 0.5, easy: 0.3 },
                'grade-4': { advanced: 0.1, medium: 0.4, easy: 0.5 },
                'grade-3': { advanced: 0.05, medium: 0.3, easy: 0.65 },
                'struggling': { advanced: 0.0, medium: 0.2, easy: 0.8 }
            };
            
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            const weeklySchedule = {};
            
            let sessionsPerDay;
            if (daysUntilExam <= 7) {
                sessionsPerDay = Math.min(6, Math.max(3, Math.floor(subjects.length * 1.2 * intensityMultipliers[studyIntensity])));
            } else if (daysUntilExam <= 30) {
                sessionsPerDay = Math.min(4, Math.max(2, Math.floor(subjects.length * 0.8 * intensityMultipliers[studyIntensity])));
            } else {
                sessionsPerDay = Math.min(3, Math.max(1, Math.floor(subjects.length * 0.6 * intensityMultipliers[studyIntensity])));
            }
            
            days.forEach((day, dayIndex) => {
                weeklySchedule[day] = createDaySchedule(day, subjects, sessionsPerDay, currentGrade, daysUntilExam, gradeAdjustments);
            });
            
            createRevisionScheduleFromData(scheduleId, subjects, weeklySchedule, scheduleData);
        }

        function createDaySchedule(day, subjects, sessionsPerDay, currentGrade, daysUntilExam, gradeAdjustments) {
            const isWeekend = day === 'Saturday' || day === 'Sunday';
            const adjustedSessions = isWeekend ? Math.max(1, Math.floor(sessionsPerDay * 0.7)) : sessionsPerDay;
            
            const schedule = [];
            const gradeProfile = gradeAdjustments[currentGrade] || gradeAdjustments['grade-5'];
            
            const topicsByUrgency = getTopicsByUrgency(subjects, daysUntilExam);
            
            for (let i = 0; i < adjustedSessions; i++) {
                const subject = subjects[i % subjects.length];
                const topics = topicsByUrgency[subject] || [`${subject} Review`];
                const topic = topics[Math.floor(Math.random() * topics.length)];
                
                let difficulty;
                const random = Math.random();
                if (random < gradeProfile.easy) {
                    difficulty = 'Easy';
                } else if (random < gradeProfile.easy + gradeProfile.medium) {
                    difficulty = 'Medium';
                } else {
                    difficulty = 'Hard';
                }
                
                const baseHour = isWeekend ? 10 : 16;
                const startHour = baseHour + i;
                const time = `${startHour.toString().padStart(2, '0')}:00-${(startHour + 1).toString().padStart(2, '0')}:00`;
                
                schedule.push({
                    subject: subject,
                    topic: topic,
                    time: time,
                    difficulty: difficulty,
                    urgency: daysUntilExam <= 14 ? 'High' : daysUntilExam <= 30 ? 'Medium' : 'Low'
                });
            }
            
            return schedule;
        }

        function getTopicsByUrgency(subjects, daysUntilExam) {
            const urgentTopics = {
                'Mathematics': ['Past Paper Practice', 'Exam Technique', 'Formula Review', 'Common Mistakes'],
                'English Literature': ['Quote Memorization', 'Essay Structure', 'Key Themes', 'Character Analysis'],
                'Biology': ['Key Diagrams', 'Practical Skills', 'Exam Questions', 'Core Concepts'],
                'Chemistry': ['Equations Practice', 'Practical Methods', 'Calculations', 'Key Reactions'],
                'Physics': ['Formula Application', 'Graph Analysis', 'Practical Skills', 'Problem Solving'],
                'History': ['Timeline Review', 'Key Dates', 'Source Analysis', 'Essay Practice'],
                'Geography': ['Case Studies', 'Map Skills', 'Key Terms', 'Diagram Practice'],
                'Computer Science': ['Algorithm Practice', 'Code Debugging', 'Theory Review', 'Past Papers'],
                'Art': ['Portfolio Review', 'Technique Practice', 'Artist Analysis', 'Final Pieces']
            };
            
            const standardTopics = {
                'Mathematics': ['Algebra', 'Geometry', 'Statistics', 'Trigonometry', 'Number'],
                'English Literature': ['Context', 'Language Analysis', 'Structure', 'Writer\'s Methods'],
                'Biology': ['Cell Biology', 'Genetics', 'Ecology', 'Human Biology'],
                'Chemistry': ['Atomic Structure', 'Bonding', 'Rates', 'Organic Chemistry'],
                'Physics': ['Forces', 'Energy', 'Waves', 'Electricity', 'Magnetism'],
                'History': ['Medieval', 'Modern', 'Social History', 'Political Changes'],
                'Geography': ['Physical Geography', 'Human Geography', 'Environmental Issues', 'Development'],
                'Computer Science': ['Programming', 'Data Structures', 'Computer Systems', 'Algorithms'],
                'Art': ['Drawing', 'Painting', 'Sculpture', 'Digital Art']
            };
            
            const topics = {};
            subjects.forEach(subject => {
                if (daysUntilExam <= 14) {
                    topics[subject] = urgentTopics[subject] || [`${subject} Exam Practice`];
                } else {
                    topics[subject] = standardTopics[subject] || [`${subject} Study`];
                }
            });
            
            return topics;
        }

        function createRevisionScheduleFromData(scheduleId, subjects, scheduleData, additionalInfo = {}) {
            const schedule = {
                id: scheduleId,
                name: subjects.join(', '),
                subjects: subjects,
                weeklySchedule: scheduleData,
                created: new Date().toISOString(),
                completedTasks: {},
                scheduleInfo: additionalInfo
            };
            
            appState.schedules[scheduleId] = schedule;
            appState.activeSchedule = scheduleId;
            appState.currentTabIndex = 0;
            saveAppState();
            updateDashboard();
        }

        // New function to ensure most recent schedule is active
function ensureMostRecentScheduleActive() {
    const scheduleEntries = Object.entries(appState.schedules);
    
    if (scheduleEntries.length === 0) return;
    
    // Sort by creation date (most recent first)
    scheduleEntries.sort(([,a], [,b]) => new Date(b.created) - new Date(a.created));
    
    // If no active schedule or active schedule doesn't exist, set to most recent
    if (!appState.activeSchedule || !appState.schedules[appState.activeSchedule]) {
        appState.activeSchedule = scheduleEntries[0][0];
        appState.currentTabIndex = 0;
        saveAppState();
    }
}

        function updateDashboard() {
    // Ensure we have the most recent schedule active
    ensureMostRecentScheduleActive();
    
    updateScheduleTabs();
    updateScheduleContent();
    
    // Immediate carousel update for smooth loading
    updateCenteredCarousel();
    
    // Additional updates for smooth transitions
    setTimeout(() => {
        updateCenteredCarousel();
    }, 50);
}

        function updateScheduleTabs() {
            const carousel = document.getElementById('scheduleTabsCarousel');
            
            if (Object.keys(appState.schedules).length === 0) {
                carousel.innerHTML = '';
                return;
            }
            
            const allTabs = [];
            const scheduleEntries = Object.entries(appState.schedules);
            
            scheduleEntries.forEach(([scheduleId, schedule], scheduleIndex) => {
                const colorIndex = (scheduleIndex % 4) + 1;
                
                allTabs.push({
                    type: 'schedule',
                    name: schedule.name.length > 25 ? schedule.name.substring(0, 25) + '...' : schedule.name,
                    fullName: schedule.name,
                    scheduleId: scheduleId,
                    index: scheduleIndex,
                    colorClass: `color-${colorIndex}`,
                    isActive: scheduleId === appState.activeSchedule
                });
            });
            
            let html = `
                <button class="carousel-nav prev" onclick="previousScheduleSmooth()">
                    <svg class="icon" viewBox="0 0 24 24">
                        <polyline points="15,18 9,12 15,6"/>
                    </svg>
                </button>
                <div class="tab-viewport">
                    <div class="tab-container" id="tabContainer">
            `;
            
            allTabs.forEach((tab, index) => {
                const isActive = tab.isActive;
                
                html += `
                    <div class="tab ${tab.colorClass} ${isActive ? 'active' : ''}" 
                         onclick="selectScheduleDirectly('${tab.scheduleId}', ${index})" 
                         data-tab-type="${tab.type}" 
                         data-tab-name="${tab.fullName}"
                         data-schedule-id="${tab.scheduleId}"
                         data-tab-index="${index}"
                         title="${tab.fullName}"
                         onmouseenter="showTabMenu('${tab.scheduleId}')"
                         onmouseleave="hideTabMenu('${tab.scheduleId}')">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                        </svg>
                        ${tab.name}
                        <div class="tab-menu" id="tabMenu_${tab.scheduleId}" onclick="event.stopPropagation();">
                            <div class="tab-menu-dots" onclick="toggleTabDropdown('${tab.scheduleId}', event)">
                                <svg class="icon" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                                    <circle cx="12" cy="12" r="1"/>
                                    <circle cx="12" cy="5" r="1"/>
                                    <circle cx="12" cy="19" r="1"/>
                                </svg>
                            </div>
                            <div class="tab-dropdown" id="tabDropdown_${tab.scheduleId}">
                                <div class="tab-dropdown-item" onclick="deleteScheduleWithConfirmation('${tab.scheduleId}')">
                                    <svg class="icon" viewBox="0 0 24 24" style="width: 14px; height: 14px;">
                                        <polyline points="3,6 5,6 21,6"/>
                                        <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"/>
                                    </svg>
                                    Delete Schedule
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
                <button class="carousel-nav next" onclick="nextScheduleSmooth()">
                    <svg class="icon" viewBox="0 0 24 24">
                        <polyline points="9,18 15,12 9,6"/>
                    </svg>
                </button>
            `;
            
            carousel.innerHTML = html;
            updateCenteredCarousel();
            
            setTimeout(initializeScrollWheelNavigation, 100);
        }

        // Tab Menu Management
        function showTabMenu(scheduleId) {
            const menu = document.getElementById(`tabMenu_${scheduleId}`);
            if (menu) {
                menu.style.opacity = '1';
            }
        }

        function hideTabMenu(scheduleId) {
            const menu = document.getElementById(`tabMenu_${scheduleId}`);
            const dropdown = document.getElementById(`tabDropdown_${scheduleId}`);
            if (menu && !dropdown?.classList.contains('show')) {
                menu.style.opacity = '0';
            }
        }

        // Fixed tab dropdown with better positioning
function toggleTabDropdown(scheduleId, event) {
    event.stopPropagation();
    
    // Close all other dropdowns
    document.querySelectorAll('.tab-dropdown-overlay').forEach(overlay => {
        overlay.remove();
    });
    
    // Create and position dropdown overlay
    const dropdownOverlay = document.createElement('div');
    dropdownOverlay.className = 'tab-dropdown-overlay';
    dropdownOverlay.innerHTML = `
        <div class="tab-dropdown-content">
            <div class="tab-dropdown-item" onclick="deleteScheduleWithConfirmation('${scheduleId}')">
                <svg class="icon" viewBox="0 0 24 24" style="width: 14px; height: 14px;">
                    <polyline points="3,6 5,6 21,6"/>
                    <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"/>
                </svg>
                Delete Schedule
            </div>
        </div>
    `;
    
    // Get the tab element and its position
    const tabElement = event.target.closest('.tab');
    const rect = tabElement.getBoundingClientRect();
    
    // Position dropdown below and slightly to the left of the tab
    dropdownOverlay.style.position = 'fixed';
    dropdownOverlay.style.left = `${rect.left + 50}px`;
    dropdownOverlay.style.top = `${rect.bottom + 8}px`;
    dropdownOverlay.style.zIndex = '10000';
    
    // Adjust position if it would go off screen
    const dropdownWidth = 180;
    const viewportWidth = window.innerWidth;
    
    if (rect.left + 50 + dropdownWidth > viewportWidth) {
        dropdownOverlay.style.left = `${rect.right - dropdownWidth}px`;
    }
    
    document.body.appendChild(dropdownOverlay);
    
    // Show with animation
    setTimeout(() => {
        dropdownOverlay.classList.add('show');
    }, 10);
    
    // Close on outside click
    const closeHandler = (e) => {
        if (!dropdownOverlay.contains(e.target)) {
            dropdownOverlay.classList.remove('show');
            setTimeout(() => {
                if (dropdownOverlay.parentNode) {
                    dropdownOverlay.remove();
                }
            }, 300);
            document.removeEventListener('click', closeHandler);
        }
    };
    
    setTimeout(() => {
        document.addEventListener('click', closeHandler);
    }, 100);
}

        // Fixed delete function with proper confirmation
function deleteScheduleWithConfirmation(scheduleId) {
    // Close dropdown first
    document.querySelectorAll('.tab-dropdown-overlay').forEach(overlay => {
        overlay.remove();
    });
    
    const schedule = appState.schedules[scheduleId];
    if (!schedule) return;
    
    const confirmMessage = `Are you sure you want to delete "${schedule.name}"? This action cannot be undone.`;
    
    if (confirm(confirmMessage)) {
        deleteScheduleWithAnimation(scheduleId);
    }
}

// Enhanced delete function
function deleteScheduleWithAnimation(scheduleId) {
    const tabElement = document.querySelector(`[data-schedule-id="${scheduleId}"]`);
    
    if (tabElement) {
        tabElement.style.transition = 'all 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
        tabElement.style.transform = 'scale(0.8) translateY(-20px)';
        tabElement.style.opacity = '0';
    }
    
    setTimeout(() => {
        delete appState.schedules[scheduleId];
        
        const remainingSchedules = Object.keys(appState.schedules);
        if (appState.activeSchedule === scheduleId) {
            appState.activeSchedule = remainingSchedules.length > 0 ? remainingSchedules[0] : null;
            appState.currentTabIndex = 0;
        }
        
        saveAppState();
        updateDashboard();
        updateProgress();
        
        showAlert('Schedule deleted successfully', 'success');
    }, 500);
}
        // Schedule Navigation
        function initializeScrollWheelNavigation() {
            const carousel = document.getElementById('scheduleTabsCarousel');
            if (!carousel) return;
            
            let isScrolling = false;
            
            carousel.addEventListener('wheel', function(e) {
                e.preventDefault();
                
                if (isScrolling) return;
                isScrolling = true;
                
                const delta = e.deltaY;
                
                if (delta > 0) {
                    nextScheduleSmooth();
                } else {
                    previousScheduleSmooth();
                }
                
                setTimeout(() => {
                    isScrolling = false;
                }, 800);
            }, { passive: false });
        }

        function previousScheduleSmooth() {
            if (isNavigating) return;
            isNavigating = true;
            
            const schedules = Object.keys(appState.schedules);
            if (schedules.length <= 1) {
                isNavigating = false;
                return;
            }
            
            const currentIndex = schedules.indexOf(appState.activeSchedule);
            const newIndex = currentIndex === 0 ? schedules.length - 1 : currentIndex - 1;
            const newScheduleId = schedules[newIndex];
            
            selectScheduleDirectly(newScheduleId, newIndex);
        }

        function nextScheduleSmooth() {
            if (isNavigating) return;
            isNavigating = true;
            
            const schedules = Object.keys(appState.schedules);
            if (schedules.length <= 1) {
                isNavigating = false;
                return;
            }
            
            const currentIndex = schedules.indexOf(appState.activeSchedule);
            const newIndex = currentIndex === schedules.length - 1 ? 0 : currentIndex + 1;
            const newScheduleId = schedules[newIndex];
            
            selectScheduleDirectly(newScheduleId, newIndex);
        }

        function selectScheduleDirectly(scheduleId, index) {
            if (scheduleId === appState.activeSchedule) {
                isNavigating = false;
                return;
            }
            
            const contentContainer = document.querySelector('.schedule-grid-container');
            if (contentContainer) {
                contentContainer.classList.add('transitioning');
            }
            
            appState.activeSchedule = scheduleId;
            appState.currentTabIndex = index;
            saveAppState();
            
            updateTabStates();
            updateCenteredCarousel();
            
            setTimeout(() => {
                updateScheduleContent();
                
                setTimeout(() => {
                    if (contentContainer) {
                        contentContainer.classList.remove('transitioning');
                    }
                    isNavigating = false;
                }, 100);
            }, 400);
        }

        function updateTabStates() {
            const tabs = document.querySelectorAll('.tab');
            const schedules = Object.keys(appState.schedules);
            const currentIndex = schedules.indexOf(appState.activeSchedule);
            
            tabs.forEach((tab, index) => {
                tab.classList.remove('active', 'prev-tab', 'next-tab');
                
                if (index === currentIndex) {
                    tab.classList.add('active');
                } else if (index === currentIndex - 1 || (currentIndex === 0 && index === tabs.length - 1)) {
                    tab.classList.add('prev-tab');
                } else if (index === currentIndex + 1 || (currentIndex === tabs.length - 1 && index === 0)) {
                    tab.classList.add('next-tab');
                }
            });
        }

        function updateCenteredCarousel() {
            const container = document.getElementById('tabContainer');
            const viewport = container?.parentElement;
            if (!container || !viewport) return;
            
            const tabs = container.querySelectorAll('.tab');
            const schedules = Object.keys(appState.schedules);
            const currentIndex = schedules.indexOf(appState.activeSchedule);
            
            if (tabs.length === 0 || currentIndex === -1) return;
            
            const tabWidth = 320;
            const viewportCenter = viewport.offsetWidth / 2;
            const activeTabPosition = (currentIndex * tabWidth) + (280 / 2);
            const offset = activeTabPosition - viewportCenter;
            
            container.style.transform = `translateX(-${Math.max(0, offset)}px)`;
        }

        function updateScheduleContent() {
    const content = document.getElementById('scheduleContent');
    
    if (!appState.activeSchedule || !appState.schedules[appState.activeSchedule]) {
        content.innerHTML = `
            <div class="empty-state">
                <h3>No schedules created yet</h3>
                <p>Go to the Home page to create your first revision schedule</p>
            </div>
        `;
        return;
    }
    
    const schedule = appState.schedules[appState.activeSchedule];
    
    // Calculate dashboard stats
    let totalTasks = 0;
    let completedTasks = 0;
    const subjects = schedule.subjects.length;
    
    Object.values(schedule.weeklySchedule).forEach(dayTasks => {
        totalTasks += dayTasks.length;
    });
    
    completedTasks = Object.values(schedule.completedTasks).filter(completed => completed).length;
    const progressPercentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
    
    const today = new Date();
    const currentDay = today.getDay();
    const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    const dayOrder = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
    
    const hasCompletedTasks = Object.values(schedule.completedTasks).some(completed => completed);
    
    document.documentElement.style.setProperty('--subject-count', schedule.subjects.length);
    
    let html = `
        <div class="dashboard-container">
            <!-- Dashboard Stats -->
            <div class="dashboard-stats">
                <div class="dashboard-stat">
                    <div class="dashboard-stat-number">${subjects}</div>
                    <div class="dashboard-stat-label">Subject${subjects !== 1 ? 's' : ''}</div>
                </div>
                <div class="dashboard-stat">
                    <div class="dashboard-stat-number">${totalTasks}</div>
                    <div class="dashboard-stat-label">Total Tasks</div>
                </div>
                <div class="dashboard-stat">
                    <div class="dashboard-stat-number">${completedTasks}</div>
                    <div class="dashboard-stat-label">Completed</div>
                </div>
                <div class="dashboard-stat">
                    <div class="dashboard-stat-number">${progressPercentage}%</div>
                    <div class="dashboard-stat-label">Progress</div>
                </div>
            </div>
    `;

    
    // Properly detect mobile with window width check
    const isMobile = window.innerWidth <= 768;
    
    if (isMobile) {
        // Mobile vertical layout
        html += `<div class="schedule-grid-container mobile-layout" id="scheduleGrid">`;
        
        dayOrder.forEach(day => {
            const isToday = days[currentDay] === day;
            const dayTasks = schedule.weeklySchedule[day] || [];
            
            if (dayTasks.length === 0) return;
            
            html += `
                <div class="mobile-day-section">
                    <div class="mobile-day-header ${isToday ? 'today' : ''}">${day}</div>
            `;
            
            // Group tasks by subject
            const tasksBySubject = {};
            dayTasks.forEach((task, taskIndex) => {
                if (!tasksBySubject[task.subject]) {
                    tasksBySubject[task.subject] = [];
                }
                const taskId = `${schedule.id}_${day}_${taskIndex}`;
                const isCompleted = schedule.completedTasks[taskId] || false;
                
                tasksBySubject[task.subject].push({
                    ...task,
                    taskId,
                    isCompleted,
                    originalIndex: taskIndex
                });
            });
            
            Object.entries(tasksBySubject).forEach(([subject, tasks]) => {
                html += `
                    <div class="mobile-subject-group">
                        <div class="mobile-subject-title">${subject}</div>
                        <div class="mobile-tasks-container">
                `;
                
                tasks.forEach(task => {
                    html += `
                        <div class="revision-card-mini swipeable-task ${task.isCompleted ? 'completed' : ''}" 
                             data-task-id="${task.taskId}" 
                             data-completed="${task.isCompleted}"
                             ontouchstart="handleTaskTouchStart(event)"
                             ontouchmove="handleTaskTouchMove(event)"
                             ontouchend="handleTaskTouchEnd(event)">
                            <div class="task-content">
                                <div class="revision-card-mini-content">
                                    <div class="revision-card-mini-title">${task.subject}</div>
                                    <div class="revision-card-mini-topic">${task.topic}</div>
                                    <div class="revision-card-mini-meta">
                                        <span>${task.time}</span>
                                        <span>${task.difficulty}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="task-action-complete">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <polyline points="20,6 9,17 4,12"/>
                                </svg>
                                Complete
                            </div>
                            <div class="task-action-delete">
                                <svg class="icon" viewBox="0 0 24 24">
                                    <polyline points="3,6 5,6 21,6"/>
                                    <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6"/>
                                </svg>
                                Delete
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
        });
        
        html += `</div>`;
    } else {
        // Desktop grid layout (ORIGINAL DESIGN)
        html += `
            <div class="schedule-grid-container desktop-layout" id="scheduleGrid">
                <div class="schedule-grid">
                    <div class="grid-header"></div>
        `;
        
        dayOrder.forEach(day => {
            const isToday = days[currentDay] === day;
            html += `<div class="grid-header ${isToday ? 'today' : ''}">${day}</div>`;
        });
        
        schedule.subjects.forEach(subject => {
            html += `<div class="subject-label">${subject}</div>`;
            
            dayOrder.forEach(day => {
                const isToday = days[currentDay] === day;
                const dayTasks = schedule.weeklySchedule[day] || [];
                
                let filteredTasks = dayTasks.filter(task => task.subject === subject);
                
                html += `<div class="schedule-cell ${isToday ? 'today' : ''}" data-subject="${subject}" data-day="${day}">`;
                
                filteredTasks.forEach((task, taskIndex) => {
                    const originalIndex = dayTasks.findIndex(t => 
                        t.subject === task.subject && 
                        t.topic === task.topic && 
                        t.time === task.time
                    );
                    const taskId = `${schedule.id}_${day}_${originalIndex}`;
                    const isCompleted = schedule.completedTasks[taskId] || false;
                    
                    html += `
                        <div class="revision-card-mini ${isCompleted ? 'completed' : ''}" 
                             data-task-id="${taskId}" 
                             data-completed="${isCompleted}"
                             onclick="event.stopPropagation();">
                            <div class="revision-card-mini-content">
                                <div class="revision-card-mini-title">${task.subject}</div>
                                <div class="revision-card-mini-topic">${task.topic}</div>
                                <div class="revision-card-mini-meta">
                                    <span>${task.time}</span>
                                    <span>${task.difficulty}</span>
                                </div>
                            </div>
                            <div class="revision-card-mini-menu" onclick="event.stopPropagation(); toggleDropdown(event, '${taskId}', ${isCompleted})">
                                <svg class="icon" viewBox="0 0 24 24" style="width: 10px; height: 10px;">
                                    <circle cx="12" cy="12" r="1"/>
                                    <circle cx="12" cy="5" r="1"/>
                                    <circle cx="12" cy="19" r="1"/>
                                </svg>
                            </div>
                        </div>
                    `;
                });
                
                html += `</div>`;
            });
        });
        
        html += `
                </div>
            </div>
        `;
    }
    
    // Add past papers section (existing code)
    const relevantPapers = getRelevantPastPapers();
    if (Object.keys(relevantPapers).length > 0) {
        html += `
            <div class="past-papers-section">
                <div class="past-papers-container">
                    <div class="past-papers-header">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10,9 9,9 8,9"/>
                        </svg>
                        Available Past Papers
                    </div>
                    <div class="past-papers-grid-display">
        `;
        
        Object.entries(relevantPapers).forEach(([subject, papers]) => {
            papers.forEach((paperPath, index) => {
                const fileName = paperPath.split('/').pop() || paperPath;
                html += `
                    <div class="past-paper-card" onclick="openPastPaper('${paperPath}')">
                        <div class="past-paper-card-header">
                            <div class="past-paper-card-title">${fileName}</div>
                            <div class="past-paper-card-subject">${subject}</div>
                        </div>
                        <div class="past-paper-card-path">${paperPath}</div>
                    </div>
                `;
            });
        });
        
        html += `
                    </div>
                </div>
            </div>
        `;
    }
    
    content.innerHTML = html;
    
    if (appState.showingCompleted) {
        filterCompletedTasks(false);
    }
}

        function openPastPaper(paperPath) {
            try {
                if (paperPath.startsWith('http://') || paperPath.startsWith('https://')) {
                    window.open(paperPath, '_blank');
                } else {
                    const link = document.createElement('a');
                    link.href = paperPath;
                    link.target = '_blank';
                    link.click();
                }
                showAlert('Opening past paper...', 'success');
            } catch (error) {
                showAlert('Could not open past paper. Please check the file path.', 'error');
                console.error('Error opening past paper:', error);
            }
        }

        function toggleCompletedView() {
            appState.showingCompleted = !appState.showingCompleted;
            saveAppState();
            
            const completedTab = document.getElementById('completedTab');
            if (completedTab) {
                completedTab.innerHTML = `
                    <svg class="icon" viewBox="0 0 24 24">
                        <polyline points="20,6 9,17 4,12"/>
                    </svg>
                    ${appState.showingCompleted ? 'Show All Tasks' : 'Show Completed Only'}
                `;
                
                completedTab.classList.toggle('active', appState.showingCompleted);
            }
            
            filterCompletedTasks(true);
        }

        function filterCompletedTasks(animate = true) {
            const cards = document.querySelectorAll('.revision-card-mini');
            
            cards.forEach((card, index) => {
                const isCompleted = card.dataset.completed === 'true';
                const shouldShow = appState.showingCompleted ? isCompleted : true;
                
                if (animate) {
                    setTimeout(() => {
                        if (shouldShow) {
                            card.classList.remove('filtering-out');
                            card.classList.add('filtering-in');
                            card.style.display = 'flex';
                        } else {
                            card.classList.remove('filtering-in');
                            card.classList.add('filtering-out');
                            setTimeout(() => {
                                card.style.display = 'none';
                            }, 400);
                        }
                    }, index * 50);
                } else {
                    if (shouldShow) {
                        card.style.display = 'flex';
                        card.classList.add('filtering-in');
                    } else {
                        card.style.display = 'none';
                    }
                }
            });
        }

        // Task Management
        function toggleTaskComplete(taskId) {
            const schedule = appState.schedules[appState.activeSchedule];
            if (!schedule) return;
            
            const wasCompleted = schedule.completedTasks[taskId];
            schedule.completedTasks[taskId] = !wasCompleted;
            
            const hasCompletedTasks = Object.values(schedule.completedTasks).some(completed => completed);
            const hadCompletedTasks = document.getElementById('completedTab') !== null;
            
            saveAppState();
            
            if (hasCompletedTasks && !hadCompletedTasks) {
                updateScheduleContent();
            } else if (!hasCompletedTasks && hadCompletedTasks) {
                appState.showingCompleted = false;
                updateScheduleContent();
            } else {
                const card = document.querySelector(`[data-task-id="${taskId}"]`);
                if (card) {
                    card.classList.toggle('completed', !wasCompleted);
                    card.dataset.completed = !wasCompleted;
                    
                    if (appState.showingCompleted) {
                        filterCompletedTasks(true);
                    }
                }
            }
            
            closeAllDropdowns();
            updateProgress();
        }

        function toggleDropdown(event, taskId, isCompleted) {
            event.stopPropagation();
            
            closeAllDropdowns();
            
            const dropdown = document.createElement('div');
            dropdown.className = 'dropdown show';
            dropdown.innerHTML = `
                <div class="dropdown-item" onclick="toggleTaskComplete('${taskId}')">
                    <svg class="icon" viewBox="0 0 24 24">
                        ${isCompleted ? 
                            '<rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><path d="M9 9h6v6H9z"/>' :
                            '<polyline points="20,6 9,17 4,12"/>'
                        }
                    </svg>
                    ${isCompleted ? 'Mark as Incomplete' : 'Mark as Complete'}
                </div>
            `;
            
            const rect = event.target.getBoundingClientRect();
            dropdown.style.left = `${rect.left - 150}px`;
            dropdown.style.top = `${rect.bottom + 8}px`;
            
            document.body.appendChild(dropdown);
            activeDropdown = dropdown;
            
            document.getElementById('dropdownOverlay').style.display = 'block';
        }

        function closeAllDropdowns() {
            if (activeDropdown) {
                activeDropdown.remove();
                activeDropdown = null;
            }
            document.getElementById('dropdownOverlay').style.display = 'none';
        }

        // Schedule Management Functions
        function switchToSchedule(scheduleId) {
            appState.activeSchedule = scheduleId;
            appState.currentTabIndex = 0;
            saveAppState();
            updateDashboard();
            updateProgress();
        }

        // Progress Management
        function updateProgress() {
            const content = document.getElementById('progressContent');
            
            if (Object.keys(appState.schedules).length === 0) {
                content.innerHTML = `
                    <div class="empty-state">
                        <h3>No progress data yet</h3>
                        <p>Complete some revision tasks to see your progress here</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            Object.values(appState.schedules).forEach(schedule => {
                let totalTasks = 0;
                let completedTasks = 0;
                
                Object.values(schedule.weeklySchedule).forEach(dayTasks => {
                    totalTasks += dayTasks.length;
                });
                
                completedTasks = Object.values(schedule.completedTasks).filter(completed => completed).length;
                
                const progressPercentage = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
                
                html += `
                    <div class="progress-card">
                        <button class="progress-view-button" onclick="viewScheduleFromProgress('${schedule.id}')">
                            <svg class="icon" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                            View Schedule
                        </button>
                        <h4 style="color: var(--accent-blue); margin-bottom: 16px; font-weight: 800; display: flex; align-items: center; gap: 12px; font-size: 1.2rem; padding-right: 140px;">
                            <svg class="icon" viewBox="0 0 24 24">
                                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                            </svg>
                            ${schedule.name}
                        </h4>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progressPercentage}%;"></div>
                        </div>
                        <p style="color: var(--text-secondary); font-size: 0.95rem; font-weight: 600;">
                            ${completedTasks}/${totalTasks} tasks completed (${progressPercentage}%)
                        </p>
                    </div>
                `;
            });
            
            content.innerHTML = html;
        }

        // Settings Functions
        function loadSettings() {
            const saved = localStorage.getItem('gcseRevisionSettings');
            if (saved) {
                userSettings = { ...userSettings, ...JSON.parse(saved) };
                applySettings();
            }
        }

        function saveSettings() {
            localStorage.setItem('gcseRevisionSettings', JSON.stringify(userSettings));
        }

        function applySettings() {
            const sessionSelect = document.getElementById('sessionLength');
            const breakSelect = document.getElementById('breakLength');
            if (sessionSelect) sessionSelect.value = userSettings.sessionLength;
            if (breakSelect) breakSelect.value = userSettings.breakLength;
            
            const studyToggle = document.getElementById('studyNotifications');
            const breakToggle = document.getElementById('breakNotifications');
            if (studyToggle) studyToggle.classList.toggle('active', userSettings.studyNotifications);
            if (breakToggle) breakToggle.classList.toggle('active', userSettings.breakNotifications);
            
            document.documentElement.setAttribute('data-theme', userSettings.theme);
            
            setTimeout(() => {
                const selectedOption = document.querySelector(`.theme-${userSettings.theme}`);
                if (selectedOption) {
                    document.querySelectorAll('.theme-option').forEach(option => {
                        option.classList.remove('active');
                    });
                    selectedOption.classList.add('active');
                }
            }, 100);
        }

        function updateSessionLength(value) {
            userSettings.sessionLength = parseInt(value);
            saveSettings();
            showAlert(`Study session length updated to ${value} minutes`, 'success');
        }

        function updateBreakLength(value) {
            userSettings.breakLength = parseInt(value);
            saveSettings();
            showAlert(`Break length updated to ${value} minutes`, 'success');
        }

        function toggleNotifications(type) {
            if (type === 'study') {
                userSettings.studyNotifications = !userSettings.studyNotifications;
                document.getElementById('studyNotifications').classList.toggle('active', userSettings.studyNotifications);
                
                if (userSettings.studyNotifications) {
                    requestNotificationPermission();
                    showAlert('Study reminders enabled', 'success');
                } else {
                    showAlert('Study reminders disabled', 'success');
                }
            } else if (type === 'break') {
                userSettings.breakNotifications = !userSettings.breakNotifications;
                document.getElementById('breakNotifications').classList.toggle('active', userSettings.breakNotifications);
                
                if (userSettings.breakNotifications) {
                    requestNotificationPermission();
                    showAlert('Break reminders enabled', 'success');
                } else {
                    showAlert('Break reminders disabled', 'success');
                }
            }
            saveSettings();
        }

        function requestNotificationPermission() {
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        new Notification('GCSE Revision Planner', {
                            body: 'Notifications enabled successfully!',
                            icon: '/favicon.ico'
                        });
                    }
                });
            }
        }

        function exportData(format) {
            const data = {
                schedules: appState.schedules,
                settings: userSettings,
                exportDate: new Date().toISOString()
            };
            
            let content, filename, mimeType;
            
            if (format === 'csv') {
                content = convertToCSV(data);
                filename = `gcse-revision-data-${new Date().toISOString().split('T')[0]}.csv`;
                mimeType = 'text/csv';
            } else {
                content = JSON.stringify(data, null, 2);
                filename = `gcse-revision-data-${new Date().toISOString().split('T')[0]}.json`;
                mimeType = 'application/json';
            }
            
            downloadFile(content, filename, mimeType);
            showAlert(`Data exported as ${format.toUpperCase()}`, 'success');
        }

        function convertToCSV(data) {
            let csv = 'Schedule,Subject,Day,Topic,Time,Difficulty,Completed\n';
            
            Object.values(data.schedules).forEach(schedule => {
                Object.entries(schedule.weeklySchedule).forEach(([day, tasks]) => {
                    tasks.forEach((task, index) => {
                        const taskId = `${schedule.id}_${day}_${index}`;
                        const completed = schedule.completedTasks[taskId] || false;
                        csv += `"${schedule.name}","${task.subject}","${day}","${task.topic}","${task.time}","${task.difficulty}","${completed}"\n`;
                    });
                });
            });
            
            return csv;
        }

        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function changeTheme(theme, save = true) {
            const overlay = document.createElement('div');
            overlay.className = 'theme-transition-overlay';
            document.body.appendChild(overlay);
            
            setTimeout(() => {
                overlay.classList.add('active');
            }, 50);
            
            setTimeout(() => {
                userSettings.theme = theme;
                
                document.querySelectorAll('.theme-option').forEach(option => {
                    option.classList.remove('active');
                });
                
                const selectedOption = document.querySelector(`.theme-${theme}`);
                if (selectedOption) {
                    selectedOption.classList.add('active');
                }
                
                document.documentElement.setAttribute('data-theme', theme);
                
                if (save) {
                    saveSettings();
                    showAlert(`Theme changed to ${theme.charAt(0).toUpperCase() + theme.slice(1)}`, 'success');
                }
                
                setTimeout(() => {
                    overlay.classList.remove('active');
                    setTimeout(() => {
                        if (overlay.parentNode) {
                            overlay.parentNode.removeChild(overlay);
                        }
                    }, 600);
                }, 300);
                
            }, 300);
        }

        function createBackup() {
            exportData('json');
            showAlert('Backup created and downloaded', 'success');
        }

        function restoreBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.schedules) {
                                appState.schedules = data.schedules;
                                if (data.settings) {
                                    userSettings = { ...userSettings, ...data.settings };
                                    applySettings();
                                }
                                saveAppState();
                                saveSettings();
                                updateDashboard();
                                updateProgress();
                                showAlert('Backup restored successfully', 'success');
                            } else {
                                showAlert('Invalid backup file', 'error');
                            }
                        } catch (error) {
                            showAlert('Error reading backup file', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // Past Papers Functions
        function getPastPapersForSubject(subjectName) {
            const subjectKey = subjectName.toLowerCase().trim();
            
            if (pastPapersData[subjectKey]) {
                return pastPapersData[subjectKey].filter(paper => paper && paper.trim());
            }
            
            const alternativeNames = {
                'mathematics': ['maths', 'math'],
                'maths': ['mathematics', 'math'],
                'math': ['mathematics', 'maths'],
                'biology': ['bio'],
                'bio': ['biology'],
                'chemistry': ['chem'],
                'chem': ['chemistry'],
                'geography': ['geo'],
                'geo': ['geography'],
                'computer science': ['computing', 'ict', 'comp sci'],
                'computing': ['computer science', 'ict'],
                'ict': ['computer science', 'computing'],
                'religious studies': ['rs', 'religion'],
                'rs': ['religious studies', 'religion'],
                'business studies': ['business'],
                'business': ['business studies'],
                'physical education': ['pe', 'sport'],
                'pe': ['physical education', 'sport'],
                'art and design': ['art'],
                'art': ['art and design'],
                'english literature': ['english lit', 'eng lit'],
                'english language': ['english lang', 'eng lang']
            };
            
            if (alternativeNames[subjectKey]) {
                for (const altName of alternativeNames[subjectKey]) {
                    if (pastPapersData[altName]) {
                        return pastPapersData[altName].filter(paper => paper && paper.trim());
                    }
                }
            }
            
            const matchingKey = Object.keys(pastPapersData).find(key => 
                key.includes(subjectKey) || subjectKey.includes(key) ||
                key.replace(/\s+/g, '').includes(subjectKey.replace(/\s+/g, '')) ||
                subjectKey.replace(/\s+/g, '').includes(key.replace(/\s+/g, ''))
            );
            
            if (matchingKey) {
                return pastPapersData[matchingKey].filter(paper => paper && paper.trim());
            }
            
            return [];
        }

        function getRelevantPastPapers() {
            if (!appState.activeSchedule || !appState.schedules[appState.activeSchedule]) {
                return {};
            }
            
            const schedule = appState.schedules[appState.activeSchedule];
            const scheduleInfo = schedule.scheduleInfo || {};
            const examBoard = scheduleInfo.examBoard || 'aqa';
            const relevantPapers = {};
            
            schedule.subjects.forEach(subject => {
                const subjectKey = subject.toLowerCase().trim();
                
                if (examBoardPastPapers[examBoard] && examBoardPastPapers[examBoard][subjectKey]) {
                    relevantPapers[subject] = examBoardPastPapers[examBoard][subjectKey];
                } else {
                    const papers = getPastPapersForSubject(subject);
                    if (papers.length > 0) {
                        relevantPapers[subject] = papers;
                    }
                }
            });
            
            return relevantPapers;
        }

        // Alert System
        function showAlert(message, type = 'success') {
            let container = document.getElementById('notificationContainer');
            if (!container) {
                container = document.createElement('div');
                container.id = 'notificationContainer';
                container.className = 'notification-container';
                document.body.appendChild(container);
            }
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <svg class="icon" viewBox="0 0 24 24">
                    ${type === 'error' ? 
                        '<circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>' :
                        '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22,4 12,14.01 9,11.01"/>'
                    }
                </svg>
                ${message}
                <div class="notification-progress"></div>
            `;
            
            container.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                notification.classList.add('hide');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 400);
            }, 4000);
        }

        // Data Management
        function saveAppState() {
            try {
                localStorage.setItem('gcseRevisionPlannerState', JSON.stringify(appState));
            } catch (error) {
                console.error('Failed to save app state:', error);
            }
        }

        function loadAppState() {
            try {
                const savedState = localStorage.getItem('gcseRevisionPlannerState');
                if (savedState) {
                    const parsed = JSON.parse(savedState);
                    appState = { ...appState, ...parsed };
                }
            } catch (error) {
                console.error('Failed to load app state:', error);
            }
        }

        // Mobile touch and swipe support
        let touchStartX = 0;
        let touchStartY = 0;
        let touchEndX = 0;
        let touchEndY = 0;

       function toggleSidebarMobile() {
    const sidebar = document.getElementById('sidebar');
    const hamburger = document.getElementById('hamburgerMenu');
    const overlay = document.getElementById('sidebarOverlay');
    const container = document.getElementById('container');
    const body = document.body;
    
    // Initialize isSidebarOpen if undefined
    if (typeof isSidebarOpen === 'undefined') {
        window.isSidebarOpen = false;
    }
    
    isSidebarOpen = !isSidebarOpen;
    
    if (isSidebarOpen) {
        if (sidebar) sidebar.classList.add('open');
        if (hamburger) hamburger.classList.add('active');
        if (overlay) overlay.classList.add('show');
        if (container) container.classList.add('sidebar-open');
        if (body) body.classList.add('sidebar-open-mobile');
    } else {
        if (sidebar) sidebar.classList.remove('open');
        if (hamburger) hamburger.classList.remove('active');
        if (overlay) overlay.classList.remove('show');
        if (container) container.classList.remove('sidebar-open');
        if (body) body.classList.remove('sidebar-open-mobile');
    }
}

        // Touch event handlers
        function handleTouchStart(e) {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        }

        function handleTouchMove(e) {
            if (!touchStartX || !touchStartY) return;
            
            touchEndX = e.touches[0].clientX;
            touchEndY = e.touches[0].clientY;
            
            const deltaX = touchEndX - touchStartX;
            const deltaY = touchEndY - touchStartY;
            
            // Only handle horizontal swipes from the left edge
            if (Math.abs(deltaY) > Math.abs(deltaX)) return;
            
            // Swipe from left edge to open sidebar
            if (touchStartX < 50 && deltaX > 100 && !isSidebarOpen) {
                e.preventDefault();
                toggleSidebarMobile();
            }
            
            // Swipe right to left to close sidebar
            if (isSidebarOpen && deltaX < -100) {
                e.preventDefault();
                toggleSidebarMobile();
            }
        }

        function handleTouchEnd() {
            touchStartX = 0;
            touchStartY = 0;
            touchEndX = 0;
            touchEndY = 0;
        }

        // Add touch event listeners
        document.addEventListener('touchstart', handleTouchStart, { passive: false });
        document.addEventListener('touchmove', handleTouchMove, { passive: false });
        document.addEventListener('touchend', handleTouchEnd);

        // Task swipe gesture handling
let taskTouchStartX = 0;
let taskTouchStartY = 0;
let currentSwipeTask = null;
let swipeThreshold = 80;

function handleTaskTouchStart(e) {
    taskTouchStartX = e.touches[0].clientX;
    taskTouchStartY = e.touches[0].clientY;
    currentSwipeTask = e.currentTarget;
}

function handleTaskTouchMove(e) {
    if (!currentSwipeTask || !taskTouchStartX) return;
    
    e.preventDefault();
    
    const touchX = e.touches[0].clientX;
    const touchY = e.touches[0].clientY;
    const deltaX = touchX - taskTouchStartX;
    const deltaY = touchY - taskTouchStartY;
    
    // Only handle horizontal swipes
    if (Math.abs(deltaY) > Math.abs(deltaX)) return;
    
    const taskContent = currentSwipeTask.querySelector('.task-content');
    const completeAction = currentSwipeTask.querySelector('.task-action-complete');
    const deleteAction = currentSwipeTask.querySelector('.task-action-delete');
    
    if (deltaX > 0) {
        // Swiping right (complete)
        currentSwipeTask.classList.remove('swiping-left');
        currentSwipeTask.classList.add('swiping-right');
        
        const progress = Math.min(deltaX / swipeThreshold, 1);
        taskContent.style.transform = `translateX(${deltaX}px)`;
        completeAction.style.transform = `translateX(${-swipeThreshold + (deltaX)}px)`;
        completeAction.style.opacity = progress;
    } else if (deltaX < 0) {
        // Swiping left (delete)
        currentSwipeTask.classList.remove('swiping-right');
        currentSwipeTask.classList.add('swiping-left');
        
        const progress = Math.min(Math.abs(deltaX) / swipeThreshold, 1);
        taskContent.style.transform = `translateX(${deltaX}px)`;
        deleteAction.style.transform = `translateX(${swipeThreshold + deltaX}px)`;
        deleteAction.style.opacity = progress;
    }
}

function handleTaskTouchEnd(e) {
    if (!currentSwipeTask || !taskTouchStartX) return;
    
    const touchX = e.changedTouches[0].clientX;
    const deltaX = touchX - taskTouchStartX;
    const taskId = currentSwipeTask.dataset.taskId;
    
    if (Math.abs(deltaX) > swipeThreshold) {
        if (deltaX > 0) {
            // Complete task
            toggleTaskComplete(taskId);
        } else {
            // Delete task
            showTaskDeleteConfirmation(taskId);
        }
    }
    
    // Reset task position
    resetTaskPosition(currentSwipeTask);
    
    taskTouchStartX = 0;
    taskTouchStartY = 0;
    currentSwipeTask = null;
}

function resetTaskPosition(taskElement) {
    const taskContent = taskElement.querySelector('.task-content');
    const completeAction = taskElement.querySelector('.task-action-complete');
    const deleteAction = taskElement.querySelector('.task-action-delete');
    
    taskElement.classList.remove('swiping-left', 'swiping-right');
    
    taskContent.style.transform = '';
    if (completeAction) {
        completeAction.style.transform = '';
        completeAction.style.opacity = '';
    }
    if (deleteAction) {
        deleteAction.style.transform = '';
        deleteAction.style.opacity = '';
    }
}

function showTaskDeleteConfirmation(taskId) {
    const schedule = appState.schedules[appState.activeSchedule];
    if (!schedule) return;
    
    // Find task details
    let taskDetails = null;
    Object.entries(schedule.weeklySchedule).forEach(([day, tasks]) => {
        tasks.forEach((task, index) => {
            const currentTaskId = `${schedule.id}_${day}_${index}`;
            if (currentTaskId === taskId) {
                taskDetails = { ...task, day };
            }
        });
    });
    
    if (!taskDetails) return;
    
    const confirmMessage = `Are you sure you want to delete this task?\n\n${taskDetails.subject}: ${taskDetails.topic}\n${taskDetails.day} ${taskDetails.time}`;
    
    if (confirm(confirmMessage)) {
        deleteTask(taskId);
    }
}

function deleteTask(taskId) {
    const schedule = appState.schedules[appState.activeSchedule];
    if (!schedule) return;
    
    // Remove from completed tasks
    delete schedule.completedTasks[taskId];
    
    // Find and remove from schedule
    Object.entries(schedule.weeklySchedule).forEach(([day, tasks]) => {
        tasks.forEach((task, index) => {
            const currentTaskId = `${schedule.id}_${day}_${index}`;
            if (currentTaskId === taskId) {
                schedule.weeklySchedule[day].splice(index, 1);
            }
        });
    });
    
    saveAppState();
    updateScheduleContent();
    updateProgress();
    showAlert('Task deleted successfully', 'success');
}

        document.addEventListener('DOMContentLoaded', function() {
    loadAppState();
    loadSettings();

    // ADD THESE NEW LINES:
    loadUserData();
    if (window.innerWidth <= 768) {
        updateBottomNavigation('home');
    }

    const sidebarTrigger = document.querySelector('.sidebar-trigger');
    const sidebar = document.getElementById('sidebar');
    
    if (sidebarTrigger) {
        sidebarTrigger.addEventListener('mouseenter', openSidebar);
    }
    
    if (sidebar) {
        sidebar.addEventListener('mouseleave', function(event) {
            handleSidebarLeave(event);
        });
    }

    const daysSelect = document.getElementById('daysUntilExam');
    const customDaysGroup = document.getElementById('customDaysGroup');
    
    if (daysSelect && customDaysGroup) {
        daysSelect.addEventListener('change', function() {
            if (this.value === 'custom') {
                customDaysGroup.style.display = 'block';
            } else {
                customDaysGroup.style.display = 'none';
            }
        });
    }
    
    setTimeout(() => {
        updateDashboard();
        updateProgress();
    }, 100);
    
    setTimeout(() => {
        if (Object.keys(appState.schedules).length > 0) {
            updateCenteredCarousel();
        }
        appState.isInitialized = true;
    }, 300);
});

        document.addEventListener('click', function(event) {
            if (!event.target.closest('.revision-card-mini-menu') && !event.target.closest('.dropdown')) {
                closeAllDropdowns();
            }
            
            if (!event.target.closest('.tab-menu')) {
                document.querySelectorAll('.tab-dropdown').forEach(dropdown => {
                    dropdown.classList.remove('show');
                });
            }
        });

        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeSidebar();
                closeAllDropdowns();
            }
            
            if ((event.ctrlKey || event.metaKey) && event.key === 'k') {
                event.preventDefault();
                openSidebar();
            }
        });

        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                appState.visibleTabCount = 2;
            } else {
                appState.visibleTabCount = 1;
            }
            updateCenteredCarousel();
        });

        // Prevent sidebar closing when hovering over trigger while leaving sidebar
        const sidebarTrigger = document.querySelector('.sidebar-trigger');
        if (sidebarTrigger) {
            sidebarTrigger.addEventListener('mouseenter', function() {
                clearTimeout(sidebarTimeout);
            });
        }

        // Authentication State
let currentUser = null;
let currentMobileDay = 0; // 0 = Monday, 1 = Tuesday, etc.
const daysOfWeek = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];

// Password strength checker

// Enhanced Account Management Functions
function editProfile() {
    const modal = document.createElement('div');
    modal.className = 'auth-overlay show';
    modal.innerHTML = `
        <div class="auth-modal">
            <button class="auth-close" onclick="this.closest('.auth-overlay').remove()">
                <svg class="icon" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
            
            <div class="auth-header">
                <h2>Edit Profile</h2>
                <p>Update your account information</p>
            </div>
            
            <form onsubmit="handleProfileUpdate(event)">
                <div class="auth-input-group">
                    <label for="editName">Full Name</label>
                    <input type="text" id="editName" class="auth-input" value="${currentUser.name}" required>
                </div>
                <div class="auth-input-group">
                    <label for="editEmail">Email Address</label>
                    <input type="email" id="editEmail" class="auth-input" value="${currentUser.email}" required>
                </div>
                <button type="submit" class="auth-submit">Update Profile</button>
            </form>
        </div>
    `;
    
    document.body.appendChild(modal);
}

function handleProfileUpdate(event) {
    event.preventDefault();
    const name = document.getElementById('editName').value;
    const email = document.getElementById('editEmail').value;
    
    // Check if email changed and if new email already exists
    const savedUsers = JSON.parse(localStorage.getItem('gcseRevisionUsers') || '{}');
    if (email !== currentUser.email && savedUsers[email]) {
        showAlert('Email already exists', 'error');
        return;
    }
    
    // Update user data
    const oldEmail = currentUser.email;
    currentUser.name = name;
    currentUser.email = email;
    
    // Update in storage
    if (oldEmail !== email) {
        delete savedUsers[oldEmail];
    }
    savedUsers[email] = currentUser;
    localStorage.setItem('gcseRevisionUsers', JSON.stringify(savedUsers));
    localStorage.setItem('gcseRevisionUser', JSON.stringify(currentUser));
    
    // Close modal and update UI
    document.querySelector('.auth-overlay').remove();
    updateSettingsWithUserInfo();
    showAlert('Profile updated successfully', 'success');
}

function changePassword() {
    const modal = document.createElement('div');
    modal.className = 'auth-overlay show';
    modal.innerHTML = `
        <div class="auth-modal">
            <button class="auth-close" onclick="this.closest('.auth-overlay').remove()">
                <svg class="icon" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
            
            <div class="auth-header">
                <h2>Change Password</h2>
                <p>Enter your current and new password</p>
            </div>
            
            <form onsubmit="handlePasswordChange(event)">
                <div class="auth-input-group">
                    <label for="currentPassword">Current Password</label>
                    <input type="password" id="currentPassword" class="auth-input" required>
                </div>
                <div class="auth-input-group">
                    <label for="newPassword">New Password</label>
                    <input type="password" id="newPassword" class="auth-input" minlength="6" required>
                    <div class="password-strength" id="passwordStrength" style="margin-top: 8px; height: 4px; background: rgba(209, 213, 219, 0.3); border-radius: 2px; overflow: hidden;">
                        <div class="password-strength-bar" id="passwordStrengthBar"></div>
                    </div>
                </div>
                <div class="auth-input-group">
                    <label for="confirmNewPassword">Confirm New Password</label>
                    <input type="password" id="confirmNewPassword" class="auth-input" minlength="6" required>
                </div>
                <button type="submit" class="auth-submit">Change Password</button>
            </form>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Add password strength checker
    document.getElementById('newPassword').addEventListener('input', function(e) {
        updatePasswordStrength(e.target.value);
    });
}

function updatePasswordStrength(password) {
    const strengthBar = document.getElementById('passwordStrengthBar');
    let strength = 0;
    let className = '';
    
    if (password.length >= 6) strength++;
    if (password.match(/[a-z]/)) strength++;
    if (password.match(/[A-Z]/)) strength++;
    if (password.match(/[0-9]/)) strength++;
    if (password.match(/[^a-zA-Z0-9]/)) strength++;
    
    switch (strength) {
        case 0:
        case 1:
            className = 'strength-weak';
            break;
        case 2:
        case 3:
            className = 'strength-fair';
            break;
        case 4:
            className = 'strength-good';
            break;
        case 5:
            className = 'strength-strong';
            break;
    }
    
    strengthBar.className = `password-strength-bar ${className}`;
}

function handlePasswordChange(event) {
    event.preventDefault();
    const currentPassword = document.getElementById('currentPassword').value;
    const newPassword = document.getElementById('newPassword').value;
    const confirmPassword = document.getElementById('confirmNewPassword').value;
    
    // Verify current password
    if (btoa(currentPassword) !== currentUser.password) {
        showAlert('Current password is incorrect', 'error');
        return;
    }
    
    // Check if new passwords match
    if (newPassword !== confirmPassword) {
        showAlert('New passwords do not match', 'error');
        return;
    }
    
    // Update password
    currentUser.password = btoa(newPassword);
    
    // Update in storage
    const savedUsers = JSON.parse(localStorage.getItem('gcseRevisionUsers') || '{}');
    savedUsers[currentUser.email] = currentUser;
    localStorage.setItem('gcseRevisionUsers', JSON.stringify(savedUsers));
    localStorage.setItem('gcseRevisionUser', JSON.stringify(currentUser));
    
    // Close modal
    document.querySelector('.auth-overlay').remove();
    showAlert('Password changed successfully', 'success');
}

function exportUserData() {
    const userData = {
        user: currentUser,
        schedules: appState.schedules,
        settings: userSettings,
        exportDate: new Date().toISOString()
    };
    
    const content = JSON.stringify(userData, null, 2);
    const filename = `${currentUser.name.replace(/\s+/g, '_')}_gcse_data_${new Date().toISOString().split('T')[0]}.json`;
    
    downloadFile(content, filename, 'application/json');
    showAlert('Your data has been exported', 'success');
}

function backupUserData() {
    const userData = {
        user: currentUser,
        schedules: appState.schedules,
        settings: userSettings,
        backupDate: new Date().toISOString(),
        version: '1.0'
    };
    
    const modal = document.createElement('div');
    modal.className = 'auth-overlay show backup-progress-modal';
    modal.innerHTML = `
        <div class="auth-modal">
            <div class="auth-header">
                <div style="width: 60px; height: 60px; margin: 0 auto 16px auto; background: var(--accent-blue); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <svg viewBox="0 0 24 24" fill="white" style="width: 28px; height: 28px;">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                    </svg>
                </div>
                <h2 style="color: var(--accent-blue);">Backing Up Your Data</h2>
                <p style="color: var(--text-secondary);">Please wait while we securely backup your information...</p>
            </div>
            
            <div class="sync-progress-bar">
                <div class="sync-progress-fill" id="backupProgress"></div>
            </div>
            
            <p id="backupStatus" style="color: var(--text-muted); font-size: 0.9rem;">Preparing backup...</p>
            
            <div id="backupDetails" style="margin-top: 16px; padding: 12px; background: rgba(59, 130, 246, 0.05); border-radius: 12px; border: 1px solid rgba(59, 130, 246, 0.2); opacity: 0; transition: all 0.5s ease;">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                    <svg viewBox="0 0 24 24" fill="var(--accent-blue)" style="width: 16px; height: 16px;">
                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span style="font-weight: 600; color: var(--accent-blue); font-size: 0.9rem;">Backing up:</span>
                </div>
                <div id="backupItemsList" style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.6;">
                    <!-- Items will be populated here -->
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Prepare backup details
    const scheduleNames = Object.values(appState.schedules).map(s => s.name);
    let completedTasks = 0;
    Object.values(appState.schedules).forEach(schedule => {
        completedTasks += Object.values(schedule.completedTasks || {}).filter(completed => completed).length;
    });
    
    const totalItems = Object.keys(appState.schedules).length + 3;
    const baseTime = 4000;
    const extraTime = Math.min(totalItems * 500, 6000);
    const totalTime = baseTime + extraTime;
    
    let progress = 0;
    const progressBar = document.getElementById('backupProgress');
    const statusText = document.getElementById('backupStatus');
    const detailsDiv = document.getElementById('backupDetails');
    const itemsList = document.getElementById('backupItemsList');
    
    const statuses = [
        'Preparing backup...',
        'Backing up account information...',
        'Backing up revision schedules...',
        'Backing up progress data...',
        'Backing up settings...',
        'Finalizing backup...'
    ];
    
    const interval = setInterval(() => {
        progress += (100 / (totalTime / 200));
        progressBar.style.width = Math.min(progress, 100) + '%';
        
        const statusIndex = Math.floor((progress / 100) * statuses.length);
        if (statusText && statusIndex < statuses.length) {
            statusText.textContent = statuses[statusIndex];
        }
        
        // Show details after 20% progress
        if (progress > 20 && detailsDiv.style.opacity === '0') {
            detailsDiv.style.opacity = '1';
            itemsList.innerHTML = `
                <div style="margin-bottom: 8px;">• Account information and settings</div>
                ${scheduleNames.map(name => `<div style="margin-bottom: 4px;">• Schedule: <strong>${name}</strong></div>`).join('')}
                <div style="margin-bottom: 4px;">• ${completedTasks} completed task${completedTasks !== 1 ? 's' : ''} and progress</div>
                <div>• App preferences and theme settings</div>
            `;
        }
        
        if (progress >= 100) {
            clearInterval(interval);
            localStorage.setItem(`gcse_backup_${currentUser.email}`, JSON.stringify(userData));
            
            setTimeout(() => {
                modal.remove();
                showAlert('Data backed up successfully!', 'success');
            }, 500);
        }
    }, 200);
}

// Check for available backup when user tries to login to deleted account
function checkForBackupOnLogin(email) {
    const backupKey = `gcse_backup_${email}`;
    return localStorage.getItem(backupKey);
}

function showSyncBackupModal(email) {
    const backup = checkForBackupOnLogin(email);
    if (!backup) return;
    
    const backupData = JSON.parse(backup);
    const scheduleCount = Object.keys(backupData.schedules || {}).length;
    const scheduleNames = Object.values(backupData.schedules || {}).map(s => s.name);
    let completedTasks = 0;
    Object.values(backupData.schedules || {}).forEach(schedule => {
        completedTasks += Object.values(schedule.completedTasks || {}).filter(completed => completed).length;
    });
    
    const modal = document.createElement('div');
    modal.className = 'auth-overlay show';
    modal.innerHTML = `
        <div class="auth-modal" style="max-width: 550px;">
            <div class="auth-header">
                <div style="width: 60px; height: 60px; margin: 0 auto 16px auto; background: var(--accent-blue); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <svg viewBox="0 0 24 24" fill="white" style="width: 28px; height: 28px;">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                </div>
                <h2 style="color: var(--accent-blue);">Backup Data Found</h2>
                <p style="color: var(--text-secondary);">We found a backup of your previous account data. Would you like to restore it?</p>
            </div>
            
            <div style="background: var(--accent-blue-light); border: 2px solid rgba(59, 130, 246, 0.3); border-radius: 16px; padding: 20px; margin-bottom: 24px;">
                <h4 style="color: var(--accent-blue); margin-bottom: 16px; font-size: 1.1rem; font-weight: 700;">Your Backup Contains:</h4>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-bottom: 16px;">
                    <div style="text-align: center; padding: 12px; background: rgba(255, 255, 255, 0.6); border-radius: 12px; opacity: 0; animation: slideInUp 0.5s ease-out 0.3s both;">
                        <div style="font-size: 1.5rem; font-weight: 800; color: var(--accent-blue); margin-bottom: 4px;">${scheduleCount}</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary); font-weight: 600;">Schedule${scheduleCount !== 1 ? 's' : ''}</div>
                    </div>
                    
                    <div style="text-align: center; padding: 12px; background: rgba(255, 255, 255, 0.6); border-radius: 12px; opacity: 0; animation: slideInUp 0.5s ease-out 0.5s both;">
                        <div style="font-size: 1.5rem; font-weight: 800; color: var(--accent-blue); margin-bottom: 4px;">${completedTasks}</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary); font-weight: 600;">Completed Task${completedTasks !== 1 ? 's' : ''}</div>
                    </div>
                </div>
                
                ${scheduleCount > 0 ? `
                <div style="margin-bottom: 12px;">
                    <h5 style="color: var(--accent-blue); margin-bottom: 8px; font-weight: 700; font-size: 0.9rem;">Schedules:</h5>
                    <div style="display: flex; flex-direction: column; gap: 6px;">
                        ${scheduleNames.map((name, index) => `
                            <div style="background: rgba(255, 255, 255, 0.4); padding: 8px 12px; border-radius: 8px; font-size: 0.85rem; font-weight: 600; color: var(--text-primary); opacity: 0; animation: slideInUp 0.4s ease-out ${0.7 + (index * 0.1)}s both;">
                                • ${name}
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 0.8rem; opacity: 0; animation: slideInUp 0.5s ease-out 1s both;">
                    <div style="color: var(--text-primary);">• Account settings</div>
                    <div style="color: var(--text-primary);">• App preferences</div>
                </div>
            </div>
            
            <div style="display: flex; gap: 12px;">
                <button class="btn-secondary" style="flex: 1;" onclick="skipBackupRestore('${email}')">
                    Skip Restore
                </button>
                <button class="btn-primary" style="flex: 1;" onclick="startBackupRestore('${email}')" id="restoreBtn">
                    <svg class="icon" viewBox="0 0 24 24">
                        <polyline points="23,4 23,10 17,10"/>
                        <polyline points="1,20 1,14 7,14"/>
                        <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4-4.64,4.36A9,9,0,0,1,3.51,15"/>
                    </svg>
                    Restore Data
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Add smooth animation styles if not already added
    if (!document.getElementById('restoreAnimations')) {
        const style = document.createElement('style');
        style.id = 'restoreAnimations';
        style.textContent = `
            @keyframes slideInUp {
                0% { transform: translateY(20px); opacity: 0; }
                100% { transform: translateY(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    }
}

function skipBackupRestore(email) {
    // Clean up backup
    localStorage.removeItem(`gcse_backup_${email}`);
    document.querySelector('.auth-overlay').remove();
    showAlert('Starting with fresh account', 'success');
}

function startBackupRestore(email) {
    const backup = JSON.parse(checkForBackupOnLogin(email));
    
    // Create dedicated restore processing screen
    const modal = document.querySelector('.auth-overlay');
    modal.innerHTML = `
        <div class="auth-modal" style="max-width: 650px;">
            <div class="auth-header">
                <div style="width: 70px; height: 70px; margin: 0 auto 20px auto; background: linear-gradient(135deg, var(--accent-green) 0%, #047857 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; animation: pulse 2s infinite; box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3);">
                    <svg viewBox="0 0 24 24" fill="white" style="width: 32px; height: 32px;">
                        <polyline points="23,4 23,10 17,10"/>
                        <polyline points="1,20 1,14 7,14"/>
                        <path d="M20.49,9A9,9,0,0,0,5.64,5.64L1,10m22,4-4.64,4.36A9,9,0,0,1,3.51,15"/>
                    </svg>
                </div>
                <h2 style="color: var(--accent-green); font-size: 1.6rem; margin-bottom: 8px;">Restoring Your Data</h2>
                <p style="color: var(--text-secondary); font-size: 1rem;">Processing your backup and restoring each item...</p>
            </div>
            
            <!-- Overall Progress -->
            <div style="margin-bottom: 24px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span style="color: var(--text-primary); font-weight: 600; font-size: 0.9rem;">Overall Progress</span>
                    <span style="color: var(--accent-green); font-weight: 700; font-size: 0.9rem;" id="overallProgress">0%</span>
                </div>
                <div class="sync-progress-bar" style="height: 12px;">
                    <div class="sync-progress-fill" id="mainProgress" style="background: linear-gradient(90deg, var(--accent-green) 0%, #047857 100%); width: 0%;"></div>
                </div>
                <p id="currentStatus" style="color: var(--text-muted); font-size: 0.85rem; margin-top: 8px; text-align: center;">Initializing restore process...</p>
            </div>
            
            <!-- Restore Items List -->
            <div style="background: rgba(16, 185, 129, 0.04); border: 2px solid rgba(16, 185, 129, 0.15); border-radius: 20px; padding: 20px; max-height: 400px; overflow-y: auto;">
                <h3 style="color: var(--accent-green); font-size: 1.1rem; font-weight: 700; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                    <svg viewBox="0 0 24 24" fill="currentColor" style="width: 18px; height: 18px;">
                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Restoring Items
                </h3>
                <div id="restoreItemsList" style="display: flex; flex-direction: column; gap: 12px;">
                    <!-- Items will be populated here -->
                </div>
            </div>
        </div>
    `;
    
    // Prepare restore items with details
    const restoreItems = [];
    
    if (backup.user) {
        restoreItems.push({
            id: 'account',
            title: 'Account Information',
            description: `${backup.user.name} (${backup.user.email})`,
            icon: '<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>',
            duration: 2000
        });
    }
    
    if (backup.settings) {
        restoreItems.push({
            id: 'settings',
            title: 'App Settings & Preferences',
            description: 'Theme, notifications, and customizations',
            icon: '<circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33"/>',
            duration: 1500
        });
    }
    
    // Add individual schedules
    Object.values(backup.schedules || {}).forEach(schedule => {
        let completedCount = Object.values(schedule.completedTasks || {}).filter(c => c).length;
        let totalTasks = 0;
        Object.values(schedule.weeklySchedule).forEach(day => totalTasks += day.length);
        
        restoreItems.push({
            id: `schedule-${schedule.id}`,
            title: schedule.name,
            description: `${completedCount}/${totalTasks} tasks completed`,
            icon: '<path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>',
            duration: 2500,
            isSchedule: true
        });
    });
    
    // Populate items list
    const itemsList = document.getElementById('restoreItemsList');
    restoreItems.forEach((item, index) => {
        const itemElement = document.createElement('div');
        itemElement.id = `restore-item-${item.id}`;
        itemElement.className = 'restore-item';
        itemElement.innerHTML = `
            <div style="display: flex; align-items: center; gap: 16px; padding: 16px; background: var(--bg-secondary); border-radius: 16px; border: 2px solid var(--border-color); transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); opacity: 0.6;">
                <div class="restore-item-icon" style="width: 40px; height: 40px; background: var(--border-color); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.4s ease;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px; color: var(--text-muted);">
                        ${item.icon}
                    </svg>
                </div>
                <div class="restore-item-content" style="flex: 1; min-width: 0;">
                    <div style="font-weight: 700; color: var(--text-primary); margin-bottom: 4px; font-size: 0.95rem;">${item.title}</div>
                    <div style="font-size: 0.8rem; color: var(--text-muted); line-height: 1.3;">${item.description}</div>
                </div>
                <div class="restore-item-status" style="display: flex; align-items: center; gap: 8px;">
                    <div class="status-indicator" style="width: 12px; height: 12px; border-radius: 50%; background: var(--border-color); transition: all 0.4s ease;"></div>
                    <span class="status-text" style="font-size: 0.8rem; font-weight: 600; color: var(--text-muted);">Waiting</span>
                </div>
            </div>
        `;
        itemsList.appendChild(itemElement);
    });
    
    // Start restore process
    startRestoreAnimation(restoreItems, backup, email);
}

function startRestoreAnimation(restoreItems, backup, email) {
    const mainProgress = document.getElementById('mainProgress');
    const overallProgressText = document.getElementById('overallProgress');
    const currentStatus = document.getElementById('currentStatus');
    
    let currentItemIndex = 0;
    let overallProgress = 0;
    const totalDuration = restoreItems.reduce((sum, item) => sum + item.duration, 0);
    
    function processNextItem() {
        if (currentItemIndex >= restoreItems.length) {
            // Complete restoration
            completeRestore(backup, email, restoreItems);
            return;
        }
        
        const currentItem = restoreItems[currentItemIndex];
        const itemElement = document.getElementById(`restore-item-${currentItem.id}`);
        const statusIndicator = itemElement.querySelector('.status-indicator');
        const statusText = itemElement.querySelector('.status-text');
        const itemIcon = itemElement.querySelector('.restore-item-icon');
        
        // Animate item to "processing" state
        itemElement.style.opacity = '1';
        itemElement.style.transform = 'scale(1.02)';
        itemElement.style.borderColor = 'var(--accent-green)';
        itemElement.style.background = 'rgba(16, 185, 129, 0.08)';
        
        statusIndicator.style.background = 'var(--accent-green)';
        statusIndicator.style.animation = 'pulse 1.5s ease-in-out infinite';
        statusText.textContent = 'Processing...';
        statusText.style.color = 'var(--accent-green)';
        
        itemIcon.style.background = 'var(--accent-green)';
        itemIcon.querySelector('svg').style.color = 'white';
        
        // Update status
        currentStatus.textContent = `Restoring ${currentItem.title}...`;
        
        // Simulate processing time
        setTimeout(() => {
            // Mark as completed
            statusIndicator.style.background = 'var(--accent-green)';
            statusIndicator.style.animation = '';
            statusIndicator.innerHTML = `
                <svg viewBox="0 0 24 24" fill="white" style="width: 8px; height: 8px;">
                    <polyline points="20,6 9,17 4,12"/>
                </svg>
            `;
            statusText.textContent = 'Completed';
            
            itemElement.style.transform = 'scale(1)';
            itemElement.style.borderColor = 'var(--accent-green)';
            
            // Update overall progress
            overallProgress += (currentItem.duration / totalDuration) * 100;
            mainProgress.style.width = Math.min(overallProgress, 100) + '%';
            overallProgressText.textContent = Math.round(Math.min(overallProgress, 100)) + '%';
            
            currentItemIndex++;
            
            // Process next item after a brief delay
            setTimeout(() => {
                processNextItem();
            }, 300);
            
        }, currentItem.duration);
    }
    
    // Start with first item after a brief delay
    setTimeout(() => {
        processNextItem();
    }, 1000);
}

function completeRestore(backup, email, restoreItems) {
    const currentStatus = document.getElementById('currentStatus');
    const overallProgressText = document.getElementById('overallProgress');
    const mainProgress = document.getElementById('mainProgress');
    
    // Set to 100% complete
    mainProgress.style.width = '100%';
    overallProgressText.textContent = '100%';
    currentStatus.textContent = 'Restore completed successfully!';
    currentStatus.style.color = 'var(--accent-green)';
    currentStatus.style.fontWeight = '600';
    
    // Actually restore the data
    const schedules = backup.schedules || {};
    appState.schedules = schedules;
    userSettings = { ...userSettings, ...backup.settings };
    
    saveAppState();
    saveSettings();
    applySettings();
    updateDashboard();
    updateProgress();
    
    localStorage.removeItem(`gcse_backup_${email}`);
    
    // Show completion modal after a delay
    setTimeout(() => {
        const scheduleNames = Object.values(schedules).map(s => s.name);
        let completedTasks = 0;
        Object.values(schedules).forEach(schedule => {
            completedTasks += Object.values(schedule.completedTasks || {}).filter(completed => completed).length;
        });
        
        document.querySelector('.auth-overlay').remove();
        showRestoreCompletionModal(scheduleNames, completedTasks);
    }, 1500);
}

function showRestoreCompletionModal(scheduleNames, completedTasks) {
    const completionModal = document.createElement('div');
    completionModal.className = 'auth-overlay';
    completionModal.innerHTML = `
        <div class="auth-modal" style="max-width: 520px; transform: scale(0.9) translateY(30px); transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);">
            <div class="auth-header">
                <div style="width: 80px; height: 80px; margin: 0 auto 20px auto; background: linear-gradient(135deg, var(--accent-green) 0%, #047857 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 8px 32px rgba(16, 185, 129, 0.3); animation: successPulse 1.5s ease-out; transform: scale(0);">
                    <svg viewBox="0 0 24 24" fill="white" style="width: 36px; height: 36px; opacity: 0; animation: checkMark 0.8s ease-out 0.8s both;">
                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                <h2 style="color: var(--accent-green); margin-bottom: 8px; font-size: 1.8rem; opacity: 0; animation: fadeInUp 0.6s ease-out 1s both;">Data Restored Successfully!</h2>
                <p style="color: var(--text-secondary); margin-bottom: 24px; opacity: 0; animation: fadeInUp 0.6s ease-out 1.2s both;">Welcome back! Your account has been fully restored.</p>
            </div>
            
            <div style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.08) 0%, rgba(16, 185, 129, 0.04) 100%); border: 2px solid rgba(16, 185, 129, 0.2); border-radius: 20px; padding: 24px; margin-bottom: 24px; opacity: 0; animation: fadeInUp 0.6s ease-out 1.4s both;">
                <h3 style="color: var(--accent-green); font-size: 1.2rem; font-weight: 700; margin-bottom: 16px;">
                    Restored Schedules
                </h3>
                
                <div style="display: grid; gap: 10px; margin-bottom: 20px; max-height: 200px; overflow-y: auto;">
                    ${scheduleNames.map((name, index) => `
                        <div style="padding: 12px; background: rgba(255, 255, 255, 0.6); border-radius: 12px; transform: translateX(-30px); opacity: 0; animation: slideInRight 0.5s ease-out ${1.6 + (index * 0.1)}s both;">
                            <div style="display: flex; align-items: center; gap: 12px;">
                                <svg viewBox="0 0 24 24" fill="var(--accent-green)" style="width: 18px; height: 18px;">
                                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                </svg>
                                <span style="font-weight: 600; color: var(--text-primary); font-size: 0.95rem;">${name}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 16px;">
                    <div style="text-align: center; padding: 16px; background: rgba(255, 255, 255, 0.5); border-radius: 12px; transform: translateY(20px); opacity: 0; animation: slideInUp 0.5s ease-out ${1.8 + (scheduleNames.length * 0.1)}s both;">
                        <div style="font-size: 2rem; font-weight: 800; color: var(--accent-green); margin-bottom: 4px;">${scheduleNames.length}</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary); font-weight: 600;">Schedule${scheduleNames.length !== 1 ? 's' : ''}</div>
                    </div>
                    
                    <div style="text-align: center; padding: 16px; background: rgba(255, 255, 255, 0.5); border-radius: 12px; transform: translateY(20px); opacity: 0; animation: slideInUp 0.5s ease-out ${2 + (scheduleNames.length * 0.1)}s both;">
                        <div style="font-size: 2rem; font-weight: 800; color: var(--accent-green); margin-bottom: 4px;">${completedTasks}</div>
                        <div style="font-size: 0.9rem; color: var(--text-secondary); font-weight: 600;">Completed Task${completedTasks !== 1 ? 's' : ''}</div>
                    </div>
                </div>
            </div>
            
            <button class="btn-primary" onclick="closeRestoreCompletionModal()" style="width: 100%; padding: 18px; font-size: 1.1rem; transform: translateY(20px); opacity: 0; animation: slideInUp 0.5s ease-out ${2.2 + (scheduleNames.length * 0.1)}s both;">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                Continue to Dashboard
            </button>
        </div>
    `;
    
    document.body.appendChild(completionModal);
    
    // Enhanced animations
    const style = document.createElement('style');
    style.textContent = `
        @keyframes successPulse {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.15); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes checkMark {
            0% { opacity: 0; transform: scale(0) rotate(45deg); }
            50% { opacity: 1; transform: scale(1.2) rotate(0deg); }
            100% { opacity: 1; transform: scale(1) rotate(0deg); }
        }
        
        @keyframes fadeInUp {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideInUp {
            0% { opacity: 0; transform: translateY(30px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideInRight {
            0% { opacity: 0; transform: translateX(-30px); }
            100% { opacity: 1; transform: translateX(0); }
        }
    `;
    document.head.appendChild(style);
    
    // Show modal with animation
    setTimeout(() => {
        completionModal.classList.add('show');
        const modalContent = completionModal.querySelector('.auth-modal');
        modalContent.style.transform = 'scale(1) translateY(0)';
    }, 200);
}

function closeRestoreCompletionModal() {
    const modal = document.querySelector('.auth-overlay');
    if (modal) {
        modal.classList.remove('show');
        setTimeout(() => {
            modal.remove();
            showAlert('Welcome back! Your data has been restored successfully.', 'success');
        }, 500);
    }
}

function showSelectiveBackup() {
    const modal = document.createElement('div');
    modal.className = 'auth-overlay show';
    modal.innerHTML = `
        <div class="auth-modal" style="max-width: 600px;">
            <button class="auth-close" onclick="this.closest('.auth-overlay').remove()">
                <svg class="icon" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
            
            <div class="auth-header">
                <div style="width: 60px; height: 60px; margin: 0 auto 16px auto; background: var(--accent-blue); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <svg viewBox="0 0 24 24" fill="white" style="width: 28px; height: 28px;">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <path d="M9 11v-1a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v1"/>
                        <path d="M9 11h6"/>
                    </svg>
                </div>
                <h2 style="color: var(--accent-blue);">Select Data to Backup</h2>
                <p style="color: var(--text-secondary);">Choose what you want to include in your backup</p>
            </div>
            
            <div style="margin-bottom: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <h3 style="color: var(--text-primary); font-size: 1.1rem; font-weight: 700;">Backup Options</h3>
                    <button type="button" class="btn-secondary" onclick="toggleAllBackupOptions()" id="selectAllBtn" style="padding: 8px 16px; font-size: 0.85rem;">
                        <svg class="icon" viewBox="0 0 24 24" style="width: 14px; height: 14px;">
                            <polyline points="9,11 12,14 22,4"/>
                            <path d="M21,12v7a2,2,0,0,1-2,2H5a2,2,0,0,1-2-2V5A2,2,0,0,1,5,3H16"/>
                        </svg>
                        Select All
                    </button>
                </div>
                
                <div style="display: grid; gap: 12px;">
                    <div class="backup-option" onclick="toggleBackupOption('account')">
                        <div class="backup-checkbox" id="account-checkbox">
                            <svg class="icon" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                                <polyline points="20,6 9,17 4,12"/>
                            </svg>
                        </div>
                        <div class="backup-option-content">
                            <div class="backup-option-title">Account Information</div>
                            <div class="backup-option-desc">Name, email, and preferences</div>
                        </div>
                    </div>
                    
                    <div class="backup-option" onclick="toggleBackupOption('settings')">
                        <div class="backup-checkbox" id="settings-checkbox">
                            <svg class="icon" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                                <polyline points="20,6 9,17 4,12"/>
                            </svg>
                        </div>
                        <div class="backup-option-content">
                            <div class="backup-option-title">App Settings</div>
                            <div class="backup-option-desc">Theme, notifications, and customizations</div>
                        </div>
                    </div>
                    
                    ${Object.values(appState.schedules).map(schedule => {
                        let completedCount = Object.values(schedule.completedTasks || {}).filter(c => c).length;
                        let totalTasks = 0;
                        Object.values(schedule.weeklySchedule).forEach(day => totalTasks += day.length);
                        
                        return `
                        <div class="backup-option" onclick="toggleBackupOption('schedule-${schedule.id}')">
                            <div class="backup-checkbox" id="schedule-${schedule.id}-checkbox">
                                <svg class="icon" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                                    <polyline points="20,6 9,17 4,12"/>
                                </svg>
                            </div>
                            <div class="backup-option-content">
                                <div class="backup-option-title">${schedule.name}</div>
                                <div class="backup-option-desc">${completedCount}/${totalTasks} tasks completed</div>
                            </div>
                        </div>
                        `;
                    }).join('')}
                </div>
            </div>
            
            <div style="display: flex; gap: 12px;">
                <button type="button" class="btn-secondary" style="flex: 1;" onclick="this.closest('.auth-overlay').remove()">
                    Cancel
                </button>
                <button type="button" class="btn-primary" style="flex: 1;" onclick="executeSelectiveBackup()">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <path d="M12 18v-6m-3 3l3-3 3 3"/>
                    </svg>
                    Create Backup
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Add CSS for backup options
    const style = document.createElement('style');
    style.textContent = `
        .backup-option {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            border: 2px solid var(--border-color);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
        }
        
        .backup-option:hover {
            border-color: var(--accent-blue);
            background: var(--accent-blue-light);
            transform: translateY(-2px);
        }
        
        .backup-option.selected {
            border-color: var(--accent-blue);
            background: var(--accent-blue-light);
        }
        
        .backup-checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            background: var(--bg-secondary);
        }
        
        .backup-checkbox svg {
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.3s ease;
            color: white;
        }
        
        .backup-checkbox.checked {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
        }
        
        .backup-checkbox.checked svg {
            opacity: 1;
            transform: scale(1);
        }
        
        .backup-option-content {
            flex: 1;
        }
        
        .backup-option-title {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .backup-option-desc {
            font-size: 0.85rem;
            color: var(--text-muted);
        }
    `;
    document.head.appendChild(style);
}

let selectedBackupItems = new Set(['account', 'settings']); // Default selections

function toggleBackupOption(optionId) {
    const checkbox = document.getElementById(optionId + '-checkbox');
    const option = checkbox.closest('.backup-option');
    
    if (selectedBackupItems.has(optionId)) {
        selectedBackupItems.delete(optionId);
        checkbox.classList.remove('checked');
        option.classList.remove('selected');
    } else {
        selectedBackupItems.add(optionId);
        checkbox.classList.add('checked');
        option.classList.add('selected');
    }
    
    updateSelectAllButton();
}

function toggleAllBackupOptions() {
    const allOptions = ['account', 'settings', ...Object.keys(appState.schedules).map(id => `schedule-${id}`)];
    const allSelected = allOptions.every(option => selectedBackupItems.has(option));
    
    if (allSelected) {
        // Deselect all
        selectedBackupItems.clear();
        document.querySelectorAll('.backup-checkbox').forEach(cb => {
            cb.classList.remove('checked');
            cb.closest('.backup-option').classList.remove('selected');
        });
    } else {
        // Select all
        allOptions.forEach(option => selectedBackupItems.add(option));
        document.querySelectorAll('.backup-checkbox').forEach(cb => {
            cb.classList.add('checked');
            cb.closest('.backup-option').classList.add('selected');
        });
    }
    
    updateSelectAllButton();
}

function updateSelectAllButton() {
    const allOptions = ['account', 'settings', ...Object.keys(appState.schedules).map(id => `schedule-${id}`)];
    const allSelected = allOptions.every(option => selectedBackupItems.has(option));
    const btn = document.getElementById('selectAllBtn');
    
    if (btn) {
        btn.innerHTML = allSelected ? `
            <svg class="icon" viewBox="0 0 24 24" style="width: 14px; height: 14px;">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                <path d="M9 9h6v6H9z"/>
            </svg>
            Deselect All
        ` : `
            <svg class="icon" viewBox="0 0 24 24" style="width: 14px; height: 14px;">
                <polyline points="9,11 12,14 22,4"/>
                <path d="M21,12v7a2,2,0,0,1-2,2H5a2,2,0,0,1-2-2V5A2,2,0,0,1,5,3H16"/>
            </svg>
            Select All
        `;
    }
}

function executeSelectiveBackup() {
    if (selectedBackupItems.size === 0) {
        showAlert('Please select at least one item to backup', 'error');
        return;
    }
    
    // Build selective backup data
    const backupData = {
        version: '1.0',
        backupDate: new Date().toISOString(),
        selectedItems: Array.from(selectedBackupItems)
    };
    
    if (selectedBackupItems.has('account')) {
        backupData.user = currentUser;
    }
    
    if (selectedBackupItems.has('settings')) {
        backupData.settings = userSettings;
    }
    
    // Add selected schedules
    const selectedSchedules = {};
    selectedBackupItems.forEach(item => {
        if (item.startsWith('schedule-')) {
            const scheduleId = item.replace('schedule-', '');
            if (appState.schedules[scheduleId]) {
                selectedSchedules[scheduleId] = appState.schedules[scheduleId];
            }
        }
    });
    backupData.schedules = selectedSchedules;
    
    // Close modal and start backup
    document.querySelector('.auth-overlay').remove();
    
    // Show backup progress
    selectiveBackupWithProgress(backupData);
}

function selectiveBackupWithProgress(backupData) {
    const modal = document.createElement('div');
    modal.className = 'auth-overlay show backup-progress-modal';
    modal.innerHTML = `
        <div class="auth-modal">
            <div class="auth-header">
                <div style="width: 60px; height: 60px; margin: 0 auto 16px auto; background: var(--accent-blue); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <svg viewBox="0 0 24 24" fill="white" style="width: 28px; height: 28px;">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                    </svg>
                </div>
                <h2 style="color: var(--accent-blue);">Creating Selective Backup</h2>
                <p style="color: var(--text-secondary);">Backing up your selected data...</p>
            </div>
            
            <div class="sync-progress-bar">
                <div class="sync-progress-fill" id="backupProgress"></div>
            </div>
            
            <p id="backupStatus" style="color: var(--text-muted); font-size: 0.9rem;">Preparing selective backup...</p>
            
            <div style="margin-top: 16px; padding: 12px; background: rgba(59, 130, 246, 0.05); border-radius: 12px; border: 1px solid rgba(59, 130, 246, 0.2);">
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                    <svg viewBox="0 0 24 24" fill="var(--accent-blue)" style="width: 16px; height: 16px;">
                        <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    <span style="font-weight: 600; color: var(--accent-blue); font-size: 0.9rem;">Selected items:</span>
                </div>
                <div style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.6;">
                    ${backupData.selectedItems.includes('account') ? '• Account information<br>' : ''}
                    ${backupData.selectedItems.includes('settings') ? '• App settings and preferences<br>' : ''}
                    ${Object.values(backupData.schedules || {}).map(s => `• Schedule: <strong>${s.name}</strong><br>`).join('')}
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Simulate backup process
    const totalItems = backupData.selectedItems.length;
    const baseTime = 3000 + (totalItems * 800);
    
    let progress = 0;
    const progressBar = document.getElementById('backupProgress');
    const statusText = document.getElementById('backupStatus');
    
    const statuses = [
        'Preparing selective backup...',
        'Processing selected data...',
        'Creating backup archive...',
        'Finalizing backup...'
    ];
    
    const interval = setInterval(() => {
        progress += (100 / (baseTime / 200));
        progressBar.style.width = Math.min(progress, 100) + '%';
        
        const statusIndex = Math.floor((progress / 100) * statuses.length);
        if (statusText && statusIndex < statuses.length) {
            statusText.textContent = statuses[statusIndex];
        }
        
        if (progress >= 100) {
            clearInterval(interval);
            localStorage.setItem(`gcse_backup_${currentUser.email}`, JSON.stringify(backupData));
            
            setTimeout(() => {
                modal.remove();
                showAlert('Selective backup created successfully!', 'success');
            }, 500);
        }
    }, 200);
}

function deleteAccount() {
    const modal = document.createElement('div');
    modal.className = 'auth-overlay show delete-account-modal';
    modal.innerHTML = `
        <div class="auth-modal">
            <button class="auth-close" onclick="this.closest('.auth-overlay').remove()">
                <svg class="icon" viewBox="0 0 24 24" style="width: 20px; height: 20px;">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
            </button>
            
            <div class="auth-header">
                <div style="width: 60px; height: 60px; margin: 0 auto 16px auto; background: var(--accent-red); border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                    <svg viewBox="0 0 24 24" fill="white" style="width: 28px; height: 28px;">
                        <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                </div>
                <h2 style="color: var(--accent-red); margin-bottom: 8px;">Delete Account</h2>
                <p style="color: var(--text-secondary);">This action cannot be undone</p>
            </div>
            
            <div style="background: var(--accent-blue-light); border: 2px solid rgba(59, 130, 246, 0.3); border-radius: 16px; padding: 20px; margin-bottom: 20px;">
                <h3 style="color: var(--accent-blue); font-size: 1.1rem; font-weight: 700; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                    <svg viewBox="0 0 24 24" fill="currentColor" style="width: 18px; height: 18px;">
                        <path d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Before you proceed - Consider backing up your data
                </h3>
                <p style="margin: 0 0 16px 0; color: var(--text-primary); font-size: 0.9rem; line-height: 1.5;">
                    Once your account is deleted, this data cannot be recovered. We recommend creating a backup first.
                </p>
                <button class="btn-secondary" onclick="showSelectiveBackup()" style="width: 100%;">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <path d="M12 18v-6m-3 3l3-3 3 3"/>
                    </svg>
                    Choose What to Backup
                </button>
            </div>
            
            <div style="background: rgba(220, 38, 38, 0.05); border: 2px solid rgba(220, 38, 38, 0.2); border-radius: 16px; padding: 20px; margin-bottom: 24px;">
                <h3 style="color: var(--accent-red); font-size: 1.1rem; font-weight: 700; margin-bottom: 16px;">
                    The following data will be permanently deleted:
                </h3>
                <div class="delete-warning-grid">
                    <div class="warning-item">
                        <svg viewBox="0 0 24 24" fill="var(--accent-red)" style="width: 16px; height: 16px; flex-shrink: 0; margin-top: 2px;">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <div>
                            <strong>Account Information</strong><br>
                            <small style="color: var(--text-muted);">Name, email, and login credentials</small>
                        </div>
                    </div>
                    <div class="warning-item">
                        <svg viewBox="0 0 24 24" fill="var(--accent-red)" style="width: 16px; height: 16px; flex-shrink: 0; margin-top: 2px;">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <div>
                            <strong>Revision Schedules</strong><br>
                            <small style="color: var(--text-muted);">${Object.keys(appState.schedules).length} schedule(s) and progress</small>
                        </div>
                    </div>
                    <div class="warning-item">
                        <svg viewBox="0 0 24 24" fill="var(--accent-red)" style="width: 16px; height: 16px; flex-shrink: 0; margin-top: 2px;">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <div>
                            <strong>Study Progress</strong><br>
                            <small style="color: var(--text-muted);">All completed tasks and statistics</small>
                        </div>
                    </div>
                    <div class="warning-item">
                        <svg viewBox="0 0 24 24" fill="var(--accent-red)" style="width: 16px; height: 16px; flex-shrink: 0; margin-top: 2px;">
                            <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <div>
                            <strong>App Settings</strong><br>
                            <small style="color: var(--text-muted);">Preferences and customizations</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <form onsubmit="handleAccountDeletion(event)">
                <div class="auth-input-group">
                    <label for="deletePassword" style="color: var(--accent-red); font-weight: 700;">
                        Enter your password to confirm deletion:
                    </label>
                    <input type="password" id="deletePassword" class="auth-input" 
                           placeholder="Your current password" 
                           style="border-color: var(--accent-red);" required>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 24px;">
                    <button type="button" class="btn-secondary" style="flex: 1;" onclick="this.closest('.auth-overlay').remove()">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M18 6L6 18M6 6l12 12"/>
                        </svg>
                        Cancel
                    </button>
                    <button type="submit" class="auth-submit" style="flex: 1; background: var(--accent-red); border-color: var(--accent-red);">
                        <svg class="icon" viewBox="0 0 24 24">
                            <polyline points="3,6 5,6 21,6"/>
                            <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"/>
                        </svg>
                        Delete My Account
                    </button>
                </div>
            </form>
        </div>
    `;
    
    document.body.appendChild(modal);
    setTimeout(() => {
        document.getElementById('deletePassword').focus();
    }, 300);
}

function backupBeforeDelete() {
    backupUserData();
    // Close current modal after backup
    setTimeout(() => {
        const modal = document.querySelector('.delete-account-modal');
        if (modal) modal.remove();
    }, 8000); // Close after backup completes
}

function handleAccountDeletion(event) {
    event.preventDefault();
    
    const password = document.getElementById('deletePassword').value;
    
    // Verify password only
    if (btoa(password) !== currentUser.password) {
        showAlert('Incorrect password', 'error');
        document.getElementById('deletePassword').style.borderColor = 'var(--accent-red)';
        document.getElementById('deletePassword').focus();
        return;
    }
    
    // Show final confirmation
    const finalModal = document.createElement('div');
    finalModal.className = 'auth-overlay show';
    finalModal.innerHTML = `
        <div class="auth-modal" style="max-width: 400px;">
            <div class="auth-header">
                <div style="width: 60px; height: 60px; margin: 0 auto 16px auto; background: var(--accent-red); border-radius: 50%; display: flex; align-items: center; justify-content: center; animation: pulse 2s infinite;">
                    <svg viewBox="0 0 24 24" fill="white" style="width: 28px; height: 28px;">
                        <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                </div>
                <h2 style="color: var(--accent-red);">Final Confirmation</h2>
                <p style="color: var(--text-secondary); margin-bottom: 24px;">Your account will be permanently deleted in 3 seconds...</p>
            </div>
            
            <div style="display: flex; gap: 12px;">
                <button class="btn-secondary" style="flex: 1;" onclick="cancelFinalDeletion()">
                    Stop Deletion
                </button>
                <button class="btn-secondary" style="flex: 1; background: var(--accent-red); color: white; cursor: not-allowed;" disabled id="deletingBtn">
                    Deleting... <span id="countdown">3</span>
                </button>
            </div>
        </div>
    `;
    
    document.querySelector('.auth-overlay').remove();
    document.body.appendChild(finalModal);
    
    let countdown = 3;
    const countdownElement = document.getElementById('countdown');
    const interval = setInterval(() => {
        countdown--;
        if (countdownElement) {
            countdownElement.textContent = countdown;
        }
        
        if (countdown <= 0) {
            clearInterval(interval);
            executeAccountDeletion();
            finalModal.remove();
        }
    }, 1000);
    
    window.deletionInterval = interval;
    window.deletionModal = finalModal;
}

function cancelFinalDeletion() {
    if (window.deletionInterval) {
        clearInterval(window.deletionInterval);
    }
    if (window.deletionModal) {
        window.deletionModal.remove();
    }
    showAlert('Account deletion cancelled', 'success');
}

function executeAccountDeletion() {
    // Remove from users database
    const savedUsers = JSON.parse(localStorage.getItem('gcseRevisionUsers') || '{}');
    delete savedUsers[currentUser.email];
    localStorage.setItem('gcseRevisionUsers', JSON.stringify(savedUsers));
    
    // Clear all local data
    localStorage.removeItem('gcseRevisionUser');
    localStorage.removeItem('gcseRevisionPlannerState');
    localStorage.removeItem('gcseRevisionSettings');
    
    // Reset app state
    currentUser = null;
    appState = {
        schedules: {},
        activeSchedule: null,
        currentPage: 'home',
        currentTabIndex: 0,
        visibleTabCount: 2,
        showingCompleted: false,
        isInitialized: false
    };
    
    // Update UI
    updateSettingsWithUserInfo();
    updateDashboard();
    updateProgress();
    showPage('home');
    
    showAlert('Account deleted successfully. Thank you for using GCSE Revision Planner.', 'success');
}

// Load user data on startup
function loadUserData() {
    const savedUser = localStorage.getItem('gcseRevisionUser');
    if (savedUser) {
        currentUser = JSON.parse(savedUser);
        updateSettingsWithUserInfo();
    } else {
        // Show auth modal for new users
        setTimeout(() => {
            showAuthModal();
        }, 1000);
    }
}

// Authentication Functions
function showAuthModal() {
    const overlay = document.getElementById('authOverlay');
    if (overlay) {
        overlay.classList.add('show');
    }
}

function closeAuthModal() {
    const overlay = document.getElementById('authOverlay');
    if (overlay) {
        overlay.classList.remove('show');
    }
}

function switchAuthTab(tab) {
    // Update tab buttons
    document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    
    // Update forms
    document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
    document.getElementById(tab + 'Form').classList.add('active');
}

function handleLogin(event) {
    event.preventDefault();
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    // Simple local authentication (replace with real auth)
    const savedUsers = JSON.parse(localStorage.getItem('gcseRevisionUsers') || '{}');
    const user = savedUsers[email];
    
    if (user && user.password === btoa(password)) {
        currentUser = user;
        localStorage.setItem('gcseRevisionUser', JSON.stringify(user));
        closeAuthModal();
        updateSettingsWithUserInfo();
        showAlert('Welcome back, ' + user.name + '!', 'success');
    } else if (!user) {
        // Check if there's a backup for this email (deleted account)
        const backup = checkForBackupOnLogin(email);
        if (backup) {
            closeAuthModal();
            showAlert('Account does not exist. Please create a new account.', 'error');
            setTimeout(() => {
                switchAuthTab('signup');
                showAuthModal();
                // Pre-fill email in signup form
                setTimeout(() => {
                    const signupEmail = document.getElementById('signupEmail');
                    if (signupEmail) signupEmail.value = email;
                }, 300);
            }, 2000);
        } else {
            showAlert('Account does not exist. Please create a new account.', 'error');
        }
    } else {
        showAlert('Invalid email or password', 'error');
    }
}

function handleSignup(event) {
    event.preventDefault();
    const name = document.getElementById('signupName').value;
    const email = document.getElementById('signupEmail').value;
    const password = document.getElementById('signupPassword').value;
    const confirmPassword = document.getElementById('confirmPassword').value;
    
    if (password !== confirmPassword) {
        showAlert('Passwords do not match', 'error');
        return;
    }
    
    // Check if user already exists
    const savedUsers = JSON.parse(localStorage.getItem('gcseRevisionUsers') || '{}');
    if (savedUsers[email]) {
        showAlert('Account with this email already exists', 'error');
        return;
    }
    
    // Create new user
    const newUser = {
        name: name,
        email: email,
        password: btoa(password),
        joinDate: new Date().toISOString(),
        id: 'user_' + Date.now()
    };
    
    savedUsers[email] = newUser;
    localStorage.setItem('gcseRevisionUsers', JSON.stringify(savedUsers));
    
    currentUser = newUser;
    localStorage.setItem('gcseRevisionUser', JSON.stringify(newUser));
    
    closeAuthModal();
    updateSettingsWithUserInfo();
    showAlert('Account created successfully! Welcome, ' + name + '!', 'success');
    
    // Check for backup after successful signup
    setTimeout(() => {
        showSyncBackupModal(email);
    }, 1000);
}

function logout() {
    if (confirm('Are you sure you want to sign out?')) {
        currentUser = null;
        localStorage.removeItem('gcseRevisionUser');
        updateSettingsWithUserInfo();
        showAlert('You have been signed out', 'success');
    }
}

function updateSettingsWithUserInfo() {
    const accountCard = document.querySelector('.settings-card:last-child');
    if (!accountCard) return;
    
    if (currentUser) {
        // Show user info with enhanced options
        accountCard.innerHTML = `
            <h4>
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                    <circle cx="12" cy="7" r="4"/>
                </svg>
                Account Management
            </h4>
            <div class="user-info">
                <div class="user-avatar">${currentUser.name.charAt(0).toUpperCase()}</div>
                <div class="user-details">
                    <h4>${currentUser.name}</h4>
                    <p>${currentUser.email}</p>
                    <p style="font-size: 0.75rem; color: var(--text-muted);">
                        Member since ${new Date(currentUser.joinDate).toLocaleDateString()}
                    </p>
                </div>
            </div>
            <div class="settings-control" style="flex-direction: column; gap: 12px;">
                <div style="display: flex; gap: 12px; width: 100%;">
                    <button class="btn-secondary" onclick="editProfile()" style="flex: 1;">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                            <path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                        </svg>
                        Edit Profile
                    </button>
                    <button class="btn-secondary" onclick="changePassword()" style="flex: 1;">
                        <svg class="icon" viewBox="0 0 24 24">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                            <circle cx="12" cy="16" r="1"/>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                        </svg>
                        Change Password
                    </button>
                </div>
                <div style="display: flex; gap: 12px; width: 100%;">
                    <button class="btn-secondary" onclick="backupUserData()" style="flex: 1;">
                        <svg class="icon" viewBox="0 0 24 24">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <path d="M12 18v-6m-3 3l3-3 3 3"/>
                        </svg>
                        Backup Data
                    </button>
                    <button class="btn-secondary" onclick="deleteAccount()" style="flex: 1; background: var(--accent-red); color: white;">
                        <svg class="icon" viewBox="0 0 24 24">
                            <polyline points="3,6 5,6 21,6"/>
                            <path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6m3,0V4a2,2,0,0,1,2-2h4a2,2,0,0,1,2,2V6"/>
                        </svg>
                        Delete Account
                    </button>
                </div>
                <button class="btn-secondary" onclick="logout()" style="width: 100%;">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16,17 21,12 16,7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                    Sign Out
                </button>
            </div>
        `;
    } else {
        // Show sign in button
        accountCard.innerHTML = `
            <h4>
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                    <polyline points="10,17 15,12 10,7"/>
                    <line x1="15" y1="12" x2="3" y2="12"/>
                </svg>
                Account
            </h4>
            <p>Sign in to sync your progress across devices and backup your data</p>
            <div class="settings-control">
                <button class="btn-primary" onclick="showAuthModal()">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                        <polyline points="10,17 15,12 10,7"/>
                        <line x1="15" y1="12" x2="3" y2="12"/>
                    </svg>
                    Sign In / Sign Up
                </button>
            </div>
        `;
    }
}

// Bottom Navigation Functions
function navigateToPage(pageId) {
    showPage(pageId);
    updateBottomNavigation(pageId);
}

function updateBottomNavigation(activePage) {
    document.querySelectorAll('.bottom-nav-item').forEach(item => {
        item.classList.remove('active');
    });
    
    // Update active state based on page
    const navItems = document.querySelectorAll('.bottom-nav-item');
    const pageIndex = ['home', 'dashboard', 'progress', 'settings'].indexOf(activePage);
    if (pageIndex >= 0 && navItems[pageIndex]) {
        navItems[pageIndex].classList.add('active');
    }
}

// Haptic Feedback Function
function triggerHaptic(element) {
    // Add haptic animation class
    element.classList.add('haptic');
    
    // Trigger vibration if supported
    if ('vibrate' in navigator) {
        navigator.vibrate(50); // 50ms vibration
    }
    
    // Remove animation class
    setTimeout(() => {
        element.classList.remove('haptic');
    }, 300);
}

// Enhanced Swipe Gesture Functions
let isSwipeActive = false;
let swipeStartX = 0;
let swipeStartY = 0;
let activeSwipeElement = null;

// Improved task touch handlers
function handleTaskTouchStart(e) {
    if (isSwipeActive) return;
    
    const touch = e.touches[0];
    swipeStartX = touch.clientX;
    swipeStartY = touch.clientY;
    activeSwipeElement = e.currentTarget;
    isSwipeActive = true;
    
    // Prevent default to avoid scrolling
    e.preventDefault();
}

function handleTaskTouchMove(e) {
    if (!isSwipeActive || !activeSwipeElement) return;
    
    const touch = e.touches[0];
    const deltaX = touch.clientX - swipeStartX;
    const deltaY = touch.clientY - swipeStartY;
    
    // Only handle horizontal swipes
    if (Math.abs(deltaY) > Math.abs(deltaX)) {
        resetSwipe();
        return;
    }
    
    e.preventDefault();
    
    const progress = Math.min(Math.abs(deltaX) / 120, 1);
    const content = activeSwipeElement.querySelector('.task-content');
    
    if (deltaX > 30) {
        // Right swipe - Delete (Red)
        activeSwipeElement.style.background = `linear-gradient(90deg, #ef4444 ${progress * 100}%, var(--bg-secondary) ${progress * 100}%)`;
        content.style.transform = `translateX(${Math.min(deltaX, 120)}px)`;
        
        // Show delete indicator
        if (progress > 0.3) {
            showSwipeIndicator(activeSwipeElement, 'delete', progress);
        }
    } else if (deltaX < -30) {
        // Left swipe - Complete (Green)
        activeSwipeElement.style.background = `linear-gradient(270deg, #10b981 ${progress * 100}%, var(--bg-secondary) ${progress * 100}%)`;
        content.style.transform = `translateX(${Math.max(deltaX, -120)}px)`;
        
        // Show complete indicator
        if (progress > 0.3) {
            showSwipeIndicator(activeSwipeElement, 'complete', progress);
        }
    }
}

function handleTaskTouchEnd(e) {
    if (!isSwipeActive || !activeSwipeElement) return;
    
    const touch = e.changedTouches[0];
    const deltaX = touch.clientX - swipeStartX;
    const progress = Math.abs(deltaX) / 120;
    
    if (progress > 0.6) { // 60% swipe threshold
        const taskId = activeSwipeElement.dataset.taskId;
        
        if (deltaX > 0) {
            // Right swipe - Delete
            showDeleteConfirmation(taskId, activeSwipeElement);
        } else {
            // Left swipe - Complete
            completeTaskWithAnimation(taskId, activeSwipeElement);
        }
    } else {
        // Reset if not enough swipe
        resetSwipeAnimation(activeSwipeElement);
    }
    
    resetSwipe();
}

function showSwipeIndicator(element, action, progress) {
    let indicator = element.querySelector('.swipe-indicator');
    if (!indicator) {
        indicator = document.createElement('div');
        indicator.className = 'swipe-indicator';
        element.appendChild(indicator);
    }
    
    const icon = action === 'delete' ? 
        '<svg viewBox="0 0 24 24" fill="white" style="width:24px;height:24px;"><polyline points="3,6 5,6 21,6"/><path d="M19,6v14a2,2,0,0,1-2,2H7a2,2,0,0,1-2-2V6"/></svg>' :
        '<svg viewBox="0 0 24 24" fill="white" style="width:24px;height:24px;"><polyline points="20,6 9,17 4,12"/></svg>';
    
    indicator.innerHTML = `
        <div style="
            position: absolute;
            ${action === 'delete' ? 'right: 16px;' : 'left: 16px;'}
            top: 50%;
            transform: translateY(-50%) scale(${progress});
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: ${progress};
            pointer-events: none;
        ">
            ${icon}
            ${action === 'delete' ? 'Delete' : 'Complete'}
        </div>
    `;
}

function showDeleteConfirmation(taskId, element) {
    // Vibrate for confirmation
    if ('vibrate' in navigator) {
        navigator.vibrate([100, 50, 100]);
    }
    
    const modal = document.createElement('div');
    modal.className = 'duplicate-modal-overlay';
    modal.style.zIndex = '20000';
    modal.innerHTML = `
        <div class="duplicate-modal" style="max-width: 320px;">
            <h3 style="color: var(--accent-red);">Delete Task?</h3>
            <p>Are you sure you want to delete this revision task? This action cannot be undone.</p>
            <div class="duplicate-modal-buttons">
                <button class="duplicate-modal-button add-new" onclick="cancelDelete('${taskId}', this.closest('.duplicate-modal-overlay'))">
                    Cancel
                </button>
                <button class="duplicate-modal-button replace" onclick="confirmDelete('${taskId}', this.closest('.duplicate-modal-overlay'))">
                    Delete
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    setTimeout(() => modal.classList.add('show'), 100);
    
    // Store reference for cleanup
    element.deleteModal = modal;
}

function cancelDelete(taskId, modal) {
    modal.classList.remove('show');
    setTimeout(() => modal.remove(), 400);
    
    // Reset the task element
    const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
    if (taskElement) {
        resetSwipeAnimation(taskElement);
    }
}

function confirmDelete(taskId, modal) {
    modal.classList.remove('show');
    setTimeout(() => modal.remove(), 400);
    
    // Delete the task
    deleteTask(taskId);
    
    // Haptic feedback
    if ('vibrate' in navigator) {
        navigator.vibrate(200);
    }
    
    showAlert('Task deleted', 'success');
}

function completeTaskWithAnimation(taskId, element) {
    // Haptic feedback
    if ('vibrate' in navigator) {
        navigator.vibrate(50);
    }
    
    // Complete the task
    toggleTaskComplete(taskId);
    
    // Reset animation
    resetSwipeAnimation(element);
}

function resetSwipeAnimation(element) {
    const content = element.querySelector('.task-content');
    const indicator = element.querySelector('.swipe-indicator');
    
    element.style.background = '';
    content.style.transform = '';
    
    if (indicator) {
        indicator.remove();
    }
}

function resetSwipe() {
    isSwipeActive = false;
    swipeStartX = 0;
    swipeStartY = 0;
    activeSwipeElement = null;
}

// Enhanced Page Switching with Bottom Nav Update
const originalShowPage = showPage;
showPage = function(pageId) {
    originalShowPage(pageId);
    if (window.innerWidth <= 768) {
        updateBottomNavigation(pageId);
    }
};

// Initialize mobile features
document.addEventListener('DOMContentLoaded', function() {
    // Load user data
    loadUserData();
    
    // Update bottom navigation on initial load
    if (window.innerWidth <= 768) {
        updateBottomNavigation('home');
    }
});
    </script>
</body>
</html>

